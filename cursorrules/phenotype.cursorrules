# Phenotype Module Rules (`metainformant.phenotype`)

## Purpose
Phenotypic trait analysis: life course phenotype extraction and AntWiki integration.

## Dependencies
- **Required**: `core`
- **Optional**: `life_events` (for life course integration)

## Source Structure
```
src/metainformant/phenotype/
├── analysis/
│   └── life_course.py
├── behavior/
│   ├── ethogram.py, sequence.py
├── chemical/
│   ├── compound.py, profile.py
├── data/
│   ├── antwiki.py, scraper.py
├── electronic/
│   └── tracking.py
├── integration/
│   └── cross_omic.py
├── morphological/
│   ├── measurement.py, profile.py
├── sonic/
│   └── signal.py
├── visualization/
│   └── visualization.py
└── workflow/
    └── pipeline.py
```

## Package Management
- **ALWAYS use `uv`** for all Python package management and environment operations
- Use `uv run` to execute commands: `uv run pytest`, `uv run metainformant phenotype --help`
- **NEVER use `pip` directly**

## Key Submodules

### Life Course (`life_course`)
- Life course phenotype extraction
- Temporal trait patterns
- Integration with life events

### AntWiki (`antwiki`)
- AntWiki integration
- Species trait data
- Ecological metadata

### Behavior (`behavior`)
- Ethogram construction and analysis
- Behavioral sequence analysis
- Behavioral state transitions

### Chemical (`chemical`)
- Chemical compound profiling
- Chemical trait analysis
- Metabolomic phenotypes

### Electronic (`electronic`)
- Electronic tracking data
- Movement and activity tracking
- Sensor-based phenotyping

### Morphological (`morphological`)
- Morphological measurements
- Morphometric profiles
- Body size and shape traits

### Sonic (`sonic`)
- Acoustic signal processing
- Sound-based phenotypes
- Bioacoustic analysis

### Integration (`cross_omic`)
- Cross-omic phenotype integration
- Multi-modal phenotype analysis
- Phenotype-genotype integration

### Workflow (`pipeline`)
- End-to-end phenotype analysis pipelines
- Workflow orchestration
- Configuration-based execution

## Patterns

### I/O Operations
- **CRITICAL**: Always use `metainformant.core.io` for JSON/CSV/TSV operations
- Never use direct `import json` or `import csv`

**Pattern**:
```python
from metainformant.core import io

# Save phenotype data
io.dump_json(phenotype_data, "output/phenotype/traits/traits.json")
io.write_csv(df, "output/phenotype/life_course/events.csv")
```

### Path Handling
- Always use `metainformant.core.paths` utilities for path operations
- Always resolve and validate paths using `paths.expand_and_resolve()` and `paths.is_within()`

**Pattern**:
```python
from metainformant.core import paths

# Expand and resolve paths
output_path = paths.expand_and_resolve("output/phenotype/traits/")
```

### Type Hints
- Comprehensive type hints throughout
- Use `from __future__ import annotations` for forward references
- Union types: `str | Path | None`

### Phenotype Data Structure
- Phenotype data should be structured as trait dictionaries
- Include trait names, values, and metadata
- Support temporal phenotype data

### Integration with GWAS
- Integration with GWAS for phenotype-genotype associations
- Provide phenotype data for association testing
- Support both continuous and categorical traits

### Output Paths
- Base: `output/phenotype/<analysis>/`
- Life course: `output/phenotype/life_course/`
- Traits: `output/phenotype/traits/`

## Configuration

- No module-specific config (uses core config)
- Output paths default to `output/phenotype/`
- Environment prefix: `PHEN_` (e.g., `PHEN_WORK_DIR`, `PHEN_DB_PATH`)

## Integration

- **Uses**: `life_events` (optional, for life course integration)
- **Used by**: `gwas` (phenotype-genotype associations)
- **Integrates with**: `ontology` (trait functional annotation)

## Reference

See main `.cursorrules` for:
- Common directory structure and path handling
- Configuration patterns with env overrides
- Testing policy (NO_MOCKING_POLICY)
- Import patterns and code style
- Documentation guidelines

## Testing

- **STRICTLY NO MOCKING**: Test real implementations only (see main `.cursorrules` NO_MOCKING_POLICY)
- Test with real phenotype data from `data/`
- Write test outputs to `output/phenotype/test/` using `tmp_path` fixture
- No mocks, fakes, or stubs - use real file operations


