# Multi-Omics Module Rules (`metainformant.multiomics`)

## Purpose
Multi-omic data integration: cross-platform data harmonization, joint statistical analysis, and systems biology integration.

## Dependencies
- **Required**: `core`, `dna`, `rna`, `protein`, `singlecell`, `ml.dimensionality`

## Source Structure
```
src/metainformant/multiomics/
├── analysis/
│   └── integration.py
└── visualization/
    └── visualization.py
```

## Package Management
- **ALWAYS use `uv`** for all Python package management and environment operations
- Use `uv run` to execute commands: `uv run pytest`, `uv run metainformant multiomics --help`
- **NEVER use `pip` directly**

## Key Submodules

### Integration (`integration`)
- Cross-platform data harmonization
- Joint dimensionality reduction
- Multi-omic data fusion

**Patterns**:
```python
from metainformant.multiomics.analysis import integration

# Integrate multiple omics types
integrated = integration.integrate_omics(
    dna_data=dna_data,
    rna_data=rna_data,
    protein_data=protein_data,
    method="cca"  # or "pca", "nmf"
)
```

## Patterns

### I/O Operations
- **CRITICAL**: Always use `metainformant.core.io` for JSON/CSV/TSV operations
- Never use direct `import json` or `import csv`

**Pattern**:
```python
from metainformant.core import io

# Save integrated data
io.dump_json(integrated_data, "output/multiomics/integration/integrated.json")
io.write_csv(df, "output/multiomics/integration/samples.csv")
```

### Path Handling
- Always use `metainformant.core.paths` utilities for path operations
- Always resolve and validate paths using `paths.expand_and_resolve()` and `paths.is_within()`

**Pattern**:
```python
from metainformant.core import paths

# Expand and resolve paths
output_path = paths.expand_and_resolve("output/multiomics/integration/")
```

### Type Hints
- Comprehensive type hints throughout
- Use `from __future__ import annotations` for forward references
- Union types: `str | Path | None`

### Data Harmonization
- Accept data from multiple omics modules
- Handle different data formats and scales
- Normalize across platforms

### Joint Analysis
- Use `ml.dimensionality` for joint dimensionality reduction
- Support multiple integration methods (CCA, PCA, NMF)
- Return integrated data structures

### Output Paths
- Base: `output/multiomics/<integration>/`
- Integrated data: `output/multiomics/<integration>/integrated/`
- Visualizations: `output/multiomics/<integration>/plots/`

## Configuration

- No module-specific config (uses core config)
- Output paths default to `output/multiomics/`
- Environment prefix: `MULTI_` (e.g., `MULTI_THREADS`, `MULTI_WORK_DIR`)

## Integration

- **Uses**: All omics modules (`dna`, `rna`, `protein`, `singlecell`)
- **Used by**: Workflow orchestration scripts
- **Integrates with**: All omics modules for cross-platform integration

## Reference

See main `.cursorrules` for:
- Common directory structure and path handling
- Configuration patterns with env overrides
- Testing policy (NO_MOCKING_POLICY)
- Import patterns and code style
- Documentation guidelines

## Testing

- **STRICTLY NO MOCKING**: Test real implementations only (see main `.cursorrules` NO_MOCKING_POLICY)
- Test with real multi-omic datasets from `data/`
- Write test outputs to `output/multiomics/test/` using `tmp_path` fixture
- Test integration methods with known results
- No mocks, fakes, or stubs - use real integration operations


