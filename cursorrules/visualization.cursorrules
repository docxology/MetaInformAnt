# Visualization Module Rules (`metainformant.visualization`)

## Purpose
Plotting and animation utilities for biological data visualization across all domains.

## Dependencies
- **Required**: `core`
- **Optional**: `matplotlib`, `seaborn`, `plotly`

## Source Structure
```
src/metainformant/visualization/
├── composite.py, interactive.py, palettes.py, themes.py
├── analysis/
│   ├── dimred.py, information.py, quality.py, quality_assessment.py
│   ├── quality_omics.py, quality_sequencing.py, statistical.py, timeseries.py
├── genomics/
│   ├── expression.py, genomics.py, networks.py, trees.py
└── plots/
    ├── animations.py, basic.py, general.py, multidim.py, specialized.py
```

## Package Management
- **ALWAYS use `uv`** for all Python package management and environment operations
- Install optional dependencies: `uv add matplotlib seaborn plotly`
- Use `uv run` to execute commands: `uv run pytest`, `uv run metainformant visualization --help`
- **NEVER use `pip` directly**

## Key Submodules

### Basic (`basic`)
- Basic plotting functions
- Line plots, scatter plots, bar plots
- Fundamental visualization utilities

### Statistical (`statistical`)
- Statistical plots
- Distribution plots
- Statistical test visualizations

### Trees (`trees`)
- Phylogenetic tree visualization
- Tree layout and rendering
- Tree manipulation for visualization

**Patterns**:
```python
from metainformant.visualization.genomics import trees

trees.visualize_tree(
    tree=phylogenetic_tree,
    output_path="output/visualization/tree.png"
)
```

### Networks (`networks`)
- Network graph visualization
- Node and edge styling
- Network layout algorithms

### Expression (`expression`)
- Expression data visualization
- Heatmaps for RNA-seq data
- Expression pattern plots

### Genomics (`genomics`)
- Genomic data visualization
- Genome browser-style plots
- Genomic track visualization

### Dimensionality Reduction (`dimred`)
- PCA, t-SNE, UMAP visualizations
- Dimensionality reduction plots
- Embedding visualizations

### Multi-dimensional (`multidim`)
- Multi-dimensional data visualization
- High-dimensional plot projections
- Complex data visualization

### Time Series (`timeseries`)
- Time series plots
- Temporal data visualization
- Time course plots

### Animations (`animations`)
- Animated visualizations
- Time-lapse plots
- Dynamic data visualization

### Interactive (`interactive`)
- Interactive plotting
- Plotly integration
- Interactive data exploration

### Style (`style`)
- Visualization styling
- Color schemes and palettes
- Publication-quality styling

### Layout (`layout`)
- Plot layout utilities
- Multi-panel figure arrangement
- Figure composition

### Export (`export`)
- Figure export utilities
- Format conversion
- High-resolution export

### Domain-Specific Integration Modules
- `gwas_integration.py`: GWAS-specific visualizations
- `information_integration.py`: Information theory visualizations
- `life_events_integration.py`: Life events visualizations
- `singlecell_integration.py`: Single-cell visualizations
- `amalgkit_visualization.py`: Amalgkit workflow visualizations

### Quality (`quality`)
- Quality control visualizations
- QC metric plots
- Data quality assessment plots

### Plots (`plots`)
- General plotting utilities
- Common plot types
- Plotting helpers

## Patterns

### I/O Operations
- **CRITICAL**: Always use `metainformant.core.io` for JSON/CSV/TSV operations (if saving data)
- Never use direct `import json` or `import csv`
- Visualization functions primarily save plots (PNG/SVG/PDF), but may save data via `core.io`

**Pattern**:
```python
from metainformant.core import io

# Save plot data if needed
io.dump_json(plot_data, "output/visualization/plots/data.json")
```

### Path Handling
- Always use `metainformant.core.paths` utilities for path operations
- Always resolve and validate paths using `paths.expand_and_resolve()` and `paths.is_within()`

**Pattern**:
```python
from metainformant.core import paths

# Expand and resolve plot output paths
output_path = paths.expand_and_resolve("output/visualization/plots/")
```

### Type Hints
- Comprehensive type hints throughout
- Use `from __future__ import annotations` for forward references
- Union types: `str | Path | None`

### Output Path Parameter
- All visualization functions accept `output_path` parameter
- Default output format: PNG for static plots
- Support SVG, PDF formats when requested

**Pattern**:
```python
from metainformant.visualization.genomics import trees

trees.visualize_tree(
    tree=phylogenetic_tree,
    output_path="output/visualization/tree.png"
)
```

### Figure Objects
- Return figure objects when interactive inspection needed
- Allow further customization before saving
- Support both static and interactive plots

### Color Schemes
- Use consistent color schemes across plots
- Support colorblind-friendly palettes
- Document color mappings

### Styling
- Consistent styling across all visualizations
- Professional appearance suitable for publications
- Configurable style parameters

### Output Paths
- Base: `output/visualization/<domain>/`
- Domain-specific: `output/visualization/<domain>/<plot_type>/`

## Configuration

- No module-specific config (uses core config)
- Output paths default to `output/visualization/`
- Environment prefix: `VIZ_` (e.g., `VIZ_DPI`, `VIZ_FORMAT`, `VIZ_STYLE`)

## Integration

- **Used by**: All modules (plotting support)
- **Integrates with**: Domain-specific visualization (phylogenetic trees, network graphs)

## Reference

See main `.cursorrules` for:
- Common directory structure and path handling
- Configuration patterns with env overrides
- Testing policy (NO_MOCKING_POLICY)
- Import patterns and code style
- Documentation guidelines

## Testing

- **STRICTLY NO MOCKING**: Test real implementations only (see main `.cursorrules` NO_MOCKING_POLICY)
- Test that output files are created
- Verify plot dimensions and format
- Write test outputs to `output/visualization/test/` using `tmp_path` fixture
- No mocks, fakes, or stubs - use real plotting operations


