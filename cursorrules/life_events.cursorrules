# Life Events Module Rules (`metainformant.life_events`)

## Purpose
Life course event analysis and prediction: event extraction, embedding generation, sequence modeling, and interpretability.

## Dependencies
- **Required**: `core`
- **Optional**: `ml` (sequence models)

## Key Submodules

### Events (`events`)
- Event extraction and analysis
- Event sequence processing
- Temporal patterns

### Embeddings (`embeddings`)
- Event embedding generation
- Configurable embedding methods
- Window-based embeddings

**Patterns**:
```python
from metainformant.life_events import embeddings

embeddings_dict = embeddings.generate_embeddings(
    events=event_sequence,
    embedding_dim=100,
    window_size=5,
    method="skipgram"
)
```

### Models (`models`)
- Sequence models for event prediction
- Classification and regression
- Temporal dependencies

### Interpretability (`interpretability`)
- Model interpretation utilities
- Feature importance
- Event contribution analysis

### Visualization (`visualization`)
- Event timeline visualization
- Sequence plots
- Temporal patterns

### Config (`config`)
- Configuration management
- LifeEventsWorkflowConfig class
- Config validation

### Utils (`utils`)
- Utility functions
- Helper functions for life events
- Common operations

### Workflow (`workflow`)
- End-to-end life events analysis workflows
- Workflow orchestration
- Configuration-based execution

## Patterns

### I/O Operations
- **CRITICAL**: Always use `metainformant.core.io` for JSON/CSV/TSV operations
- Never use direct `import json` or `import csv`

**Pattern**:
```python
from metainformant.core import io

# Save event sequences and embeddings
io.dump_json(sequences, "output/life_events/workflow/sequences.json")
io.dump_json(embeddings, "output/life_events/workflow/embeddings.json")
io.write_csv(df, "output/life_events/workflow/predictions.csv")
```

### Path Handling
- Always use `metainformant.core.paths` utilities for path operations
- Always resolve and validate paths using `paths.expand_and_resolve()` and `paths.is_within()`

**Pattern**:
```python
from metainformant.core import paths

# Expand and resolve paths
work_dir = paths.expand_and_resolve(config.work_dir)
```

### Type Hints
- Comprehensive type hints throughout
- Use `from __future__ import annotations` for forward references
- Union types: `str | Path | None`

### Configuration
- Use `LifeEventsWorkflowConfig` for configuration
- Config files in `config/life_events_template.yaml`
- Environment prefix: `LE_` (e.g., `LE_THREADS`, `LE_EMBEDDING_DIM`)
- Use `metainformant.core.config.load_mapping_from_file()` and `apply_env_overrides()`

**Config Structure**:
```yaml
work_dir: output/life_events/workflow/work
log_dir: output/life_events/workflow/logs
threads: 4
embedding:
  embedding_dim: 100
  window_size: 5
  epochs: 10
  method: "skipgram"
  learning_rate: 0.01
model:
  model_type: "embedding"
  task_type: "classification"
```

### Embeddings
- Embeddings should be configurable (dimension, window size, method)
- Support multiple embedding methods (skipgram, CBOW, etc.)
- Return embedding dictionaries

### Output Paths
- Base: `output/life_events/<workflow>/`
- Embeddings: `output/life_events/<workflow>/embeddings/`
- Models: `output/life_events/<workflow>/models/`
- Visualizations: `output/life_events/<workflow>/plots/`
- Workflows: `output/life_events/<workflow>/work/`

## Integration

- **Used by**: `phenotype` (life course phenotype extraction)
- **Integrates with**: `ml` (sequence models), `visualization` (event timeline plots)

## Reference

See main `.cursorrules` for:
- Common directory structure and path handling
- Configuration patterns with env overrides
- Testing policy (NO_MOCKING_POLICY)
- Import patterns and code style
- Documentation guidelines

## Testing

- **STRICTLY NO MOCKING**: Test real implementations only (see main `.cursorrules` NO_MOCKING_POLICY)
- Test with real event sequences from `data/`
- Write test outputs to `output/life_events/test/` using `tmp_path` fixture
- Test embedding generation with known results
- No mocks, fakes, or stubs - use real computations and file operations


