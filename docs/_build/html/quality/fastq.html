

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FASTQ Quality Analysis &mdash; METAINFORMANT 0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=938c9ccc"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            METAINFORMANT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dna/index.html">DNA: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rna/index.html">RNA: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protein/index.html">Protein: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gwas/index.html">GWAS (Genome-Wide Association Studies)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../epigenome/index.html">Epigenome: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../epigenome/index.html#key-components">Key Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../epigenome/index.html#integration-with-genomics">Integration with Genomics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../epigenome/index.html#analysis-workflows">Analysis Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../epigenome/index.html#planned-extensions">Planned Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ontology/index.html">Ontology Module Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../phenotype/index.html">Phenotype: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ecology/index.html">Ecology: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ecology/index.html#key-components">Key Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ecology/index.html#analysis-workflows">Analysis Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ecology/index.html#integration-with-other-modules">Integration with Other Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ecology/index.html#planned-extensions">Planned Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/index.html">Math: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ml/index.html">Machine Learning: Biological Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networks/index.html">Networks: Biological Network Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../singlecell/index.html">Single-Cell Genomics</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Quality Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/index.html">Visualization: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simulation/index.html">Simulation: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../life_events/index.html">Life Events Module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">METAINFORMANT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">FASTQ Quality Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/quality/fastq.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="fastq-quality-analysis">
<h1>FASTQ Quality Analysis<a class="headerlink" href="#fastq-quality-analysis" title="Link to this heading"></a></h1>
<p>The FASTQ quality analysis module provides quality assessment for high-throughput sequencing data, offering FastQC-like functionality with performance and integration.</p>
<section id="main-analysis-function">
<h2>Main Analysis Function<a class="headerlink" href="#main-analysis-function" title="Link to this heading"></a></h2>
<section id="analyze-fastq-quality">
<h3>analyze_fastq_quality()<a class="headerlink" href="#analyze-fastq-quality" title="Link to this heading"></a></h3>
<p>Perform comprehensive quality analysis on FASTQ files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.quality.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">analyze_fastq_quality</span>

<span class="c1"># Basic analysis</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">analyze_fastq_quality</span><span class="p">(</span><span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">)</span>

<span class="c1"># With custom parameters</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">analyze_fastq_quality</span><span class="p">(</span>
    <span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">,</span>
    <span class="n">subsample_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>      <span class="c1"># Subsample for large files</span>
    <span class="n">quality_encoding</span><span class="o">=</span><span class="s1">&#39;phred33&#39;</span><span class="p">,</span> <span class="c1"># Quality score encoding  </span>
    <span class="n">adapter_sequences</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>     <span class="c1"># Custom adapter sequences</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;output/qc&quot;</span>      <span class="c1"># Output directory</span>
<span class="p">)</span>

<span class="c1"># Print summary</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analysis complete for </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total sequences: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">][</span><span class="s1">&#39;total_sequences&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean quality: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">][</span><span class="s1">&#39;mean_quality&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fastq_path</span></code>: Path to FASTQ file (supports .gz compression)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subsample_size</span></code>: Number of sequences to analyze (None = all)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quality_encoding</span></code>: Quality score encoding (‘phred33’ or ‘phred64’)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">adapter_sequences</span></code>: List of custom adapter sequences to detect</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_dir</span></code>: Directory for output files</p></li>
</ul>
<p><strong>Returns:</strong> Dictionary with comprehensive quality metrics</p>
</section>
</section>
<section id="analysis-modules">
<h2>Analysis Modules<a class="headerlink" href="#analysis-modules" title="Link to this heading"></a></h2>
<section id="basic-statistics">
<h3>Basic Statistics<a class="headerlink" href="#basic-statistics" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.quality.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">basic_statistics</span>

<span class="c1"># Get basic statistics</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">basic_statistics</span><span class="p">(</span><span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="s1">&#39;sample.fastq.gz&#39;</span><span class="p">,</span>
    <span class="s1">&#39;file_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Conventional base calls&#39;</span><span class="p">,</span>
    <span class="s1">&#39;encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;Sanger / Illumina 1.9&#39;</span><span class="p">,</span>
    <span class="s1">&#39;total_sequences&#39;</span><span class="p">:</span> <span class="mi">1500000</span><span class="p">,</span>
    <span class="s1">&#39;filtered_sequences&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;sequence_length&#39;</span><span class="p">:</span> <span class="s1">&#39;151&#39;</span><span class="p">,</span>  <span class="c1"># or range like &quot;35-151&quot;</span>
    <span class="s1">&#39;gc_content&#39;</span><span class="p">:</span> <span class="mf">42.5</span><span class="p">,</span>
    <span class="s1">&#39;n_content&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="s1">&#39;mean_quality&#39;</span><span class="p">:</span> <span class="mf">35.2</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="per-base-quality-scores">
<h3>Per-Base Quality Scores<a class="headerlink" href="#per-base-quality-scores" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.quality.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">per_base_quality</span>

<span class="c1"># Analyze quality scores by position</span>
<span class="n">quality_data</span> <span class="o">=</span> <span class="n">per_base_quality</span><span class="p">(</span><span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quality data shape: </span><span class="si">{</span><span class="n">quality_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># (sequence_length, 6)</span>

<span class="c1"># Columns: position, mean, median, q1, q3, max, min</span>
</pre></div>
</div>
</section>
<section id="per-sequence-quality-scores">
<h3>Per-Sequence Quality Scores<a class="headerlink" href="#per-sequence-quality-scores" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.quality.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">per_sequence_quality</span>

<span class="c1"># Quality score distribution across sequences</span>
<span class="n">seq_quality</span> <span class="o">=</span> <span class="n">per_sequence_quality</span><span class="p">(</span><span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quality bins: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">seq_quality</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Returns dictionary: {quality_score: count}</span>
</pre></div>
</div>
</section>
<section id="sequence-length-distribution">
<h3>Sequence Length Distribution<a class="headerlink" href="#sequence-length-distribution" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.quality.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">sequence_length_distribution</span>

<span class="c1"># Distribution of sequence lengths</span>
<span class="n">length_dist</span> <span class="o">=</span> <span class="n">sequence_length_distribution</span><span class="p">(</span><span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length range: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">length_dist</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">length_dist</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Returns dictionary: {length: count}</span>
</pre></div>
</div>
</section>
<section id="gc-content-distribution">
<h3>GC Content Distribution<a class="headerlink" href="#gc-content-distribution" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.quality.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">gc_content_distribution</span>

<span class="c1"># GC content distribution across sequences</span>
<span class="n">gc_dist</span> <span class="o">=</span> <span class="n">gc_content_distribution</span><span class="p">(</span><span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GC content range: 0-100%&quot;</span><span class="p">)</span>

<span class="c1"># Returns dictionary: {gc_percentage: count}</span>
</pre></div>
</div>
</section>
<section id="adapter-content-analysis">
<h3>Adapter Content Analysis<a class="headerlink" href="#adapter-content-analysis" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.quality.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">adapter_content</span>

<span class="c1"># Detect adapter contamination</span>
<span class="n">adapter_data</span> <span class="o">=</span> <span class="n">adapter_content</span><span class="p">(</span>
    <span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">,</span>
    <span class="n">adapter_sequences</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AGATCGGAAGAG&#39;</span><span class="p">]</span>  <span class="c1"># Illumina adapter</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max adapter content: </span><span class="si">{</span><span class="n">adapter_data</span><span class="p">[</span><span class="s1">&#39;max_adapter_content&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adapter positions: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">adapter_data</span><span class="p">[</span><span class="s1">&#39;position_data&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Position-wise adapter content</span>
<span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">adapters</span> <span class="ow">in</span> <span class="n">adapter_data</span><span class="p">[</span><span class="s1">&#39;position_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">adapters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Built-in Adapters:</strong></p>
<ul class="simple">
<li><p>Illumina Universal Adapter: <code class="docutils literal notranslate"><span class="pre">AGATCGGAAGAG</span></code></p></li>
<li><p>Illumina Small RNA Adapter: <code class="docutils literal notranslate"><span class="pre">TGGAATTCTCGG</span></code></p></li>
<li><p>Nextera Transposase Sequence: <code class="docutils literal notranslate"><span class="pre">CTGTCTCTTATA</span></code></p></li>
</ul>
</section>
<section id="overrepresented-sequences">
<h3>Overrepresented Sequences<a class="headerlink" href="#overrepresented-sequences" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.quality.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">overrepresented_sequences</span>

<span class="c1"># Find highly abundant sequences</span>
<span class="n">overrep</span> <span class="o">=</span> <span class="n">overrepresented_sequences</span><span class="p">(</span>
    <span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>      <span class="c1"># Sequences appearing in &gt;0.1% of reads</span>
    <span class="n">max_sequences</span><span class="o">=</span><span class="mi">20</span>    <span class="c1"># Report top 20 sequences</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">seq_info</span> <span class="ow">in</span> <span class="n">overrep</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sequence: </span><span class="si">{</span><span class="n">seq_info</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">][:</span><span class="mi">30</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Count: </span><span class="si">{</span><span class="n">seq_info</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Percentage: </span><span class="si">{</span><span class="n">seq_info</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Possible source: </span><span class="si">{</span><span class="n">seq_info</span><span class="p">[</span><span class="s1">&#39;possible_source&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="duplication-levels">
<h3>Duplication Levels<a class="headerlink" href="#duplication-levels" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.quality.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">duplication_levels</span>

<span class="c1"># Assess sequence duplication</span>
<span class="n">dup_data</span> <span class="o">=</span> <span class="n">duplication_levels</span><span class="p">(</span><span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unique sequences: </span><span class="si">{</span><span class="n">dup_data</span><span class="p">[</span><span class="s1">&#39;unique_sequences&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate sequences: </span><span class="si">{</span><span class="n">dup_data</span><span class="p">[</span><span class="s1">&#39;duplicate_sequences&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplication percentage: </span><span class="si">{</span><span class="n">dup_data</span><span class="p">[</span><span class="s1">&#39;duplication_percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># Duplication level distribution</span>
<span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">percentage</span> <span class="ow">in</span> <span class="n">dup_data</span><span class="p">[</span><span class="s1">&#39;duplication_levels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">percentage</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="n-content-per-position">
<h3>N Content per Position<a class="headerlink" href="#n-content-per-position" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.quality.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">n_content_per_position</span>

<span class="c1"># Analyze N content across sequence positions</span>
<span class="n">n_content</span> <span class="o">=</span> <span class="n">n_content_per_position</span><span class="p">(</span><span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Positions analyzed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n_content</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max N content: </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">n_content</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># Position-wise N content</span>
<span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">n_pct</span> <span class="ow">in</span> <span class="n">n_content</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">n_pct</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># Report positions with &gt;5% N</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_pct</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">% N&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="quality-score-distribution">
<h3>Quality Score Distribution<a class="headerlink" href="#quality-score-distribution" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.quality.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">quality_score_distribution</span>

<span class="c1"># Overall quality score distribution</span>
<span class="n">qual_dist</span> <span class="o">=</span> <span class="n">quality_score_distribution</span><span class="p">(</span><span class="s2">&quot;sample.fastq.gz&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Quality Score Distribution:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">score</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">qual_dist</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">count</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">qual_dist</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="batch-processing">
<h2>Batch Processing<a class="headerlink" href="#batch-processing" title="Link to this heading"></a></h2>
<section id="multiple-file-analysis">
<h3>Multiple File Analysis<a class="headerlink" href="#multiple-file-analysis" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_multiple_fastq</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;*.fastq.gz&quot;</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;output/qc&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze multiple FASTQ files.&quot;&quot;&quot;</span>
    
    <span class="n">fastq_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">input_dir</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">fastq_file</span> <span class="ow">in</span> <span class="n">fastq_files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analyzing </span><span class="si">{</span><span class="n">fastq_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Analyze each file</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">analyze_fastq_quality</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">fastq_file</span><span class="p">),</span>
            <span class="n">output_dir</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fastq_file</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        
        <span class="n">results</span><span class="p">[</span><span class="n">fastq_file</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
    
    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Batch analyze all FASTQ files</span>
<span class="n">batch_results</span> <span class="o">=</span> <span class="n">analyze_multiple_fastq</span><span class="p">(</span><span class="s2">&quot;data/raw_reads/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="paired-end-analysis">
<h3>Paired-End Analysis<a class="headerlink" href="#paired-end-analysis" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">analyze_paired_end</span><span class="p">(</span><span class="n">r1_file</span><span class="p">,</span> <span class="n">r2_file</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;output/paired_qc&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze paired-end FASTQ files.&quot;&quot;&quot;</span>
    
    <span class="c1"># Analyze R1 and R2 separately</span>
    <span class="n">r1_results</span> <span class="o">=</span> <span class="n">analyze_fastq_quality</span><span class="p">(</span><span class="n">r1_file</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/R1&quot;</span><span class="p">)</span>
    <span class="n">r2_results</span> <span class="o">=</span> <span class="n">analyze_fastq_quality</span><span class="p">(</span><span class="n">r2_file</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/R2&quot;</span><span class="p">)</span>
    
    <span class="c1"># Compare basic statistics</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Paired-End Comparison:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R1 sequences: </span><span class="si">{</span><span class="n">r1_results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">][</span><span class="s1">&#39;total_sequences&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R2 sequences: </span><span class="si">{</span><span class="n">r2_results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">][</span><span class="s1">&#39;total_sequences&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R1 mean quality: </span><span class="si">{</span><span class="n">r1_results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">][</span><span class="s1">&#39;mean_quality&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R2 mean quality: </span><span class="si">{</span><span class="n">r2_results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">][</span><span class="s1">&#39;mean_quality&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;R1&#39;</span><span class="p">:</span> <span class="n">r1_results</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2_results</span><span class="p">}</span>

<span class="c1"># Analyze paired files</span>
<span class="n">paired_results</span> <span class="o">=</span> <span class="n">analyze_paired_end</span><span class="p">(</span>
    <span class="s2">&quot;sample_R1.fastq.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sample_R2.fastq.gz&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="quality-interpretation">
<h2>Quality Interpretation<a class="headerlink" href="#quality-interpretation" title="Link to this heading"></a></h2>
<section id="quality-score-guidelines">
<h3>Quality Score Guidelines<a class="headerlink" href="#quality-score-guidelines" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">interpret_quality_scores</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide interpretation of quality metrics.&quot;&quot;&quot;</span>
    
    <span class="n">mean_quality</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">][</span><span class="s1">&#39;mean_quality&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">mean_quality</span> <span class="o">&gt;=</span> <span class="mi">35</span><span class="p">:</span>
        <span class="n">quality_status</span> <span class="o">=</span> <span class="s2">&quot;Excellent&quot;</span>
    <span class="k">elif</span> <span class="n">mean_quality</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">quality_status</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span>
    <span class="k">elif</span> <span class="n">mean_quality</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">:</span>
        <span class="n">quality_status</span> <span class="o">=</span> <span class="s2">&quot;Acceptable&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">quality_status</span> <span class="o">=</span> <span class="s2">&quot;Poor&quot;</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall Quality: </span><span class="si">{</span><span class="n">quality_status</span><span class="si">}</span><span class="s2"> (Q</span><span class="si">{</span><span class="n">mean_quality</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    
    <span class="c1"># Check for specific issues</span>
    <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;adapter_content&#39;</span><span class="p">][</span><span class="s1">&#39;max_adapter_content&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;High adapter content detected&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">][</span><span class="s1">&#39;n_content&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;High N content&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;duplication_levels&#39;</span><span class="p">][</span><span class="s1">&#39;duplication_percentage&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;High sequence duplication&quot;</span><span class="p">)</span>
    
    <span class="c1"># Check per-base quality</span>
    <span class="n">per_base</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;per_base_quality&#39;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">if</span> <span class="n">per_base</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">25</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">per_base</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Low quality at some positions&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">issues</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Potential Issues:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">issues</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">issue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No major quality issues detected&quot;</span><span class="p">)</span>

<span class="c1"># Interpret results</span>
<span class="n">interpret_quality_scores</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gc-content-assessment">
<h3>GC Content Assessment<a class="headerlink" href="#gc-content-assessment" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">assess_gc_content</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">expected_gc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assess GC content against expected values.&quot;&quot;&quot;</span>
    
    <span class="n">observed_gc</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">][</span><span class="s1">&#39;gc_content&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">expected_gc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Common organism GC contents</span>
        <span class="n">organisms</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;human&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">42</span><span class="p">),</span>
            <span class="s1">&#39;mouse&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">42</span><span class="p">),</span>
            <span class="s1">&#39;yeast&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
            <span class="s1">&#39;e_coli&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">52</span><span class="p">),</span>
            <span class="s1">&#39;arabidopsis&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">37</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Observed GC content: </span><span class="si">{</span><span class="n">observed_gc</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expected ranges for common organisms:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">org</span><span class="p">,</span> <span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span> <span class="ow">in</span> <span class="n">organisms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;✓&quot;</span> <span class="k">if</span> <span class="n">low</span> <span class="o">&lt;=</span> <span class="n">observed_gc</span> <span class="o">&lt;=</span> <span class="n">high</span> <span class="k">else</span> <span class="s2">&quot;✗&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">org</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">low</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">high</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">deviation</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">observed_gc</span> <span class="o">-</span> <span class="n">expected_gc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deviation</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GC content within expected range: </span><span class="si">{</span><span class="n">observed_gc</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% (expected </span><span class="si">{</span><span class="n">expected_gc</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: GC content deviation: </span><span class="si">{</span><span class="n">observed_gc</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% vs expected </span><span class="si">{</span><span class="n">expected_gc</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># Assess GC content</span>
<span class="n">assess_gc_content</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">expected_gc</span><span class="o">=</span><span class="mi">41</span><span class="p">)</span>  <span class="c1"># Human genome</span>
</pre></div>
</div>
</section>
</section>
<section id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Link to this heading"></a></h2>
<section id="quality-plots">
<h3>Quality Plots<a class="headerlink" href="#quality-plots" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_per_base_quality</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot per-base quality scores.&quot;&quot;&quot;</span>
    
    <span class="n">per_base</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;per_base_quality&#39;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">per_base</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No per-base quality data available&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">q1s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">q3s</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">per_base</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
        <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">])</span>
        <span class="n">q1s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q1&#39;</span><span class="p">])</span>
        <span class="n">q3s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q3&#39;</span><span class="p">])</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    
    <span class="c1"># Plot quartile range</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">q1s</span><span class="p">,</span> <span class="n">q3s</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> 
                     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Interquartile Range&#39;</span><span class="p">)</span>
    
    <span class="c1"># Plot mean quality</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Quality&#39;</span><span class="p">)</span>
    
    <span class="c1"># Quality thresholds</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Q30 (99.9</span><span class="si">% a</span><span class="s1">ccuracy)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Q20 (99</span><span class="si">% a</span><span class="s1">ccuracy)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Q10 (90</span><span class="si">% a</span><span class="s1">ccuracy)&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Position in Read&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Quality Score&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Per Base Quality Scores&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_gc_content</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot GC content distribution.&quot;&quot;&quot;</span>
    
    <span class="n">gc_dist</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gc_content_distribution&#39;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">gc_dist</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No GC content distribution data available&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="n">gc_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gc_dist</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gc_dist</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">gc_values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">counts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    
    <span class="c1"># Mark mean GC content</span>
    <span class="n">mean_gc</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">][</span><span class="s1">&#39;gc_content&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_gc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean GC: </span><span class="si">{</span><span class="n">mean_gc</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;GC Content (%)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of Sequences&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;GC Content Distribution&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Generate plots</span>
<span class="n">plot_per_base_quality</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">plot_gc_content</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="advanced-features">
<h2>Advanced Features<a class="headerlink" href="#advanced-features" title="Link to this heading"></a></h2>
<section id="custom-adapter-detection">
<h3>Custom Adapter Detection<a class="headerlink" href="#custom-adapter-detection" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">detect_custom_adapters</span><span class="p">(</span><span class="n">fastq_path</span><span class="p">,</span> <span class="n">adapter_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect custom adapters from a file.&quot;&quot;&quot;</span>
    
    <span class="c1"># Load custom adapters</span>
    <span class="n">custom_adapters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">adapter_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                <span class="n">custom_adapters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    
    <span class="c1"># Run adapter analysis</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">adapter_content</span><span class="p">(</span><span class="n">fastq_path</span><span class="p">,</span> <span class="n">adapter_sequences</span><span class="o">=</span><span class="n">custom_adapters</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Example adapter file format:</span>
<span class="c1"># AGATCGGAAGAGCACACGTCTGAACTCCAGTCA    # Illumina TruSeq</span>
<span class="c1"># AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGT    # Illumina TruSeq R2</span>
<span class="c1"># TGGAATTCTCGGGTGCCAAGG                # Small RNA 3&#39; adapter</span>
</pre></div>
</div>
</section>
<section id="subsampling-large-files">
<h3>Subsampling Large Files<a class="headerlink" href="#subsampling-large-files" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">subsample_analysis</span><span class="p">(</span><span class="n">large_fastq</span><span class="p">,</span> <span class="n">sample_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare quality metrics across different sample sizes.&quot;&quot;&quot;</span>
    
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">sample_sizes</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analyzing </span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> sequences...&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">analyze_fastq_quality</span><span class="p">(</span><span class="n">large_fastq</span><span class="p">,</span> <span class="n">subsample_size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
    
    <span class="c1"># Compare basic statistics</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sample Size Comparison:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size</span><span class="se">\t\t</span><span class="s2">Mean Quality</span><span class="se">\t</span><span class="s2">GC Content</span><span class="se">\t</span><span class="s2">N Content&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\t\t</span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mean_quality&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\t\t</span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;gc_content&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%</span><span class="se">\t\t</span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;n_content&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Compare different sample sizes</span>
<span class="n">subsample_results</span> <span class="o">=</span> <span class="n">subsample_analysis</span><span class="p">(</span><span class="s2">&quot;very_large_file.fastq.gz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="quality-summary-report">
<h3>Quality Summary Report<a class="headerlink" href="#quality-summary-report" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_quality_report</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;quality_report.txt&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a comprehensive text report.&quot;&quot;&quot;</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FASTQ Quality Analysis Report</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Basic statistics</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Basic Statistics:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Filename: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total sequences: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_sequences&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Sequence length: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;sequence_length&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  GC content: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;gc_content&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mean quality: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mean_quality&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Quality assessment</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Quality Assessment:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Adapter content</span>
        <span class="n">adapter</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;adapter_content&#39;</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Max adapter content: </span><span class="si">{</span><span class="n">adapter</span><span class="p">[</span><span class="s1">&#39;max_adapter_content&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Duplication</span>
        <span class="n">dup</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;duplication_levels&#39;</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Sequence duplication: </span><span class="si">{</span><span class="n">dup</span><span class="p">[</span><span class="s1">&#39;duplication_percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># N content</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  N content: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;n_content&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Recommendations</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Recommendations:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mean_quality&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  - Consider quality filtering (low mean quality)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">adapter</span><span class="p">[</span><span class="s1">&#39;max_adapter_content&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  - Adapter trimming recommended</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dup</span><span class="p">[</span><span class="s1">&#39;duplication_percentage&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  - High duplication detected - check for PCR artifacts</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;n_content&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  - High N content - investigate sequencing issues</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mean_quality&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">28</span> <span class="ow">and</span> 
            <span class="n">adapter</span><span class="p">[</span><span class="s1">&#39;max_adapter_content&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">5</span> <span class="ow">and</span>
            <span class="n">dup</span><span class="p">[</span><span class="s1">&#39;duplication_percentage&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">20</span> <span class="ow">and</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;n_content&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  - Data quality appears good for downstream analysis</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Generate report</span>
<span class="n">generate_quality_report</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="performance-optimization">
<h2>Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h2>
<section id="memory-efficient-processing">
<h3>Memory-Efficient Processing<a class="headerlink" href="#memory-efficient-processing" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">analyze_large_fastq_efficient</span><span class="p">(</span><span class="n">fastq_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Memory-efficient analysis of very large FASTQ files.&quot;&quot;&quot;</span>
    
    <span class="c1"># Process in chunks to manage memory</span>
    <span class="n">total_sequences</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">quality_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">gc_sum</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># Initialize accumulators</span>
    <span class="n">per_base_quality</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">sequence_lengths</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># Process file in chunks</span>
    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fastq_path</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">fastq_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.gz&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">open</span><span class="p">(</span><span class="n">fastq_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">sequences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">qualities</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">line_num</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Sequence line</span>
                <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">line_num</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># Quality line</span>
                <span class="n">qualities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                
                <span class="c1"># Process chunk when full</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">chunk_size</span><span class="p">:</span>
                    <span class="n">process_chunk</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">qualities</span><span class="p">,</span> <span class="n">per_base_quality</span><span class="p">,</span> <span class="n">sequence_lengths</span><span class="p">)</span>
                    <span class="n">total_sequences</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span>
                    <span class="n">sequences</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">qualities</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Process final chunk</span>
        <span class="k">if</span> <span class="n">sequences</span><span class="p">:</span>
            <span class="n">process_chunk</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">qualities</span><span class="p">,</span> <span class="n">per_base_quality</span><span class="p">,</span> <span class="n">sequence_lengths</span><span class="p">)</span>
            <span class="n">total_sequences</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="n">total_sequences</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> sequences efficiently&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">process_chunk</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">qualities</span><span class="p">,</span> <span class="n">per_base_acc</span><span class="p">,</span> <span class="n">length_acc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a chunk of sequences.&quot;&quot;&quot;</span>
    <span class="c1"># Implementation would update accumulators</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
</section>
<section id="integration-examples">
<h2>Integration Examples<a class="headerlink" href="#integration-examples" title="Link to this heading"></a></h2>
<section id="pipeline-integration">
<h3>Pipeline Integration<a class="headerlink" href="#pipeline-integration" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">qc_guided_preprocessing</span><span class="p">(</span><span class="n">fastq_file</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;output/processed&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use QC results to guide preprocessing parameters.&quot;&quot;&quot;</span>
    
    <span class="c1"># 1. Run quality control</span>
    <span class="n">qc_results</span> <span class="o">=</span> <span class="n">analyze_fastq_quality</span><span class="p">(</span><span class="n">fastq_file</span><span class="p">)</span>
    
    <span class="c1"># 2. Set parameters based on QC</span>
    <span class="n">mean_qual</span> <span class="o">=</span> <span class="n">qc_results</span><span class="p">[</span><span class="s1">&#39;basic_stats&#39;</span><span class="p">][</span><span class="s1">&#39;mean_quality&#39;</span><span class="p">]</span>
    <span class="n">adapter_content</span> <span class="o">=</span> <span class="n">qc_results</span><span class="p">[</span><span class="s1">&#39;adapter_content&#39;</span><span class="p">][</span><span class="s1">&#39;max_adapter_content&#39;</span><span class="p">]</span>
    
    <span class="c1"># Quality filtering threshold</span>
    <span class="k">if</span> <span class="n">mean_qual</span> <span class="o">&gt;=</span> <span class="mi">35</span><span class="p">:</span>
        <span class="n">min_quality</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="k">elif</span> <span class="n">mean_qual</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">min_quality</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">min_quality</span> <span class="o">=</span> <span class="mi">15</span>
    
    <span class="c1"># Adapter trimming</span>
    <span class="n">trim_adapters</span> <span class="o">=</span> <span class="n">adapter_content</span> <span class="o">&gt;</span> <span class="mi">1</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;QC-guided parameters:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Minimum quality: Q</span><span class="si">{</span><span class="n">min_quality</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Adapter trimming: </span><span class="si">{</span><span class="s1">&#39;Yes&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">trim_adapters</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;No&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># 3. Apply preprocessing with optimized parameters</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.dna.fastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">filter_fastq_quality</span>
    
    <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/filtered_</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">fastq_file</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="n">filtered</span> <span class="o">=</span> <span class="n">filter_fastq_quality</span><span class="p">(</span>
        <span class="n">fastq_file</span><span class="p">,</span>
        <span class="n">output_file</span><span class="p">,</span>
        <span class="n">min_quality</span><span class="o">=</span><span class="n">min_quality</span><span class="p">,</span>
        <span class="n">trim_adapters</span><span class="o">=</span><span class="n">trim_adapters</span>
    <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">filtered</span>

<span class="c1"># Example usage</span>
<span class="n">processed_file</span> <span class="o">=</span> <span class="n">qc_guided_preprocessing</span><span class="p">(</span><span class="s2">&quot;raw_sample.fastq.gz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading"></a></h2>
<p>Comprehensive tests are available in <code class="docutils literal notranslate"><span class="pre">tests/test_quality_fastq.py</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run FASTQ quality tests</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/test_quality_fastq.py<span class="w"> </span>-v

<span class="c1"># Test specific functions</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/test_quality_fastq.py::test_basic_statistics<span class="w"> </span>-v
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/test_quality_fastq.py::test_per_base_quality<span class="w"> </span>-v
</pre></div>
</div>
</section>
<section id="related-documentation">
<h2>Related Documentation<a class="headerlink" href="#related-documentation" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="index.html"><span class="std std-doc">Quality Control Overview</span></a>: Module overview and architecture</p></li>
<li><p><a class="reference internal" href="../dna/fastq.html"><span class="std std-doc">DNA FASTQ Processing</span></a>: FASTQ sequence manipulation</p></li>
<li><p><a class="reference internal" href="../core/io.html"><span class="std std-doc">Core I/O Utilities</span></a>: File handling and compression</p></li>
<li><p><a class="reference internal" href="../visualization/plots.html"><span class="std std-doc">Visualization</span></a>: Quality plot generation</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, METAINFORMANT Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>