

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>amalgkit quant: Transcript Abundance Estimation &mdash; METAINFORMANT 0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=938c9ccc"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            METAINFORMANT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../dna/index.html">DNA: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">RNA: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protein/index.html">Protein: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gwas/index.html">GWAS (Genome-Wide Association Studies)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html">Epigenome: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#key-components">Key Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#integration-with-genomics">Integration with Genomics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#analysis-workflows">Analysis Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#planned-extensions">Planned Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ontology/index.html">Ontology Module Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../phenotype/index.html">Phenotype: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html">Ecology: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#key-components">Key Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#analysis-workflows">Analysis Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#integration-with-other-modules">Integration with Other Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#planned-extensions">Planned Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../math/index.html">Math: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ml/index.html">Machine Learning: Biological Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networks/index.html">Networks: Biological Network Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../singlecell/index.html">Single-Cell Genomics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quality/index.html">Quality Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../visualization/index.html">Visualization: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../simulation/index.html">Simulation: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../life_events/index.html">Life Events Module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../testing.html">Testing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">METAINFORMANT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">amalgkit quant: Transcript Abundance Estimation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/rna/amalgkit/steps/06_quant.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="amalgkit-quant-transcript-abundance-estimation">
<h1>amalgkit quant: Transcript Abundance Estimation<a class="headerlink" href="#amalgkit-quant-transcript-abundance-estimation" title="Link to this heading"></a></h1>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Link to this heading"></a></h2>
<p>Quantifies transcript abundance from FASTQ files using kallisto pseudoalignment. This step performs the <strong>core quantification</strong> of gene expression levels from raw sequencing reads.</p>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">quant</span></code> step:</p>
<ul class="simple">
<li><p>Runs kallisto quant on each FASTQ file</p></li>
<li><p>Performs pseudoalignment to reference transcriptome</p></li>
<li><p>Generates abundance estimates (TPM, counts)</p></li>
<li><p>Optionally builds kallisto indices from FASTA files</p></li>
<li><p>Supports batch processing for HPC environments</p></li>
<li><p>Automatically cleans up FASTQs after successful quantification (configurable)</p></li>
</ul>
</section>
<section id="function-signature">
<h2>Function Signature<a class="headerlink" href="#function-signature" title="Link to this heading"></a></h2>
<section id="python-api">
<h3>Python API<a class="headerlink" href="#python-api" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna</span><span class="w"> </span><span class="kn">import</span> <span class="n">amalgkit</span>

<span class="c1"># High-level wrapper</span>
<span class="k">def</span><span class="w"> </span><span class="nf">quant</span><span class="p">(</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">AmalgkitParams</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="c1"># Step runner (low-level)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna.steps.quant</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_quant</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_quant</span><span class="p">(</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">work_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>See Also</strong>: <a class="reference internal" href="../../API.html#quant"><span class="std std-ref">API Reference</span></a> | <a class="reference internal" href="../FUNCTIONS.html"><span class="std std-doc">Function Index</span></a></p>
</section>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h2>
<section id="basic-usage">
<h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>quant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/amalgkit/work/metadata/pivot_qualified.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--index_dir<span class="w"> </span>output/amalgkit/work/index<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--clean_fastq<span class="w"> </span>yes
</pre></div>
</div>
</section>
<section id="id1">
<h3>Python API<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna</span><span class="w"> </span><span class="kn">import</span> <span class="n">amalgkit</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">amalgkit</span><span class="o">.</span><span class="n">quant</span><span class="p">(</span>
    <span class="n">out_dir</span><span class="o">=</span><span class="s2">&quot;output/amalgkit/work&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="s2">&quot;output/amalgkit/work/metadata/pivot_qualified.tsv&quot;</span><span class="p">,</span>
    <span class="n">index_dir</span><span class="o">=</span><span class="s2">&quot;output/amalgkit/work/index&quot;</span><span class="p">,</span>
    <span class="n">threads</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">clean_fastq</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="configuration-file">
<h3>Configuration File<a class="headerlink" href="#configuration-file" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="nt">quant</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># CRITICAL: out_dir must be work_dir (not separate quant_dir)</span>
<span class="w">    </span><span class="c1"># This allows quant to find getfastq output in {out_dir}/getfastq/</span>
<span class="w">    </span><span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/amellifera/work</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/amellifera/work/metadata/pivot_qualified.tsv</span>
<span class="w">    </span><span class="nt">index_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/amellifera/work/index</span>
<span class="w">    </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="w">    </span><span class="nt">clean_fastq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">build_index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">fasta_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/amellifera/work/fasta</span>
</pre></div>
</div>
</section>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading"></a></h2>
<section id="critical-out-dir-configuration">
<h3>CRITICAL: out_dir Configuration<a class="headerlink" href="#critical-out-dir-configuration" title="Link to this heading"></a></h3>
<p><strong>IMPORTANT</strong>: For <code class="docutils literal notranslate"><span class="pre">amalgkit</span> <span class="pre">quant</span></code>, the <code class="docutils literal notranslate"><span class="pre">out_dir</span></code> parameter should be set to the <code class="docutils literal notranslate"><span class="pre">work_dir</span></code> (not a separate quant directory). This is because:</p>
<ol class="arabic simple">
<li><p><strong>FASTQ Location</strong>: <code class="docutils literal notranslate"><span class="pre">amalgkit</span> <span class="pre">quant</span></code> looks for FASTQ files in <code class="docutils literal notranslate"><span class="pre">{out_dir}/getfastq/{sample_id}/</span></code>. If <code class="docutils literal notranslate"><span class="pre">getfastq</span></code> used <code class="docutils literal notranslate"><span class="pre">out_dir:</span> <span class="pre">output/amalgkit/{species}/fastq</span></code>, then quant’s <code class="docutils literal notranslate"><span class="pre">out_dir</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">work_dir</span></code> so it can find the getfastq output via a symlink or the same directory structure.</p></li>
<li><p><strong>Output Location</strong>: Quantification results are written to <code class="docutils literal notranslate"><span class="pre">{out_dir}/quant/{sample_id}/abundance.tsv</span></code>. If <code class="docutils literal notranslate"><span class="pre">out_dir</span></code> is <code class="docutils literal notranslate"><span class="pre">work_dir</span></code>, results will be in <code class="docutils literal notranslate"><span class="pre">work_dir/quant/</span></code>.</p></li>
<li><p><strong>Path Resolution</strong>: Setting <code class="docutils literal notranslate"><span class="pre">out_dir</span></code> to <code class="docutils literal notranslate"><span class="pre">work_dir</span></code> ensures that all workflow steps can find files in expected locations relative to the working directory.</p></li>
</ol>
<p><strong>Correct Configuration</strong>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="nt">quant</span><span class="p">:</span>
<span class="w">    </span><span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/{species}/work</span><span class="w">  </span><span class="c1"># ← Use work_dir, not separate quant_dir</span>
<span class="w">    </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span>
</pre></div>
</div>
<p><strong>Incorrect Configuration</strong> (will fail to find FASTQ files):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="nt">quant</span><span class="p">:</span>
<span class="w">    </span><span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/{species}/quant</span><span class="w">  </span><span class="c1"># ← WRONG: quant can&#39;t find getfastq output</span>
<span class="w">    </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span>
</pre></div>
</div>
</section>
<section id="optional-parameters">
<h3>Optional Parameters<a class="headerlink" href="#optional-parameters" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--out_dir</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./</span></code></p></td>
<td><p>Directory for intermediate and output files. <strong>Should be set to <code class="docutils literal notranslate"><span class="pre">work_dir</span></code></strong> (not a separate quant directory) so quant can find getfastq output in <code class="docutils literal notranslate"><span class="pre">{out_dir}/getfastq/</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--metadata</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">inferred</span></code></p></td>
<td><p>Path to metadata.tsv. Default: <code class="docutils literal notranslate"><span class="pre">out_dir/metadata/metadata.tsv</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--threads</span></code></p></td>
<td><p>INT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p>Number of threads for kallisto.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--redo</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">no</span></code></p></td>
<td><p>Re-quantify even if output exists.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--batch</span></code></p></td>
<td><p>INT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Process only one SRA record (1-based index). For HPC array jobs.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--index_dir</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Path to directory containing kallisto index files. Required if not <code class="docutils literal notranslate"><span class="pre">out_dir/index/</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--clean_fastq</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yes</span></code></p></td>
<td><p><strong>Remove FASTQ files</strong> after successful quantification. Saves massive disk space!</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--fasta_dir</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">inferred</span></code></p></td>
<td><p>Path to reference transcriptome FASTA files. Default: <code class="docutils literal notranslate"><span class="pre">out_dir/fasta</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--build_index</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">no</span></code></p></td>
<td><p>Build kallisto index from FASTA if index doesn’t exist.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="input-requirements">
<h2>Input Requirements<a class="headerlink" href="#input-requirements" title="Link to this heading"></a></h2>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>FASTQ Files</strong>: From <code class="docutils literal notranslate"><span class="pre">amalgkit</span> <span class="pre">getfastq</span></code> (in <code class="docutils literal notranslate"><span class="pre">{out_dir}/getfastq/{sample_id}/</span></code>)</p>
<ul>
<li><p><strong>Path Resolution</strong>: <code class="docutils literal notranslate"><span class="pre">amalgkit</span> <span class="pre">quant</span></code> looks for FASTQ files in <code class="docutils literal notranslate"><span class="pre">{out_dir}/getfastq/{sample_id}/</span></code> relative to its <code class="docutils literal notranslate"><span class="pre">out_dir</span></code> parameter</p></li>
<li><p><strong>Critical</strong>: If <code class="docutils literal notranslate"><span class="pre">getfastq</span></code> used <code class="docutils literal notranslate"><span class="pre">out_dir:</span> <span class="pre">output/amalgkit/{species}/fastq</span></code>, then quant’s <code class="docutils literal notranslate"><span class="pre">out_dir</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">work_dir</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">output/amalgkit/{species}/work</span></code>) so it can find the getfastq output</p></li>
<li><p>The workflow may create symlinks from <code class="docutils literal notranslate"><span class="pre">{work_dir}/getfastq/</span></code> to <code class="docutils literal notranslate"><span class="pre">{fastq_dir}/getfastq/</span></code> to ensure quant can find the files</p></li>
</ul>
</li>
<li><p><strong>Kallisto Index</strong>: Pre-built index for the species OR FASTA file with <code class="docutils literal notranslate"><span class="pre">--build_index</span> <span class="pre">yes</span></code></p>
<ul>
<li><p>Index location: <code class="docutils literal notranslate"><span class="pre">{out_dir}/index/{Scientific_Name}_transcripts.idx</span></code></p></li>
<li><p>FASTA location: <code class="docutils literal notranslate"><span class="pre">{out_dir}/fasta/{Scientific_Name}_rna.fasta</span></code></p></li>
</ul>
</li>
<li><p><strong>kallisto</strong>: Installed and available on PATH</p></li>
</ul>
</section>
<section id="kallisto-index-requirements">
<h3>Kallisto Index Requirements<a class="headerlink" href="#kallisto-index-requirements" title="Link to this heading"></a></h3>
<p><strong>Option 1: Pre-built Index</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Index files must be named:</span>
<span class="c1"># {Scientific_Name}_transcripts.idx</span>
<span class="c1"># Example: Apis_mellifera_transcripts.idx</span>

mkdir<span class="w"> </span>-p<span class="w"> </span>output/amalgkit/work/index
<span class="c1"># Place index file in this directory</span>
</pre></div>
</div>
<p><strong>Option 2: Build from FASTA</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># FASTA files must be named:</span>
<span class="c1"># {Scientific_Name}*.fasta or {Scientific_Name}*.fa</span>
<span class="c1"># Example: Apis_mellifera_transcripts.fasta</span>

mkdir<span class="w"> </span>-p<span class="w"> </span>output/amalgkit/work/fasta
<span class="c1"># Place FASTA file in this directory</span>

<span class="c1"># Enable index building</span>
--build_index<span class="w"> </span>yes<span class="w"> </span>--fasta_dir<span class="w"> </span>output/amalgkit/work/fasta
</pre></div>
</div>
<p><strong>Option 3: Automated Genome Setup (Recommended)</strong></p>
<p>METAINFORMANT provides automated scripts to download genomes, prepare transcriptomes, and build kallisto indexes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Complete setup for all species</span>
python3<span class="w"> </span>scripts/rna/orchestrate_genome_setup.py

<span class="c1"># Or step-by-step:</span>
python3<span class="w"> </span>scripts/rna/verify_genomes_and_indexes.py<span class="w">        </span><span class="c1"># Check status</span>
python3<span class="w"> </span>scripts/rna/download_missing_genomes.py<span class="w">          </span><span class="c1"># Download genomes</span>
python3<span class="w"> </span>scripts/rna/prepare_transcriptomes.py<span class="w">            </span><span class="c1"># Prepare FASTA</span>
python3<span class="w"> </span>scripts/rna/build_kallisto_indexes.py<span class="w">           </span><span class="c1"># Build indexes</span>
</pre></div>
</div>
<p>These scripts automatically:</p>
<ul class="simple">
<li><p>Download genome packages from NCBI (best-effort: CLI → API → FTP)</p></li>
<li><p>Extract RNA FASTA files from downloaded genomes</p></li>
<li><p>Prepare transcriptome FASTA files in the correct location</p></li>
<li><p>Build kallisto indexes with proper naming</p></li>
</ul>
<p><strong>See Also:</strong></p>
<ul class="simple">
<li><p><strong><a class="reference internal" href="../genome_preparation.html"><span class="std std-doc">genome_preparation.md</span></a></strong>: Technical documentation for automatic index building</p></li>
<li><p><strong><a class="reference internal" href="../genome_setup_guide.html"><span class="std std-doc">genome_setup_guide.md</span></a></strong>: Complete step-by-step guide for genome setup</p></li>
<li><p><strong><a class="reference internal" href="../commands.html"><span class="std std-doc">commands.md</span></a></strong>: Command reference for all genome setup scripts</p></li>
</ul>
<p>The workflow execution in <code class="docutils literal notranslate"><span class="pre">metainformant.rna.workflow</span></code> automatically integrates genome preparation when <code class="docutils literal notranslate"><span class="pre">build_index:</span> <span class="pre">yes</span></code> is set in the quant configuration. See <a class="reference internal" href="../genome_preparation.html"><span class="std std-doc">genome_preparation.md</span></a> for details on automatic workflow integration.</p>
</section>
<section id="system-dependencies">
<h3>System Dependencies<a class="headerlink" href="#system-dependencies" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Tool</p></th>
<th class="head"><p>Purpose</p></th>
<th class="head"><p>Installation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>kallisto</strong></p></td>
<td><p>Pseudoalignment &amp; quantification</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">bioconda</span> <span class="pre">kallisto</span></code> or <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">kallisto</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="reference-transcriptome-sources">
<h3>Reference Transcriptome Sources<a class="headerlink" href="#reference-transcriptome-sources" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>NCBI RefSeq</strong>: https://ftp.ncbi.nlm.nih.gov/genomes/refseq/</p></li>
<li><p><strong>Ensembl</strong>: https://ftp.ensembl.org/pub/</p></li>
<li><p><strong>NCBI Datasets</strong>: <code class="docutils literal notranslate"><span class="pre">datasets</span> <span class="pre">download</span> <span class="pre">genome</span> <span class="pre">taxon</span> <span class="pre">&lt;TAXON_ID&gt;</span> <span class="pre">--include</span> <span class="pre">rna</span></code></p></li>
</ul>
</section>
</section>
<section id="output-files">
<h2>Output Files<a class="headerlink" href="#output-files" title="Link to this heading"></a></h2>
<section id="directory-structure">
<h3>Directory Structure<a class="headerlink" href="#directory-structure" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>out_dir/quant/
└── SRR12345678/
    ├── abundance.tsv               # ⭐ Transcript-level abundance estimates
    ├── abundance.h5                 # HDF5 format abundance
    ├── run_info.json                # Kallisto run information
    └── kallisto_output.log          # Kallisto stdout/stderr
</pre></div>
</div>
</section>
<section id="primary-output-abundance-tsv">
<h3>Primary Output: <code class="docutils literal notranslate"><span class="pre">abundance.tsv</span></code><a class="headerlink" href="#primary-output-abundance-tsv" title="Link to this heading"></a></h3>
<p>Tab-delimited file with columns:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">target_id</span></code></p></td>
<td><p>Transcript ID (from reference FASTA)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></td>
<td><p>Transcript length (bp)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">eff_length</span></code></p></td>
<td><p>Effective length (accounts for fragment distribution)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">est_counts</span></code></p></td>
<td><p>Estimated read counts</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">tpm</span></code></p></td>
<td><p>Transcripts Per Million (normalized expression)</p></td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">target_id</span>               <span class="n">length</span>  <span class="n">eff_length</span>  <span class="n">est_counts</span>  <span class="n">tpm</span>
<span class="n">XM_006566778</span><span class="mf">.3</span>          <span class="mi">1821</span>    <span class="mf">1672.00</span>     <span class="mf">1234.00</span>     <span class="mf">15.23</span>
<span class="n">XM_006566779</span><span class="mf">.2</span>          <span class="mi">2145</span>    <span class="mf">1996.00</span>     <span class="mf">567.50</span>      <span class="mf">5.87</span>
<span class="n">XM_006566780</span><span class="mf">.1</span>          <span class="mi">987</span>     <span class="mf">838.00</span>      <span class="mf">89.00</span>       <span class="mf">2.19</span>
</pre></div>
</div>
</section>
<section id="run-information-run-info-json">
<h3>Run Information: <code class="docutils literal notranslate"><span class="pre">run_info.json</span></code><a class="headerlink" href="#run-information-run-info-json" title="Link to this heading"></a></h3>
<p>JSON file with quantification metadata:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;n_targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20672</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;n_bootstraps&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;n_processed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5876543</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;n_pseudoaligned&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3789012</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;n_unique&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3245678</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;p_pseudoaligned&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">64.5</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;p_unique&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">55.2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;kallisto_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.46.2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;index_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;start_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Thu Oct 24 21:17:56 2024&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;call&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kallisto quant ...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Key Metrics</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n_processed</span></code>: Total reads processed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_pseudoaligned</span></code>: Reads successfully aligned</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_pseudoaligned</span></code>: <strong>Alignment rate</strong> (%)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p_unique</span></code>: Unique alignment rate (%)</p></li>
</ul>
</section>
</section>
<section id="workflow-integration">
<h2>Workflow Integration<a class="headerlink" href="#workflow-integration" title="Link to this heading"></a></h2>
<section id="position-in-pipeline">
<h3>Position in Pipeline<a class="headerlink" href="#position-in-pipeline" title="Link to this heading"></a></h3>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>flowchart LR
    A[getfastq] --&gt; B[integrate]
    B --&gt; C[quant]
    C --&gt; D[merge]
</pre></div>
</div>
<p><strong>quant</strong> runs <strong>after getfastq/integrate</strong>, <strong>before merge</strong>.</p>
</section>
<section id="downstream-dependencies">
<h3>Downstream Dependencies<a class="headerlink" href="#downstream-dependencies" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Step</p></th>
<th class="head"><p>Dependency</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">merge</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">abundance.tsv</span></code> files</p></td>
<td><p>Combines all samples into expression matrix</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">curate</span></code></p></td>
<td><p>Merged matrix</p></td>
<td><p>QC and batch correction</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Link to this heading"></a></h2>
<section id="runtime">
<h3>Runtime<a class="headerlink" href="#runtime" title="Link to this heading"></a></h3>
<p><strong>Per Sample</strong> (typical 5M-20M reads):</p>
<ul class="simple">
<li><p><strong>Single-end, 8 threads</strong>: 2-5 minutes</p></li>
<li><p><strong>Paired-end, 8 threads</strong>: 5-10 minutes</p></li>
<li><p><strong>Large sample (50M+ reads)</strong>: 15-30 minutes</p></li>
</ul>
<p><strong>For 100 Samples</strong>:</p>
<ul class="simple">
<li><p><strong>Serial</strong>: 8-16 hours</p></li>
<li><p><strong>Parallel</strong> (10 concurrent): 1-2 hours</p></li>
<li><p><strong>HPC array</strong>: 10-30 minutes (all samples simultaneously)</p></li>
</ul>
</section>
<section id="resource-usage">
<h3>Resource Usage<a class="headerlink" href="#resource-usage" title="Link to this heading"></a></h3>
<p><strong>Per Sample</strong>:</p>
<ul class="simple">
<li><p><strong>CPU</strong>: Scales well up to 8-16 threads</p></li>
<li><p><strong>Memory</strong>: 4-8GB (depends on index size)</p></li>
<li><p><strong>Disk I/O</strong>: Heavy read from FASTQs</p></li>
</ul>
<p><strong>Index Loading</strong>:</p>
<ul class="simple">
<li><p>Index is loaded into memory once per run</p></li>
<li><p>~2-4GB RAM for typical transcriptome</p></li>
</ul>
</section>
<section id="parallelization-strategies">
<h3>Parallelization Strategies<a class="headerlink" href="#parallelization-strategies" title="Link to this heading"></a></h3>
<p><strong>Strategy 1: Multi-threading per sample</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good for single-sample processing</span>
--threads<span class="w"> </span><span class="m">16</span>
</pre></div>
</div>
<p><strong>Strategy 2: Multiple samples in parallel</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Better for many samples: run 4 samples × 4 threads each</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..4<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>amalgkit<span class="w"> </span>quant<span class="w"> </span>--batch<span class="w"> </span><span class="nv">$i</span><span class="w"> </span>--threads<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="p">&amp;</span>
<span class="k">done</span>
<span class="nb">wait</span>
</pre></div>
</div>
<p><strong>Strategy 3: HPC Array Jobs</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Best: Process all samples simultaneously on cluster</span>
sbatch<span class="w"> </span>--array<span class="o">=</span><span class="m">1</span>-100<span class="w"> </span>quant_job.sh
<span class="c1"># Each job: --batch ${SLURM_ARRAY_TASK_ID} --threads 8</span>
</pre></div>
</div>
</section>
</section>
<section id="common-use-cases">
<h2>Common Use Cases<a class="headerlink" href="#common-use-cases" title="Link to this heading"></a></h2>
<section id="quantify-all-samples">
<h3>1. Quantify All Samples<a class="headerlink" href="#quantify-all-samples" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>quant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/amalgkit/work/metadata/pivot_qualified.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--index_dir<span class="w"> </span>output/amalgkit/work/index<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--clean_fastq<span class="w"> </span>yes
</pre></div>
</div>
<p><strong>Result</strong>: Quantifies all samples, removes FASTQs to save space</p>
</section>
<section id="build-index-and-quantify">
<h3>2. Build Index and Quantify<a class="headerlink" href="#build-index-and-quantify" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># First time with new species</span>
amalgkit<span class="w"> </span>quant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/amalgkit/work/metadata/pivot_qualified.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--fasta_dir<span class="w"> </span>output/amalgkit/work/fasta<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--build_index<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">12</span>
</pre></div>
</div>
<p><strong>Result</strong>: Builds kallisto index, then quantifies all samples</p>
</section>
<section id="re-quantify-failed-samples">
<h3>3. Re-quantify Failed Samples<a class="headerlink" href="#re-quantify-failed-samples" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get list of samples without abundance files</span>
<span class="c1"># Then re-run</span>
amalgkit<span class="w"> </span>quant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>failed_samples.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--redo<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
</section>
<section id="hpc-array-job">
<h3>4. HPC Array Job<a class="headerlink" href="#hpc-array-job" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># SLURM job script</span>
<span class="c1">#SBATCH --array=1-100</span>
<span class="c1">#SBATCH --cpus-per-task=8</span>
<span class="c1">#SBATCH --mem=8G</span>
<span class="c1">#SBATCH --time=1:00:00</span>

amalgkit<span class="w"> </span>quant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--batch<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_ARRAY_TASK_ID</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--clean_fastq<span class="w"> </span>yes
</pre></div>
</div>
<p><strong>Result</strong>: 100 samples quantified in parallel, ~1 hour total</p>
</section>
<section id="keep-fastqs-for-later-analysis">
<h3>5. Keep FASTQs for Later Analysis<a class="headerlink" href="#keep-fastqs-for-later-analysis" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t delete FASTQs</span>
amalgkit<span class="w"> </span>quant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--clean_fastq<span class="w"> </span>no
</pre></div>
</div>
<p><strong>Warning</strong>: Requires substantial disk space!</p>
</section>
</section>
<section id="kallisto-index-building">
<h2>Kallisto Index Building<a class="headerlink" href="#kallisto-index-building" title="Link to this heading"></a></h2>
<section id="automatic-index-building">
<h3>Automatic Index Building<a class="headerlink" href="#automatic-index-building" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># amalgkit will build index if:</span>
<span class="c1"># 1. --build_index yes</span>
<span class="c1"># 2. Index doesn&#39;t exist at index_dir/{Species_Name}_transcripts.idx</span>
<span class="c1"># 3. FASTA exists at fasta_dir/{Species_Name}*.fasta</span>

amalgkit<span class="w"> </span>quant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--fasta_dir<span class="w"> </span>output/work/fasta<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--build_index<span class="w"> </span>yes
</pre></div>
</div>
</section>
<section id="manual-index-building">
<h3>Manual Index Building<a class="headerlink" href="#manual-index-building" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build index manually for more control</span>
kallisto<span class="w"> </span>index<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-i<span class="w"> </span>output/work/index/Apis_mellifera_transcripts.idx<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-k<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>output/work/fasta/Apis_mellifera_rna.fasta

<span class="c1"># Then quantify</span>
amalgkit<span class="w"> </span>quant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--index_dir<span class="w"> </span>output/work/index
</pre></div>
</div>
<p><strong>Recommended k-mer size</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-k</span> <span class="pre">31</span></code>: Standard (reads ≥100bp)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-k</span> <span class="pre">23</span></code>: Short reads (&lt;100bp)</p></li>
</ul>
</section>
<section id="index-naming-convention">
<h3>Index Naming Convention<a class="headerlink" href="#index-naming-convention" title="Link to this heading"></a></h3>
<p><strong>CRITICAL</strong>: Index files must match species name in metadata:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Species in metadata</p></th>
<th class="head"><p>Expected index filename</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Apis</span> <span class="pre">mellifera</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Apis_mellifera_transcripts.idx</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Pogonomyrmex</span> <span class="pre">barbatus</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Pogonomyrmex_barbatus_transcripts.idx</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Drosophila</span> <span class="pre">melanogaster</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Drosophila_melanogaster_transcripts.idx</span></code></p></td>
</tr>
</tbody>
</table>
<p><strong>Pattern</strong>: Replace spaces with underscores, append <code class="docutils literal notranslate"><span class="pre">_transcripts.idx</span></code></p>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<section id="issue-kallisto-command-not-found">
<h3>Issue: “kallisto: command not found”<a class="headerlink" href="#issue-kallisto-command-not-found" title="Link to this heading"></a></h3>
<p><strong>Solutions</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install kallisto (system tool)</span>
conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>bioconda<span class="w"> </span>kallisto
<span class="c1"># Or using system package manager:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>kallisto

<span class="c1"># Verify installation</span>
which<span class="w"> </span>kallisto
kallisto<span class="w"> </span>version

<span class="c1"># Note: For Python packages, use uv pip install (primary method)</span>
</pre></div>
</div>
</section>
<section id="issue-index-file-not-found">
<h3>Issue: Index file not found<a class="headerlink" href="#issue-index-file-not-found" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">index</span> <span class="n">file</span>
</pre></div>
</div>
<p><strong>Diagnosis</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check index directory</span>
ls<span class="w"> </span>-lh<span class="w"> </span>output/amalgkit/work/index/

<span class="c1"># Check species name in metadata</span>
cut<span class="w"> </span>-f2<span class="w"> </span>output/amalgkit/work/metadata/pivot_qualified.tsv<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-u
<span class="c1"># Should match index filename (with spaces → underscores)</span>
</pre></div>
</div>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Build index:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>quant<span class="w"> </span>--build_index<span class="w"> </span>yes<span class="w"> </span>--fasta_dir<span class="w"> </span>output/work/fasta
</pre></div>
</div>
</li>
<li><p>Download pre-built index and place in correct location:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>Apis_mellifera_transcripts.idx<span class="w"> </span>output/work/index/
</pre></div>
</div>
</li>
<li><p>Specify index directory explicitly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--index_dir<span class="w"> </span>/path/to/indices
</pre></div>
</div>
</li>
</ol>
</section>
<section id="issue-low-alignment-rate">
<h3>Issue: Low alignment rate<a class="headerlink" href="#issue-low-alignment-rate" title="Link to this heading"></a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;p_pseudoaligned&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">15.2</span><span class="w">  </span><span class="c1">// &lt;30% is concerning</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Causes</strong>:</p>
<ol class="arabic simple">
<li><p>Wrong reference transcriptome (different species/version)</p></li>
<li><p>Low-quality sequencing data</p></li>
<li><p>Contamination from other organisms</p></li>
<li><p>Incorrect library type</p></li>
</ol>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Verify reference matches species:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check what&#39;s in your index</span>
grep<span class="w"> </span><span class="s2">&quot;^&gt;&quot;</span><span class="w"> </span>output/work/fasta/Apis_mellifera_rna.fasta<span class="w"> </span><span class="p">|</span><span class="w"> </span>head
</pre></div>
</div>
</li>
<li><p>Check FASTQ quality:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inspect fastp reports</span>
cat<span class="w"> </span>output/work/getfastq/SRR*/fastp.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;total_reads&quot;</span>
</pre></div>
</div>
</li>
<li><p>Try different reference version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download different annotation release</span>
datasets<span class="w"> </span>download<span class="w"> </span>genome<span class="w"> </span>taxon<span class="w"> </span><span class="m">7460</span><span class="w"> </span>--include<span class="w"> </span>rna
</pre></div>
</div>
</li>
</ol>
</section>
<section id="issue-out-of-memory">
<h3>Issue: Out of memory<a class="headerlink" href="#issue-out-of-memory" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kallisto</span><span class="p">:</span> <span class="n">std</span><span class="p">::</span><span class="n">bad_alloc</span>
</pre></div>
</div>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Increase memory allocation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --mem=16G  # Instead of 8G</span>
</pre></div>
</div>
</li>
<li><p>Reduce number of concurrent jobs</p></li>
<li><p>Use smaller index (subset of transcriptome)</p></li>
</ol>
</section>
<section id="issue-fastq-files-missing">
<h3>Issue: FASTQ files missing<a class="headerlink" href="#issue-fastq-files-missing" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">FASTQ</span> <span class="n">files</span> <span class="k">for</span> <span class="n">SRR12345678</span>
</pre></div>
</div>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Verify getfastq completed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>output/work/getfastq/SRR12345678/
</pre></div>
</div>
</li>
<li><p>Check if already cleaned (from previous quant run):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if abundance files exist</span>
ls<span class="w"> </span>output/work/quant/SRR12345678/abundance.tsv
<span class="c1"># FASTQs deleted after successful quant with --clean_fastq yes</span>
</pre></div>
</div>
</li>
<li><p>Re-run getfastq:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>getfastq<span class="w"> </span>--id<span class="w"> </span>SRR12345678<span class="w"> </span>--out_dir<span class="w"> </span>output/work
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="automatic-fastq-cleanup-after-quantification">
<h2>Automatic FASTQ Cleanup After Quantification<a class="headerlink" href="#automatic-fastq-cleanup-after-quantification" title="Link to this heading"></a></h2>
<p>The workflow automatically deletes FASTQ files after successful quantification to free disk space. This behavior is controlled by the <code class="docutils literal notranslate"><span class="pre">keep_fastq</span></code> parameter in the quant configuration.</p>
<section id="automatic-cleanup-in-workflow">
<h3>Automatic Cleanup in Workflow<a class="headerlink" href="#automatic-cleanup-in-workflow" title="Link to this heading"></a></h3>
<p>When using the METAINFORMANT workflow (<code class="docutils literal notranslate"><span class="pre">execute_workflow()</span></code> or <code class="docutils literal notranslate"><span class="pre">run_workflow.py</span></code>), FASTQ files are automatically deleted after quantification:</p>
<ol class="arabic simple">
<li><p><strong>Download</strong>: Sample FASTQ files are downloaded via <code class="docutils literal notranslate"><span class="pre">getfastq</span></code></p></li>
<li><p><strong>Quantify</strong>: Sample is quantified using <code class="docutils literal notranslate"><span class="pre">quantify_sample()</span></code> from <code class="docutils literal notranslate"><span class="pre">metainformant.rna.steps.quant</span></code></p></li>
<li><p><strong>Delete</strong>: FASTQ files are automatically deleted using <code class="docutils literal notranslate"><span class="pre">delete_sample_fastqs()</span></code> from <code class="docutils literal notranslate"><span class="pre">metainformant.rna.steps.getfastq</span></code></p></li>
</ol>
<p>This per-sample workflow ensures maximum disk efficiency - only one sample’s FASTQ files exist at any time.</p>
</section>
<section id="manual-cleanup">
<h3>Manual Cleanup<a class="headerlink" href="#manual-cleanup" title="Link to this heading"></a></h3>
<p>For manual processing or recovery of individual samples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna.steps.quant</span><span class="w"> </span><span class="kn">import</span> <span class="n">quantify_sample</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna.steps.getfastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">delete_sample_fastqs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Quantify sample</span>
<span class="n">success</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">abundance_path</span> <span class="o">=</span> <span class="n">quantify_sample</span><span class="p">(</span>
    <span class="n">sample_id</span><span class="o">=</span><span class="s2">&quot;SRR14740514&quot;</span><span class="p">,</span>
    <span class="n">metadata_rows</span><span class="o">=</span><span class="n">sample_rows</span><span class="p">,</span>
    <span class="n">quant_params</span><span class="o">=</span><span class="n">quant_params</span><span class="p">,</span>
    <span class="n">log_dir</span><span class="o">=</span><span class="n">log_dir</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Delete FASTQ files after successful quantification</span>
<span class="k">if</span> <span class="n">success</span> <span class="ow">and</span> <span class="n">abundance_path</span> <span class="ow">and</span> <span class="n">abundance_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">fastq_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;output/amalgkit/pogonomyrmex_barbatus/fastq&quot;</span><span class="p">)</span>
    <span class="n">delete_sample_fastqs</span><span class="p">(</span><span class="s2">&quot;SRR14740514&quot;</span><span class="p">,</span> <span class="n">fastq_dir</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Test Script</strong>: Use <code class="docutils literal notranslate"><span class="pre">scripts/rna/test_quantify_sample.py</span></code> for complete per-sample processing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>scripts/rna/test_quantify_sample.py<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--sample<span class="w"> </span>SRR14740514<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--config<span class="w"> </span>config/amalgkit/amalgkit_pogonomyrmex_barbatus.yaml
</pre></div>
</div>
<p>This script:</p>
<ol class="arabic simple">
<li><p>Quantifies the sample against the kallisto index</p></li>
<li><p>Verifies the abundance.tsv file was created</p></li>
<li><p>Deletes the FASTQ files</p></li>
<li><p>Confirms deletion was successful</p></li>
</ol>
</section>
<section id="batch-cleanup">
<h3>Batch Cleanup<a class="headerlink" href="#batch-cleanup" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">cleanup_unquantified_samples()</span></code> function in <code class="docutils literal notranslate"><span class="pre">metainformant.rna.orchestration</span></code> processes all downloaded but unquantified samples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna.orchestration</span><span class="w"> </span><span class="kn">import</span> <span class="n">cleanup_unquantified_samples</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;config/amalgkit/amalgkit_pogonomyrmex_barbatus.yaml&quot;</span><span class="p">)</span>
<span class="n">quantified</span><span class="p">,</span> <span class="n">failed</span> <span class="o">=</span> <span class="n">cleanup_unquantified_samples</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
</pre></div>
</div>
<p>This function:</p>
<ul class="simple">
<li><p>Finds all samples with FASTQ files but no quantification results</p></li>
<li><p>Quantifies each sample using <code class="docutils literal notranslate"><span class="pre">quantify_sample()</span></code></p></li>
<li><p>Deletes FASTQ files after successful quantification</p></li>
<li><p>Returns counts of quantified and failed samples</p></li>
</ul>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h2>
<section id="always-clean-fastqs-after-quantification">
<h3>1. Always Clean FASTQs After Quantification<a class="headerlink" href="#always-clean-fastqs-after-quantification" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good: Save massive disk space</span>
--clean_fastq<span class="w"> </span>yes

<span class="c1"># Bad: Wastes 100s of GBs</span>
--clean_fastq<span class="w"> </span>no
</pre></div>
</div>
<p><strong>Reasoning</strong>: FASTQ files are 10-50GB per sample. After quantification, you only need the ~1MB abundance.tsv files.</p>
<p><strong>Automatic Behavior</strong>: The METAINFORMANT workflow automatically deletes FASTQ files after quantification when using <code class="docutils literal notranslate"><span class="pre">run_download_quant_workflow()</span></code> or <code class="docutils literal notranslate"><span class="pre">execute_workflow()</span></code>. No manual cleanup needed.</p>
</section>
<section id="verify-reference-transcriptome">
<h3>2. Verify Reference Transcriptome<a class="headerlink" href="#verify-reference-transcriptome" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Before quantifying 100s of samples, test with one</span>
amalgkit<span class="w"> </span>quant<span class="w"> </span>--batch<span class="w"> </span><span class="m">1</span><span class="w"> </span>--threads<span class="w"> </span><span class="m">8</span>

<span class="c1"># Check alignment rate</span>
cat<span class="w"> </span>output/work/quant/SRR*/run_info.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;p_pseudoaligned&quot;</span>

<span class="c1"># Good: &gt;60%</span>
<span class="c1"># Acceptable: 40-60%</span>
<span class="c1"># Concerning: &lt;40% (check reference)</span>
</pre></div>
</div>
</section>
<section id="use-appropriate-threading">
<h3>3. Use Appropriate Threading<a class="headerlink" href="#use-appropriate-threading" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Single sample: use all cores</span>
--threads<span class="w"> </span><span class="m">16</span>

<span class="c1"># Multiple samples in parallel: divide cores</span>
<span class="c1"># 4 samples × 4 threads = 16 cores total</span>
</pre></div>
</div>
</section>
<section id="monitor-quantification-progress">
<h3>4. Monitor Quantification Progress<a class="headerlink" href="#monitor-quantification-progress" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check how many samples completed</span>
find<span class="w"> </span>output/work/quant<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;abundance.tsv&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l

<span class="c1"># Check for failed samples</span>
find<span class="w"> </span>output/work/quant<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>dir<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$dir</span><span class="s2">/abundance.tsv&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Failed: </span><span class="nv">$dir</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="k">done</span>
</pre></div>
</div>
</section>
<section id="archive-abundance-files">
<h3>5. Archive Abundance Files<a class="headerlink" href="#archive-abundance-files" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># After successful merge, archive quant outputs</span>
tar<span class="w"> </span>-czf<span class="w"> </span>quant_outputs_<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>.tar.gz<span class="w"> </span>output/work/quant/
</pre></div>
</div>
</section>
</section>
<section id="real-world-examples">
<h2>Real-World Examples<a class="headerlink" href="#real-world-examples" title="Link to this heading"></a></h2>
<section id="example-1-apis-mellifera-83-samples">
<h3>Example 1: Apis mellifera (83 Samples)<a class="headerlink" href="#example-1-apis-mellifera-83-samples" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># With pre-built index</span>
amalgkit<span class="w"> </span>quant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/amellifera/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/amalgkit/amellifera/work/metadata/pivot_qualified.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--index_dir<span class="w"> </span>output/amalgkit/amellifera/work/index<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--clean_fastq<span class="w"> </span>yes
</pre></div>
</div>
<p><strong>Result</strong>:</p>
<ul class="simple">
<li><p>83 samples quantified in ~8 hours (serial)</p></li>
<li><p>Average alignment rate: 64.5%</p></li>
<li><p>Average transcripts: 20,672 per sample</p></li>
<li><p>Disk space saved: ~350GB (FASTQs deleted)</p></li>
</ul>
</section>
<section id="example-2-pogonomyrmex-barbatus-120-samples-hpc">
<h3>Example 2: Pogonomyrmex barbatus (120 Samples, HPC)<a class="headerlink" href="#example-2-pogonomyrmex-barbatus-120-samples-hpc" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Submit array job</span>
sbatch<span class="w"> </span>--array<span class="o">=</span><span class="m">1</span>-120<span class="w"> </span>--cpus-per-task<span class="o">=</span><span class="m">8</span><span class="w"> </span>--mem<span class="o">=</span>8G<span class="w"> </span>quant.sh

<span class="c1"># In quant.sh:</span>
amalgkit<span class="w"> </span>quant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/pbarbatus/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--batch<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_ARRAY_TASK_ID</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--clean_fastq<span class="w"> </span>yes
</pre></div>
</div>
<p><strong>Result</strong>:</p>
<ul class="simple">
<li><p>All 120 samples completed in 30 minutes</p></li>
<li><p>Parallel processing on HPC cluster</p></li>
<li><p>No disk space issues (FASTQs cleaned immediately)</p></li>
</ul>
</section>
<section id="example-3-first-time-species-setup">
<h3>Example 3: First-time Species Setup<a class="headerlink" href="#example-3-first-time-species-setup" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download reference</span>
datasets<span class="w"> </span>download<span class="w"> </span>genome<span class="w"> </span>taxon<span class="w"> </span><span class="m">7460</span><span class="w"> </span>--include<span class="w"> </span>rna
unzip<span class="w"> </span>ncbi_dataset.zip
mv<span class="w"> </span>ncbi_dataset/data/*/rna.fna<span class="w"> </span>output/work/fasta/Apis_mellifera_rna.fasta

<span class="c1"># Build index and quantify</span>
amalgkit<span class="w"> </span>quant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--fasta_dir<span class="w"> </span>output/work/fasta<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--build_index<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">12</span>
</pre></div>
</div>
<p><strong>Result</strong>: Index built once, reused for all samples</p>
</section>
</section>
<section id="integration-with-metainformant-workflow">
<h2>Integration with METAINFORMANT Workflow<a class="headerlink" href="#integration-with-metainformant-workflow" title="Link to this heading"></a></h2>
<section id="automatic-execution">
<h3>Automatic Execution<a class="headerlink" href="#automatic-execution" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna.workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">execute_workflow</span><span class="p">,</span> <span class="n">load_workflow_config</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">load_workflow_config</span><span class="p">(</span><span class="s2">&quot;config/amalgkit_amellifera.yaml&quot;</span><span class="p">)</span>
<span class="n">execute_workflow</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>  <span class="c1"># quant runs automatically after getfastq/integrate</span>
</pre></div>
</div>
</section>
<section id="genome-preparation-integration">
<h3>Genome Preparation Integration<a class="headerlink" href="#genome-preparation-integration" title="Link to this heading"></a></h3>
<p>METAINFORMANT workflow automatically handles transcriptome preparation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># From src/metainformant/rna/workflow.py</span>
<span class="c1"># Automatic steps:</span>
<span class="c1"># 1. Download genome from NCBI if accession provided</span>
<span class="c1"># 2. Extract RNA FASTA</span>
<span class="c1"># 3. Build kallisto index</span>
<span class="c1"># 4. Run quantification</span>
</pre></div>
</div>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># config/amalgkit_amellifera.yaml</span>
<span class="nt">genome</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accession</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GCF_003254395.2</span>
<span class="w">  </span><span class="nt">include</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rna</span>

<span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="nt">quant</span><span class="p">:</span>
<span class="w">    </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="w">    </span><span class="nt">clean_fastq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">build_index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>
</div>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>kallisto</strong>: https://pachterlab.github.io/kallisto/</p></li>
<li><p><strong>kallisto paper</strong>: https://www.nature.com/articles/nbt.3519</p></li>
<li><p><strong>Pseudoalignment</strong>: https://pachterlab.github.io/kallisto/about</p></li>
<li><p><strong>METAINFORMANT Workflow</strong>: <code class="docutils literal notranslate"><span class="pre">docs/rna/workflow.md</span></code></p></li>
</ul>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<section id="related-steps">
<h3>Related Steps<a class="headerlink" href="#related-steps" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong><a class="reference internal" href="#getfastq.md"><span class="xref myst">getfastq.md</span></a></strong> - Previous: Download FASTQ files</p></li>
<li><p><strong><a class="reference internal" href="#merge.md"><span class="xref myst">merge.md</span></a></strong> - Next: Merge quantification results</p></li>
</ul>
</section>
<section id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong><a class="reference internal" href="../../API.html#quant"><span class="std std-ref">API Reference</span></a></strong> - Complete function documentation</p></li>
<li><p><strong><a class="reference internal" href="../FUNCTIONS.html"><span class="std std-doc">Function Index</span></a></strong> - Quick function lookup</p></li>
<li><p><strong><a class="reference internal" href="../amalgkit.html"><span class="std std-doc">Pipeline Overview</span></a></strong> - Complete pipeline documentation</p></li>
<li><p><strong><a class="reference internal" href="README.html"><span class="std std-doc">Steps Index</span></a></strong> - All step documentation</p></li>
<li><p><strong><a class="reference internal" href="../../workflow.html"><span class="std std-doc">Workflow Guide</span></a></strong> - Workflow planning and execution</p></li>
<li><p><strong><a class="reference internal" href="../../README.html"><span class="std std-doc">Main Index</span></a></strong> - RNA domain master index</p></li>
</ul>
<hr class="docutils" />
<p><strong>Last Updated</strong>: October 29, 2025<br />
<strong>AMALGKIT Version</strong>: 0.12.19<br />
<strong>kallisto Version</strong>: 0.46.2+<br />
<strong>Status</strong>: ✅ Production-ready, comprehensively tested</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, METAINFORMANT Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>