

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>amalgkit merge: Transcript Abundance Table Generation &mdash; METAINFORMANT 0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=938c9ccc"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            METAINFORMANT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../dna/index.html">DNA: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">RNA: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protein/index.html">Protein: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gwas/index.html">GWAS (Genome-Wide Association Studies)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html">Epigenome: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#key-components">Key Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#integration-with-genomics">Integration with Genomics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#analysis-workflows">Analysis Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#planned-extensions">Planned Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ontology/index.html">Ontology Module Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../phenotype/index.html">Phenotype: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html">Ecology: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#key-components">Key Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#analysis-workflows">Analysis Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#integration-with-other-modules">Integration with Other Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#planned-extensions">Planned Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../math/index.html">Math: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ml/index.html">Machine Learning: Biological Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networks/index.html">Networks: Biological Network Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../singlecell/index.html">Single-Cell Genomics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quality/index.html">Quality Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../visualization/index.html">Visualization: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../simulation/index.html">Simulation: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../life_events/index.html">Life Events Module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../testing.html">Testing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">METAINFORMANT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">amalgkit merge: Transcript Abundance Table Generation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/rna/amalgkit/steps/07_merge.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="amalgkit-merge-transcript-abundance-table-generation">
<h1>amalgkit merge: Transcript Abundance Table Generation<a class="headerlink" href="#amalgkit-merge-transcript-abundance-table-generation" title="Link to this heading"></a></h1>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Link to this heading"></a></h2>
<p>Combines individual sample abundance estimates into unified expression matrices. This step <strong>aggregates</strong> all quantification results into analysis-ready data tables.</p>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">merge</span></code> step:</p>
<ul class="simple">
<li><p>Collects <code class="docutils literal notranslate"><span class="pre">abundance.tsv</span></code> files from all quantified samples</p></li>
<li><p>Generates unified expression matrices</p></li>
<li><p>Produces multiple output formats (counts, TPM, effective lengths)</p></li>
<li><p>Handles missing samples gracefully</p></li>
<li><p>Creates sample-by-transcript matrices</p></li>
</ul>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h2>
<section id="basic-usage">
<h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>merge<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/amalgkit/work/metadata/pivot_qualified.tsv
</pre></div>
</div>
</section>
<section id="python-api">
<h3>Python API<a class="headerlink" href="#python-api" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna</span><span class="w"> </span><span class="kn">import</span> <span class="n">amalgkit</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">amalgkit</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">out_dir</span><span class="o">=</span><span class="s2">&quot;output/amalgkit/work&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="s2">&quot;output/amalgkit/work/metadata/pivot_qualified.tsv&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="configuration-file">
<h3>Configuration File<a class="headerlink" href="#configuration-file" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="nt">merge</span><span class="p">:</span>
<span class="w">    </span><span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/amellifera/work</span>
<span class="w">    </span><span class="nt">out</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/amellifera/merged/merged_abundance.tsv</span>
<span class="w">    </span><span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/amellifera/merged</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/amellifera/work/metadata/pivot_qualified.tsv</span>
</pre></div>
</div>
</section>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading"></a></h2>
<section id="optional-parameters">
<h3>Optional Parameters<a class="headerlink" href="#optional-parameters" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--out_dir</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./</span></code></p></td>
<td><p>Directory for intermediate and output files.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--metadata</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">inferred</span></code></p></td>
<td><p>Path to metadata.tsv. Default: <code class="docutils literal notranslate"><span class="pre">out_dir/metadata/metadata.tsv</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="input-requirements">
<h2>Input Requirements<a class="headerlink" href="#input-requirements" title="Link to this heading"></a></h2>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Quantification Results</strong>: <code class="docutils literal notranslate"><span class="pre">abundance.tsv</span></code> files from <code class="docutils literal notranslate"><span class="pre">amalgkit</span> <span class="pre">quant</span></code> (in <code class="docutils literal notranslate"><span class="pre">out_dir/quant/SRR*/</span></code>)</p></li>
<li><p><strong>Metadata Table</strong>: Sample metadata with SRA IDs</p></li>
</ul>
</section>
<section id="expected-input-structure">
<h3>Expected Input Structure<a class="headerlink" href="#expected-input-structure" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>out_dir/quant/
├── SRR12345678/
│   └── abundance.tsv
├── SRR12345679/
│   └── abundance.tsv
└── SRR12345680/
    └── abundance.tsv
</pre></div>
</div>
</section>
</section>
<section id="output-files">
<h2>Output Files<a class="headerlink" href="#output-files" title="Link to this heading"></a></h2>
<section id="directory-structure">
<h3>Directory Structure<a class="headerlink" href="#directory-structure" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>out_dir/merge/
└── {Scientific_Name}/
    ├── {Scientific_Name}_tc.tsv              # ⭐ Estimated counts matrix
    ├── {Scientific_Name}_tpm.tsv             # ⭐ TPM (normalized) matrix
    ├── {Scientific_Name}_eff_len.tsv         # Effective lengths matrix
    ├── {Scientific_Name}_sample_info.tsv     # Sample metadata
    └── merge_summary.txt                     # Merge statistics
</pre></div>
</div>
</section>
<section id="primary-outputs">
<h3>Primary Outputs<a class="headerlink" href="#primary-outputs" title="Link to this heading"></a></h3>
<p><strong>1. Counts Matrix (<code class="docutils literal notranslate"><span class="pre">_tc.tsv</span></code>)</strong></p>
<p>Tab-delimited matrix with estimated read counts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transcript_id</span>       <span class="n">SRR12345678</span>  <span class="n">SRR12345679</span>  <span class="n">SRR12345680</span>
<span class="n">XM_006566778</span><span class="mf">.3</span>      <span class="mf">1234.00</span>      <span class="mf">2456.50</span>      <span class="mf">987.25</span>
<span class="n">XM_006566779</span><span class="mf">.2</span>      <span class="mf">567.50</span>       <span class="mf">1123.75</span>      <span class="mf">445.00</span>
<span class="n">XM_006566780</span><span class="mf">.1</span>      <span class="mf">89.00</span>        <span class="mf">178.50</span>       <span class="mf">71.25</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Rows: Transcripts</p></li>
<li><p>Columns: Samples (SRA IDs)</p></li>
<li><p>Values: Estimated read counts</p></li>
</ul>
<p><strong>2. TPM Matrix (<code class="docutils literal notranslate"><span class="pre">_tpm.tsv</span></code>)</strong></p>
<p>Transcripts Per Million (normalized expression):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transcript_id</span>       <span class="n">SRR12345678</span>  <span class="n">SRR12345679</span>  <span class="n">SRR12345680</span>
<span class="n">XM_006566778</span><span class="mf">.3</span>      <span class="mf">15.23</span>        <span class="mf">18.45</span>        <span class="mf">12.89</span>
<span class="n">XM_006566779</span><span class="mf">.2</span>      <span class="mf">5.87</span>         <span class="mf">6.23</span>         <span class="mf">4.95</span>
<span class="n">XM_006566780</span><span class="mf">.1</span>      <span class="mf">2.19</span>         <span class="mf">2.78</span>         <span class="mf">1.87</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Rows: Transcripts</p></li>
<li><p>Columns: Samples</p></li>
<li><p>Values: TPM (normalized, comparable across samples)</p></li>
</ul>
<p><strong>3. Effective Length Matrix (<code class="docutils literal notranslate"><span class="pre">_eff_len.tsv</span></code>)</strong></p>
<p>Effective transcript lengths (accounts for fragment distribution):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transcript_id</span>       <span class="n">SRR12345678</span>  <span class="n">SRR12345679</span>  <span class="n">SRR12345680</span>
<span class="n">XM_006566778</span><span class="mf">.3</span>      <span class="mf">1672.00</span>      <span class="mf">1672.00</span>      <span class="mf">1672.00</span>
<span class="n">XM_006566779</span><span class="mf">.2</span>      <span class="mf">1996.00</span>      <span class="mf">1996.00</span>      <span class="mf">1996.00</span>
<span class="n">XM_006566780</span><span class="mf">.1</span>      <span class="mf">838.00</span>       <span class="mf">838.00</span>       <span class="mf">838.00</span>
</pre></div>
</div>
<p><strong>4. Sample Information (<code class="docutils literal notranslate"><span class="pre">_sample_info.tsv</span></code>)</strong></p>
<p>Metadata for merged samples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample_id</span>       <span class="n">scientific_name</span>     <span class="n">sample_group</span>  <span class="n">n_reads</span>     <span class="n">p_aligned</span>
<span class="n">SRR12345678</span>     <span class="n">Apis</span> <span class="n">mellifera</span>      <span class="n">brain</span>         <span class="mi">5876543</span>     <span class="mf">64.5</span>
<span class="n">SRR12345679</span>     <span class="n">Apis</span> <span class="n">mellifera</span>      <span class="n">brain</span>         <span class="mi">6123456</span>     <span class="mf">67.2</span>
<span class="n">SRR12345680</span>     <span class="n">Apis</span> <span class="n">mellifera</span>      <span class="n">brain</span>         <span class="mi">5234567</span>     <span class="mf">62.8</span>
</pre></div>
</div>
</section>
</section>
<section id="workflow-integration">
<h2>Workflow Integration<a class="headerlink" href="#workflow-integration" title="Link to this heading"></a></h2>
<section id="position-in-pipeline">
<h3>Position in Pipeline<a class="headerlink" href="#position-in-pipeline" title="Link to this heading"></a></h3>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>flowchart LR
    A[quant] --&gt; B[merge]
    B --&gt; C[curate]
    B --&gt; D[cstmm]
</pre></div>
</div>
<p><strong>merge</strong> runs <strong>after quant</strong>, <strong>before curate/cstmm</strong>.</p>
</section>
<section id="downstream-dependencies">
<h3>Downstream Dependencies<a class="headerlink" href="#downstream-dependencies" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Step</p></th>
<th class="head"><p>Uses</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">curate</span></code></p></td>
<td><p>TPM and counts matrices</p></td>
<td><p>QC, outlier removal, batch correction</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cstmm</span></code></p></td>
<td><p>Counts matrix</p></td>
<td><p>Cross-species TMM normalization</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">csca</span></code></p></td>
<td><p>Curated matrices</p></td>
<td><p>Cross-species correlation analysis</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="matrix-formats">
<h2>Matrix Formats<a class="headerlink" href="#matrix-formats" title="Link to this heading"></a></h2>
<section id="counts-vs-tpm">
<h3>Counts vs TPM<a class="headerlink" href="#counts-vs-tpm" title="Link to this heading"></a></h3>
<p><strong>Counts (<code class="docutils literal notranslate"><span class="pre">_tc.tsv</span></code>)</strong>:</p>
<ul class="simple">
<li><p>Raw estimated read counts</p></li>
<li><p>Use for: Differential expression (DESeq2, edgeR)</p></li>
<li><p>Not normalized across samples</p></li>
<li><p>Integer-like values (kallisto estimates can be fractional)</p></li>
</ul>
<p><strong>TPM (<code class="docutils literal notranslate"><span class="pre">_tpm.tsv</span></code>)</strong>:</p>
<ul class="simple">
<li><p>Transcripts Per Million</p></li>
<li><p>Use for: Cross-sample comparison, visualization, clustering</p></li>
<li><p>Normalized for transcript length and sequencing depth</p></li>
<li><p>Directly comparable across samples</p></li>
</ul>
<p><strong>Relationship</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>TPM_i = (count_i / eff_length_i) / sum(count_j / eff_length_j) × 10^6
</pre></div>
</div>
</section>
<section id="when-to-use-each">
<h3>When to Use Each<a class="headerlink" href="#when-to-use-each" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Analysis</p></th>
<th class="head"><p>Use</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Differential expression</strong></p></td>
<td><p>Counts (<code class="docutils literal notranslate"><span class="pre">_tc.tsv</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Visualization</strong></p></td>
<td><p>TPM (<code class="docutils literal notranslate"><span class="pre">_tpm.tsv</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><strong>Clustering/PCA</strong></p></td>
<td><p>TPM (<code class="docutils literal notranslate"><span class="pre">_tpm.tsv</span></code>) or log2(TPM+1)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Cross-sample comparison</strong></p></td>
<td><p>TPM (<code class="docutils literal notranslate"><span class="pre">_tpm.tsv</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><strong>GSEA/pathway analysis</strong></p></td>
<td><p>TPM (<code class="docutils literal notranslate"><span class="pre">_tpm.tsv</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Cross-species</strong></p></td>
<td><p>Counts → TMM normalization (via <code class="docutils literal notranslate"><span class="pre">cstmm</span></code>)</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Link to this heading"></a></h2>
<section id="runtime">
<h3>Runtime<a class="headerlink" href="#runtime" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Small datasets</strong> (&lt;10 samples): &lt;1 second</p></li>
<li><p><strong>Medium datasets</strong> (10-100 samples): 1-10 seconds</p></li>
<li><p><strong>Large datasets</strong> (100-1000 samples): 10-60 seconds</p></li>
<li><p><strong>Very large datasets</strong> (&gt;1000 samples): 1-5 minutes</p></li>
</ul>
</section>
<section id="memory-usage">
<h3>Memory Usage<a class="headerlink" href="#memory-usage" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Minimal: &lt;500MB for most datasets</p></li>
<li><p>Scales with (# transcripts) × (# samples)</p></li>
</ul>
</section>
<section id="disk-space">
<h3>Disk Space<a class="headerlink" href="#disk-space" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Per species</strong>: 10-100MB for matrices</p></li>
<li><p>Depends on # transcripts and # samples</p></li>
</ul>
</section>
</section>
<section id="common-use-cases">
<h2>Common Use Cases<a class="headerlink" href="#common-use-cases" title="Link to this heading"></a></h2>
<section id="standard-merge">
<h3>1. Standard Merge<a class="headerlink" href="#standard-merge" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge all quantified samples</span>
amalgkit<span class="w"> </span>merge<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/amellifera/work
</pre></div>
</div>
<p><strong>Result</strong>: Generates counts, TPM, and effective length matrices</p>
</section>
<section id="merge-specific-sample-set">
<h3>2. Merge Specific Sample Set<a class="headerlink" href="#merge-specific-sample-set" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge only selected samples</span>
amalgkit<span class="w"> </span>merge<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/amalgkit/work/metadata/pivot_selected.tsv
</pre></div>
</div>
<p><strong>Result</strong>: Merges only samples listed in pivot_selected.tsv</p>
</section>
<section id="merge-multiple-species">
<h3>3. Merge Multiple Species<a class="headerlink" href="#merge-multiple-species" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For each species</span>
<span class="k">for</span><span class="w"> </span>species<span class="w"> </span><span class="k">in</span><span class="w"> </span>amellifera<span class="w"> </span>pbarbatus<span class="w"> </span>cfloridanus<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>amalgkit<span class="w"> </span>merge<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--out_dir<span class="w"> </span>output/amalgkit/<span class="si">${</span><span class="nv">species</span><span class="si">}</span>/work<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--metadata<span class="w"> </span>output/amalgkit/<span class="si">${</span><span class="nv">species</span><span class="si">}</span>/work/metadata/pivot_qualified.tsv
<span class="k">done</span>
</pre></div>
</div>
<p><strong>Result</strong>: Separate matrices for each species</p>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<section id="issue-no-abundance-files-found">
<h3>Issue: No abundance files found<a class="headerlink" href="#issue-no-abundance-files-found" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span> <span class="n">No</span> <span class="n">abundance</span><span class="o">.</span><span class="n">tsv</span> <span class="n">files</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">quant</span> <span class="n">directory</span>
</pre></div>
</div>
<p><strong>Diagnosis</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if quant completed</span>
find<span class="w"> </span>output/work/quant<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;abundance.tsv&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<span class="c1"># Should be &gt; 0</span>
</pre></div>
</div>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Run quant step first:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>quant<span class="w"> </span>--out_dir<span class="w"> </span>output/work
</pre></div>
</div>
</li>
<li><p>Verify quant output structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>output/work/quant/*/abundance.tsv
</pre></div>
</div>
</li>
<li><p>Check metadata for correct SRA IDs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cut<span class="w"> </span>-f1<span class="w"> </span>output/work/metadata/pivot_qualified.tsv
</pre></div>
</div>
</li>
</ol>
</section>
<section id="issue-missing-samples-in-matrix">
<h3>Issue: Missing samples in matrix<a class="headerlink" href="#issue-missing-samples-in-matrix" title="Link to this heading"></a></h3>
<p><strong>Diagnosis</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Count samples in metadata</span>
wc<span class="w"> </span>-l<span class="w"> </span>output/work/metadata/pivot_qualified.tsv
<span class="c1"># vs samples in matrix (columns)</span>
head<span class="w"> </span>-1<span class="w"> </span>output/work/merge/Species_name/Species_name_tc.tsv<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;\t&#39;</span><span class="w"> </span><span class="s1">&#39;\n&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
</pre></div>
</div>
<p><strong>Causes</strong>:</p>
<ol class="arabic simple">
<li><p>Quant failed for some samples</p></li>
<li><p>Samples removed due to low quality</p></li>
<li><p>Metadata doesn’t match quant outputs</p></li>
</ol>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Check which samples have quant outputs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>output/work/quant/
</pre></div>
</div>
</li>
<li><p>Identify missing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cut<span class="w"> </span>-f1<span class="w"> </span>output/work/metadata/pivot_qualified.tsv<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>srr<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;output/work/quant/</span><span class="nv">$srr</span><span class="s2">/abundance.tsv&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Missing: </span><span class="nv">$srr</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="k">done</span>
</pre></div>
</div>
</li>
<li><p>Re-quantify missing samples:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create metadata with only missing samples</span>
amalgkit<span class="w"> </span>quant<span class="w"> </span>--metadata<span class="w"> </span>missing_samples.tsv
amalgkit<span class="w"> </span>merge<span class="w">  </span><span class="c1"># Re-merge</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="issue-transcript-id-mismatch">
<h3>Issue: Transcript ID mismatch<a class="headerlink" href="#issue-transcript-id-mismatch" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">Warning</span><span class="p">:</span> <span class="n">Some</span> <span class="n">transcripts</span> <span class="ow">not</span> <span class="n">found</span> <span class="ow">in</span> <span class="nb">all</span> <span class="n">samples</span>
</pre></div>
</div>
<p><strong>Causes</strong>:</p>
<ol class="arabic simple">
<li><p>Different index versions used for different samples</p></li>
<li><p>Index updated mid-analysis</p></li>
</ol>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Re-quantify all samples with same index:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>quant<span class="w"> </span>--redo<span class="w"> </span>yes<span class="w"> </span>--index_dir<span class="w"> </span>output/work/index
amalgkit<span class="w"> </span>merge
</pre></div>
</div>
</li>
<li><p>Verify index consistency:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check all samples used same index</span>
grep<span class="w"> </span><span class="s2">&quot;index_version&quot;</span><span class="w"> </span>output/work/quant/*/run_info.json
</pre></div>
</div>
</li>
</ol>
</section>
<section id="issue-empty-matrix-generated">
<h3>Issue: Empty matrix generated<a class="headerlink" href="#issue-empty-matrix-generated" title="Link to this heading"></a></h3>
<p><strong>Diagnosis</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check matrix size</span>
wc<span class="w"> </span>-l<span class="w"> </span>output/work/merge/Species_name/Species_name_tc.tsv
<span class="c1"># Should show # transcripts + 1 header</span>
</pre></div>
</div>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Check abundance files aren’t empty:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wc<span class="w"> </span>-l<span class="w"> </span>output/work/quant/*/abundance.tsv
</pre></div>
</div>
</li>
<li><p>Verify samples passed quality filters:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>output/work/quant/*/run_info.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;p_pseudoaligned&quot;</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h2>
<section id="verify-merge-completeness">
<h3>1. Verify Merge Completeness<a class="headerlink" href="#verify-merge-completeness" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check all expected samples are present</span>
head<span class="w"> </span>-1<span class="w"> </span>output/work/merge/Species_name/Species_name_tc.tsv<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;\t&#39;</span><span class="w"> </span><span class="s1">&#39;\n&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span>+2<span class="w"> </span>&gt;<span class="w"> </span>merged_samples.txt
cut<span class="w"> </span>-f1<span class="w"> </span>output/work/metadata/pivot_qualified.tsv<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span>+2<span class="w"> </span>&gt;<span class="w"> </span>expected_samples.txt
diff<span class="w"> </span>merged_samples.txt<span class="w"> </span>expected_samples.txt
</pre></div>
</div>
</section>
<section id="inspect-matrix-dimensions">
<h3>2. Inspect Matrix Dimensions<a class="headerlink" href="#inspect-matrix-dimensions" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check matrix size</span>
wc<span class="w"> </span>-l<span class="w"> </span>output/work/merge/Species_name/Species_name_tc.tsv
<span class="c1"># Rows = # transcripts + 1 header</span>

head<span class="w"> </span>-1<span class="w"> </span>output/work/merge/Species_name/Species_name_tc.tsv<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;\t&#39;</span><span class="w"> </span><span class="s1">&#39;\n&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<span class="c1"># Columns = # samples + 1 transcript_id</span>
</pre></div>
</div>
</section>
<section id="validate-expression-values">
<h3>3. Validate Expression Values<a class="headerlink" href="#validate-expression-values" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check for reasonable values</span>
head<span class="w"> </span>-20<span class="w"> </span>output/work/merge/Species_name/Species_name_tpm.tsv

<span class="c1"># Check for missing values (should be none)</span>
grep<span class="w"> </span><span class="s2">&quot;NA\|NaN&quot;</span><span class="w"> </span>output/work/merge/Species_name/Species_name_tpm.tsv
</pre></div>
</div>
</section>
<section id="compare-with-individual-samples">
<h3>4. Compare with Individual Samples<a class="headerlink" href="#compare-with-individual-samples" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verify a sample&#39;s values match</span>
<span class="nv">sample</span><span class="o">=</span><span class="s2">&quot;SRR12345678&quot;</span>
<span class="nv">transcript</span><span class="o">=</span><span class="s2">&quot;XM_006566778.3&quot;</span>

<span class="c1"># From original abundance.tsv</span>
grep<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$transcript</span><span class="s2">&quot;</span><span class="w"> </span>output/work/quant/<span class="nv">$sample</span>/abundance.tsv

<span class="c1"># From merged matrix</span>
grep<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$transcript</span><span class="s2">&quot;</span><span class="w"> </span>output/work/merge/Species_name/Species_name_tc.tsv<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f2
<span class="c1"># Should match est_counts from abundance.tsv</span>
</pre></div>
</div>
</section>
</section>
<section id="real-world-examples">
<h2>Real-World Examples<a class="headerlink" href="#real-world-examples" title="Link to this heading"></a></h2>
<section id="example-1-apis-mellifera-83-samples">
<h3>Example 1: Apis mellifera (83 Samples)<a class="headerlink" href="#example-1-apis-mellifera-83-samples" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>merge<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/amellifera/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/amalgkit/amellifera/work/metadata/pivot_qualified.tsv
</pre></div>
</div>
<p><strong>Result</strong>:</p>
<ul class="simple">
<li><p>Generated matrices: 83 samples × 20,672 transcripts</p></li>
<li><p>Counts matrix: 10.2 MB</p></li>
<li><p>TPM matrix: 10.5 MB</p></li>
<li><p>Runtime: 5 seconds</p></li>
</ul>
</section>
<section id="example-2-multi-species-analysis">
<h3>Example 2: Multi-Species Analysis<a class="headerlink" href="#example-2-multi-species-analysis" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge each species separately</span>
<span class="nv">species_list</span><span class="o">=</span><span class="s2">&quot;amellifera pbarbatus cfloridanus dmelanogaster linepithema&quot;</span>

<span class="k">for</span><span class="w"> </span>species<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$species_list</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Merging </span><span class="nv">$species</span><span class="s2">...&quot;</span>
<span class="w">    </span>amalgkit<span class="w"> </span>merge<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--out_dir<span class="w"> </span>output/amalgkit/<span class="si">${</span><span class="nv">species</span><span class="si">}</span>/work<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--metadata<span class="w"> </span>output/amalgkit/<span class="si">${</span><span class="nv">species</span><span class="si">}</span>/work/metadata/pivot_qualified.tsv
<span class="k">done</span>
</pre></div>
</div>
<p><strong>Result</strong>: 5 species-specific expression matrices ready for cross-species analysis</p>
</section>
<section id="example-3-quality-control-check">
<h3>Example 3: Quality Control Check<a class="headerlink" href="#example-3-quality-control-check" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge with verbose output</span>
amalgkit<span class="w"> </span>merge<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/work

<span class="c1"># Check merge summary</span>
cat<span class="w"> </span>output/work/merge/Species_name/merge_summary.txt

<span class="c1"># Outputs:</span>
<span class="c1"># Total samples in metadata: 120</span>
<span class="c1"># Samples with quant outputs: 118</span>
<span class="c1"># Samples included in matrix: 118</span>
<span class="c1"># Missing samples: SRR12345678, SRR12345679</span>
<span class="c1"># Total transcripts: 20,672</span>
<span class="c1"># Transcripts with expression: 16,988 (82.2%)</span>
</pre></div>
</div>
</section>
</section>
<section id="downstream-analysis">
<h2>Downstream Analysis<a class="headerlink" href="#downstream-analysis" title="Link to this heading"></a></h2>
<section id="loading-matrices-in-python">
<h3>Loading Matrices in Python<a class="headerlink" href="#loading-matrices-in-python" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Load TPM matrix</span>
<span class="n">tpm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;output/work/merge/Apis_mellifera/Apis_mellifera_tpm.tsv&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matrix shape: </span><span class="si">{</span><span class="n">tpm</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Samples: </span><span class="si">{</span><span class="n">tpm</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transcripts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tpm</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Calculate mean expression per gene</span>
<span class="n">mean_expr</span> <span class="o">=</span> <span class="n">tpm</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 expressed transcripts:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mean_expr</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="loading-matrices-in-r">
<h3>Loading Matrices in R<a class="headerlink" href="#loading-matrices-in-r" title="Link to this heading"></a></h3>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load counts matrix</span>
<span class="n">counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.delim</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;output/work/merge/Apis_mellifera/Apis_mellifera_tc.tsv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="p">)</span>

<span class="c1"># Load TPM matrix</span>
<span class="n">tpm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.delim</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;output/work/merge/Apis_mellifera/Apis_mellifera_tpm.tsv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="p">)</span>

<span class="c1"># Basic statistics</span>
<span class="nf">dim</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span><span class="w">  </span><span class="c1"># transcripts × samples</span>
<span class="nf">summary</span><span class="p">(</span><span class="nf">colSums</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span><span class="w">  </span><span class="c1"># Total counts per sample</span>

<span class="c1"># Filter lowly expressed genes</span>
<span class="n">expressed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rowMeans</span><span class="p">(</span><span class="n">tpm</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span>
<span class="n">counts_filtered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">counts</span><span class="p">[</span><span class="n">expressed</span><span class="p">,</span><span class="w"> </span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="integration-with-metainformant-workflow">
<h2>Integration with METAINFORMANT Workflow<a class="headerlink" href="#integration-with-metainformant-workflow" title="Link to this heading"></a></h2>
<section id="automatic-execution">
<h3>Automatic Execution<a class="headerlink" href="#automatic-execution" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna.workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">execute_workflow</span><span class="p">,</span> <span class="n">load_workflow_config</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">load_workflow_config</span><span class="p">(</span><span class="s2">&quot;config/amalgkit_amellifera.yaml&quot;</span><span class="p">)</span>
<span class="n">execute_workflow</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>  <span class="c1"># merge runs automatically after quant</span>
</pre></div>
</div>
</section>
<section id="accessing-merged-data">
<h3>Accessing Merged Data<a class="headerlink" href="#accessing-merged-data" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Load merged TPM matrix</span>
<span class="n">work_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;output/amalgkit/amellifera/work&quot;</span><span class="p">)</span>
<span class="n">tpm_file</span> <span class="o">=</span> <span class="n">work_dir</span> <span class="o">/</span> <span class="s2">&quot;merge&quot;</span> <span class="o">/</span> <span class="s2">&quot;Apis_mellifera&quot;</span> <span class="o">/</span> <span class="s2">&quot;Apis_mellifera_tpm.tsv&quot;</span>
<span class="n">tpm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">tpm_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded expression matrix: </span><span class="si">{</span><span class="n">tpm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> samples, </span><span class="si">{</span><span class="n">tpm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> transcripts&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>TPM Normalization</strong>: https://www.rna-seqblog.com/rpkm-fpkm-and-tpm-clearly-explained/</p></li>
<li><p><strong>Expression Analysis</strong>: https://bioconductor.org/packages/release/workflows/html/rnaseqGene.html</p></li>
<li><p><strong>METAINFORMANT Workflow</strong>: <code class="docutils literal notranslate"><span class="pre">docs/rna/workflow.md</span></code></p></li>
</ul>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Previous Step</strong>: <a class="reference internal" href="#quant.md"><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">quant.md</span></code></span></a> - Transcript quantification</p></li>
<li><p><strong>Next Step</strong>: <a class="reference internal" href="#curate.md"><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">curate.md</span></code></span></a> - Quality control and batch correction</p></li>
<li><p><strong>Next Step</strong>: <a class="reference internal" href="#cstmm.md"><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">cstmm.md</span></code></span></a> - Cross-species TMM normalization</p></li>
<li><p><strong>Workflow Overview</strong>: <a class="reference internal" href="../amalgkit.html"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">../amalgkit.md</span></code></span></a></p></li>
<li><p><strong>Testing</strong>: <code class="docutils literal notranslate"><span class="pre">tests/test_rna_amalgkit_steps.py::test_merge_basic_execution</span></code></p></li>
</ul>
<hr class="docutils" />
<p><strong>Last Updated</strong>: October 29, 2025<br />
<strong>AMALGKIT Version</strong>: 0.12.19<br />
<strong>Status</strong>: ✅ Production-ready, comprehensively tested</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, METAINFORMANT Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>