

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>amalgkit getfastq: FASTQ File Generation from SRA &mdash; METAINFORMANT 0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=938c9ccc"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            METAINFORMANT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../dna/index.html">DNA: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">RNA: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../protein/index.html">Protein: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gwas/index.html">GWAS (Genome-Wide Association Studies)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html">Epigenome: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#key-components">Key Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#integration-with-genomics">Integration with Genomics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#analysis-workflows">Analysis Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../epigenome/index.html#planned-extensions">Planned Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ontology/index.html">Ontology Module Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../phenotype/index.html">Phenotype: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html">Ecology: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#key-components">Key Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#analysis-workflows">Analysis Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#integration-with-other-modules">Integration with Other Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecology/index.html#planned-extensions">Planned Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../math/index.html">Math: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ml/index.html">Machine Learning: Biological Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networks/index.html">Networks: Biological Network Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../singlecell/index.html">Single-Cell Genomics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quality/index.html">Quality Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../visualization/index.html">Visualization: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../simulation/index.html">Simulation: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../life_events/index.html">Life Events Module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../testing.html">Testing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">METAINFORMANT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">amalgkit getfastq: FASTQ File Generation from SRA</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/rna/amalgkit/steps/04_getfastq.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="amalgkit-getfastq-fastq-file-generation-from-sra">
<h1>amalgkit getfastq: FASTQ File Generation from SRA<a class="headerlink" href="#amalgkit-getfastq-fastq-file-generation-from-sra" title="Link to this heading"></a></h1>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Link to this heading"></a></h2>
<p>Downloads SRA files and converts them to FASTQ format for RNA-seq quantification. This step handles the <strong>data acquisition</strong> phase, retrieving raw sequencing reads from NCBI SRA or cloud repositories.</p>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">getfastq</span></code> step:</p>
<ul class="simple">
<li><p>Downloads SRA files from NCBI, AWS, or GCP</p></li>
<li><p>Extracts FASTQ files using parallel-fastq-dump or fasterq-dump</p></li>
<li><p>Performs quality filtering with fastp</p></li>
<li><p>Handles both single-end and paired-end libraries</p></li>
<li><p>Supports batch processing for HPC environments</p></li>
<li><p>Automatically removes SRA files after extraction (configurable)</p></li>
</ul>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h2>
<section id="basic-usage">
<h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>getfastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work/fastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/amalgkit/work/metadata/metadata.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--pfd<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--fastp<span class="w"> </span>yes

<span class="c1"># Note: FASTQ files will be in output/amalgkit/work/fastq/getfastq/{SRR_ID}/</span>
</pre></div>
</div>
<p><strong>Important</strong>: The metadata file must be in row-per-sample format (with a <code class="docutils literal notranslate"><span class="pre">run</span></code> column), NOT a pivot table. The step automatically looks for <code class="docutils literal notranslate"><span class="pre">metadata.filtered.tissue.tsv</span></code> or <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code> in the metadata directory.</p>
</section>
<section id="python-api">
<h3>Python API<a class="headerlink" href="#python-api" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna.steps.getfastq</span><span class="w"> </span><span class="kn">import</span> <span class="n">run</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span>
    <span class="n">params</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;out_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;output/amalgkit/work/fastq&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="s2">&quot;output/amalgkit/work/metadata/metadata.tsv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s2">&quot;pfd&quot;</span><span class="p">:</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fastp&quot;</span><span class="p">:</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">work_dir</span><span class="o">=</span><span class="s2">&quot;output/amalgkit/work&quot;</span><span class="p">,</span>
    <span class="n">log_dir</span><span class="o">=</span><span class="s2">&quot;output/amalgkit/work/logs&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="configuration-file">
<h3>Configuration File<a class="headerlink" href="#configuration-file" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="nt">getfastq</span><span class="p">:</span>
<span class="w">    </span><span class="nt">out_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/amellifera/fastq</span>
<span class="w">    </span><span class="c1"># Note: FASTQ files will be in {out_dir}/getfastq/{SRR_ID}/</span>
<span class="w">    </span><span class="c1"># Example: output/amalgkit/amellifera/fastq/getfastq/SRR12345678/SRR12345678_1.fastq.gz</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/amalgkit/amellifera/work/metadata/metadata.tsv</span><span class="w">  </span><span class="c1"># Row-per-sample format</span>
<span class="w">    </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="w">    </span><span class="nt">pfd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w">                </span><span class="c1"># Use parallel-fastq-dump (auto-detected if available)</span>
<span class="w">    </span><span class="nt">fastp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w">              </span><span class="c1"># Quality filtering (default: no, set to yes to enable)</span>
<span class="w">    </span><span class="nt">accelerate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">        </span><span class="c1"># Enable cloud acceleration (METAINFORMANT-specific)</span>
<span class="w">    </span><span class="nt">ncbi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">aws</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">gcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">min_read_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25</span>
<span class="w">    </span><span class="nt">max_bp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000000000</span><span class="w">  </span><span class="c1"># Optional: Limit download size per sample (10GB)</span>
</pre></div>
</div>
</section>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading"></a></h2>
<section id="optional-parameters">
<h3>Optional Parameters<a class="headerlink" href="#optional-parameters" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--out_dir</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./</span></code></p></td>
<td><p>Directory for intermediate and output files.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--metadata</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">inferred</span></code></p></td>
<td><p>Path to metadata.tsv. Default: <code class="docutils literal notranslate"><span class="pre">out_dir/metadata/metadata.tsv</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--threads</span></code></p></td>
<td><p>INT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p>Number of threads for parallel processing.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--redo</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">no</span></code></p></td>
<td><p>Re-download behavior. See “When to Use <code class="docutils literal notranslate"><span class="pre">redo</span></code>” section below for details.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--batch</span></code></p></td>
<td><p>INT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Process only one SRA record (1-based index). For HPC array jobs.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--entrez_email</span></code></p></td>
<td><p>email</p></td>
<td><p>``</p></td>
<td><p>Email for NCBI Entrez API.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--id</span></code></p></td>
<td><p>STR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Single BioProject/BioSample/SRR ID to download directly.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--id_list</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>File containing list of SRA IDs (one per line).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--layout</span></code></p></td>
<td><p>STR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">auto</span></code></p></td>
<td><p>Library layout: <code class="docutils literal notranslate"><span class="pre">single</span></code>, <code class="docutils literal notranslate"><span class="pre">paired</span></code>, or <code class="docutils literal notranslate"><span class="pre">auto</span></code> (prefers paired).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--max_bp</span></code></p></td>
<td><p>INT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">999999999999999</span></code></p></td>
<td><p>Target sequence size (bp) to download per sample. Use to limit download size for testing or disk space constraints. After quantification, only small abundance files (~few MB) remain, so large downloads are temporary.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--min_read_length</span></code></p></td>
<td><p>INT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">25</span></code></p></td>
<td><p>Minimum read length after quality filtering.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--pfd</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yes</span></code></p></td>
<td><p>Use parallel-fastq-dump for SRA extraction.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--pfd_exe</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">parallel-fastq-dump</span></code></p></td>
<td><p>Path to parallel-fastq-dump executable.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--prefetch_exe</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">prefetch</span></code></p></td>
<td><p>Path to prefetch executable.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--fastp</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yes</span></code></p></td>
<td><p>Run fastp for quality filtering and adapter trimming.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--fastp_exe</span></code></p></td>
<td><p>PATH</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fastp</span></code></p></td>
<td><p>Path to fastp executable.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--fastp_option</span></code></p></td>
<td><p>STR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">/dev/null</span> <span class="pre">-h</span> <span class="pre">/dev/null</span></code></p></td>
<td><p>Custom fastp options.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--remove_sra</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yes</span></code></p></td>
<td><p>Delete SRA files after FASTQ extraction.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--remove_tmp</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yes</span></code></p></td>
<td><p>Remove temporary files.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--pfd_print</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yes</span></code></p></td>
<td><p>Show parallel-fastq-dump stdout/stderr.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--fastp_print</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yes</span></code></p></td>
<td><p>Show fastp stdout/stderr.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--sci_name</span></code></p></td>
<td><p>STR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Species name filter (if BioProject spans multiple species).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--ncbi</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yes</span></code></p></td>
<td><p>Download from NCBI cloud.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--aws</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yes</span></code></p></td>
<td><p>Download from Amazon Web Services (AWS).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--gcp</span></code></p></td>
<td><p>yes/no</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yes</span></code></p></td>
<td><p>Download from Google Cloud Platform (GCP).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--read_name</span></code></p></td>
<td><p>STR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">default</span></code></p></td>
<td><p>Read name formatting: <code class="docutils literal notranslate"><span class="pre">default</span></code> or <code class="docutils literal notranslate"><span class="pre">trinity</span></code> (for Trinity assembler).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--entrez_additional_search_term</span></code></p></td>
<td><p>STR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Additional Entrez search terms to restrict SRA entries.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--tol</span></code></p></td>
<td><p>FLOAT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p>Acceptable percentage loss of reads relative to –max_bp.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="metainformant-specific-parameters">
<h3>METAINFORMANT-Specific Parameters<a class="headerlink" href="#metainformant-specific-parameters" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">show_progress</span></code></p></td>
<td><p>bool</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
<td><p>Enable live progress tracking with file size monitoring. Shows per-thread download progress, rates (MB/s), and elapsed time.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">progress_update_interval</span></code></p></td>
<td><p>float</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">2.0</span></code></p></td>
<td><p>How often to update progress display in seconds. Lower values provide more frequent updates but use more CPU.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">progress_style</span></code></p></td>
<td><p>str</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;bar&quot;</span></code></p></td>
<td><p>Progress display style: <code class="docutils literal notranslate"><span class="pre">&quot;bar&quot;</span></code> for tqdm progress bars (requires tqdm), or <code class="docutils literal notranslate"><span class="pre">&quot;text&quot;</span></code> for simple text updates.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="when-to-use-redo-yes-vs-redo-no">
<h2>When to Use <code class="docutils literal notranslate"><span class="pre">redo:</span> <span class="pre">yes</span></code> vs <code class="docutils literal notranslate"><span class="pre">redo:</span> <span class="pre">no</span></code><a class="headerlink" href="#when-to-use-redo-yes-vs-redo-no" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">redo</span></code> parameter controls whether amalgkit re-downloads SRA files that already exist locally.</p>
<section id="default-behavior-redo-no-recommended">
<h3>Default Behavior: <code class="docutils literal notranslate"><span class="pre">redo:</span> <span class="pre">no</span></code> (Recommended)<a class="headerlink" href="#default-behavior-redo-no-recommended" title="Link to this heading"></a></h3>
<p><strong>Use <code class="docutils literal notranslate"><span class="pre">redo:</span> <span class="pre">no</span></code> for normal operations.</strong> This is the default and recommended setting.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">redo:</span> <span class="pre">no</span></code>:</p>
<ul class="simple">
<li><p>✅ <strong>Skips already-downloaded SRA files</strong> - Amalgkit automatically detects existing <code class="docutils literal notranslate"><span class="pre">.sra</span></code> files and skips re-downloading them</p></li>
<li><p>✅ <strong>Saves bandwidth and time</strong> - Only downloads missing files</p></li>
<li><p>✅ <strong>Still processes existing files</strong> - Even if SRA files exist, amalgkit will still:</p>
<ul>
<li><p>Extract FASTQ files if they don’t exist</p></li>
<li><p>Run quality filtering with fastp if enabled</p></li>
<li><p>Generate output files as needed</p></li>
</ul>
</li>
</ul>
<p><strong>Example output with <code class="docutils literal notranslate"><span class="pre">redo:</span> <span class="pre">no</span></code>:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Processing</span> <span class="n">SRA</span> <span class="n">ID</span><span class="p">:</span> <span class="n">SRR34065661</span>
<span class="n">Previously</span><span class="o">-</span><span class="n">downloaded</span> <span class="n">sra</span> <span class="n">file</span> <span class="n">was</span> <span class="n">detected</span> <span class="n">at</span><span class="p">:</span> <span class="o">.../</span><span class="n">SRR34065661</span><span class="o">.</span><span class="n">sra</span>
<span class="n">Time</span> <span class="n">elapsed</span> <span class="k">for</span> <span class="mi">1</span><span class="n">st</span><span class="o">-</span><span class="nb">round</span> <span class="n">sequence</span> <span class="n">extraction</span><span class="p">:</span> <span class="n">SRR34065661</span><span class="p">,</span> <span class="mf">0.0</span> <span class="n">sec</span>
</pre></div>
</div>
</section>
<section id="when-to-use-redo-yes">
<h3>When to Use <code class="docutils literal notranslate"><span class="pre">redo:</span> <span class="pre">yes</span></code><a class="headerlink" href="#when-to-use-redo-yes" title="Link to this heading"></a></h3>
<p><strong>Use <code class="docutils literal notranslate"><span class="pre">redo:</span> <span class="pre">yes</span></code> only in specific situations:</strong></p>
<ol class="arabic simple">
<li><p><strong>Corrupted files</strong> - If SRA files are corrupted and need to be re-downloaded</p></li>
<li><p><strong>Data refresh</strong> - If you want to ensure you have the latest version from SRA (rarely needed, as SRA data is typically stable)</p></li>
<li><p><strong>Testing</strong> - When testing download functionality or troubleshooting download issues</p></li>
<li><p><strong>Configuration changes</strong> - If you changed download settings (e.g., switching from NCBI to AWS) and want fresh downloads</p></li>
</ol>
<p><strong>Warning</strong>: Using <code class="docutils literal notranslate"><span class="pre">redo:</span> <span class="pre">yes</span></code> will:</p>
<ul class="simple">
<li><p>⚠️ Re-download ALL files, even if they already exist</p></li>
<li><p>⚠️ Use significant bandwidth and time</p></li>
<li><p>⚠️ May overwrite existing files</p></li>
</ul>
</section>
<section id="file-detection-behavior">
<h3>File Detection Behavior<a class="headerlink" href="#file-detection-behavior" title="Link to this heading"></a></h3>
<p>Amalgkit detects existing files by checking for <code class="docutils literal notranslate"><span class="pre">.sra</span></code> files in the expected location:</p>
<ul class="simple">
<li><p>Pattern: <code class="docutils literal notranslate"><span class="pre">{out_dir}/getfastq/{SRR_ID}/{SRR_ID}.sra</span></code></p></li>
<li><p>Detection message: <code class="docutils literal notranslate"><span class="pre">&quot;Previously-downloaded</span> <span class="pre">sra</span> <span class="pre">file</span> <span class="pre">was</span> <span class="pre">detected</span> <span class="pre">at:</span> <span class="pre">{path}&quot;</span></code></p></li>
<li><p>Skip message: <code class="docutils literal notranslate"><span class="pre">&quot;Previously-downloaded</span> <span class="pre">sra</span> <span class="pre">file</span> <span class="pre">was</span> <span class="pre">not</span> <span class="pre">detected.</span> <span class="pre">New</span> <span class="pre">sra</span> <span class="pre">file</span> <span class="pre">will</span> <span class="pre">be</span> <span class="pre">downloaded.&quot;</span></code></p></li>
</ul>
</section>
<section id="summary-logging">
<h3>Summary Logging<a class="headerlink" href="#summary-logging" title="Link to this heading"></a></h3>
<p>After the <code class="docutils literal notranslate"><span class="pre">getfastq</span></code> step completes, METAINFORMANT logs a summary showing:</p>
<ul class="simple">
<li><p>Number of files skipped (already exists)</p></li>
<li><p>Number of files downloaded</p></li>
<li><p>Total samples processed</p></li>
</ul>
<p>Example summary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Step</span> <span class="n">getfastq</span> <span class="n">summary</span><span class="p">:</span> <span class="mi">1</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">skipped</span> <span class="p">(</span><span class="n">already</span> <span class="n">exists</span><span class="p">),</span> <span class="mi">14</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">downloaded</span> <span class="p">(</span><span class="n">total</span><span class="p">:</span> <span class="mi">15</span> <span class="n">samples</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="input-requirements">
<h2>Input Requirements<a class="headerlink" href="#input-requirements" title="Link to this heading"></a></h2>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Metadata Table</strong>: Row-per-sample format from <code class="docutils literal notranslate"><span class="pre">amalgkit</span> <span class="pre">select</span></code> (typically <code class="docutils literal notranslate"><span class="pre">metadata.filtered.tissue.tsv</span></code> or <code class="docutils literal notranslate"><span class="pre">metadata.tsv</span></code>). <strong>Note</strong>: Pivot tables (like <code class="docutils literal notranslate"><span class="pre">pivot_qualified.tsv</span></code>) are NOT supported - they lack the required <code class="docutils literal notranslate"><span class="pre">run</span></code> column.</p></li>
<li><p><strong>SRA Toolkit</strong>: <code class="docutils literal notranslate"><span class="pre">prefetch</span></code>, <code class="docutils literal notranslate"><span class="pre">fasterq-dump</span></code>, or <code class="docutils literal notranslate"><span class="pre">parallel-fastq-dump</span></code></p></li>
<li><p><strong>fastp</strong> (optional but recommended): For quality filtering</p></li>
<li><p><strong>Network Access</strong>: For SRA downloads from NCBI/AWS/GCP</p></li>
<li><p><strong>Disk Space</strong>: Substantial (SRA files + FASTQs can be 5-50GB per sample)</p></li>
</ul>
</section>
<section id="system-dependencies">
<h3>System Dependencies<a class="headerlink" href="#system-dependencies" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Tool</p></th>
<th class="head"><p>Purpose</p></th>
<th class="head"><p>Installation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>prefetch</strong></p></td>
<td><p>Download SRA files</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">bioconda</span> <span class="pre">sra-tools</span></code> or <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">sra-toolkit</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><strong>fasterq-dump</strong></p></td>
<td><p>Extract FASTQs from SRA</p></td>
<td><p>Included in sra-tools</p></td>
</tr>
<tr class="row-even"><td><p><strong>parallel-fastq-dump</strong></p></td>
<td><p>Parallel FASTQ extraction</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">bioconda</span> <span class="pre">parallel-fastq-dump</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><strong>fastp</strong></p></td>
<td><p>Quality filtering</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">bioconda</span> <span class="pre">fastp</span></code> or <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">fastp</span></code></p></td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: For Python packages, use <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">pip</span> <span class="pre">install</span></code> (primary method). System tools can use conda or system package managers.</p>
</section>
</section>
<section id="output-files">
<h2>Output Files<a class="headerlink" href="#output-files" title="Link to this heading"></a></h2>
<section id="directory-structure">
<h3>Directory Structure<a class="headerlink" href="#directory-structure" title="Link to this heading"></a></h3>
<p><strong>Important</strong>: The <code class="docutils literal notranslate"><span class="pre">getfastq</span></code> step automatically creates a <code class="docutils literal notranslate"><span class="pre">getfastq/</span></code> subdirectory within the specified <code class="docutils literal notranslate"><span class="pre">out_dir</span></code>. FASTQ files are NOT placed directly in <code class="docutils literal notranslate"><span class="pre">out_dir/</span></code>, but rather in <code class="docutils literal notranslate"><span class="pre">out_dir/getfastq/{sample_id}/</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>out_dir/
└── getfastq/                          # ← Automatically created by amalgkit
    └── SRR12345678/
        ├── SRR12345678_1.fastq.gz     # Paired-end read 1
        ├── SRR12345678_2.fastq.gz     # Paired-end read 2
        ├── SRR12345678.fastq.gz       # Single-end (if applicable)
        ├── fastp.json                 # Quality control report
        └── fastp.html                 # HTML QC report
</pre></div>
</div>
<p><strong>Example</strong>: If <code class="docutils literal notranslate"><span class="pre">out_dir:</span> <span class="pre">output/amalgkit/pbarbatus/fastq</span></code>, then FASTQ files will be in:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">output/amalgkit/pbarbatus/fastq/getfastq/SRR12345678/SRR12345678_1.fastq.gz</span></code></p></li>
</ul>
<p><strong>Key Point</strong>: The <code class="docutils literal notranslate"><span class="pre">getfastq/</span></code> subdirectory is created automatically by amalgkit. When configuring the <code class="docutils literal notranslate"><span class="pre">integrate</span></code> step, the <code class="docutils literal notranslate"><span class="pre">fastq_dir</span></code> parameter must point to <code class="docutils literal notranslate"><span class="pre">{out_dir}/getfastq/</span></code> (the getfastq subdirectory), not just <code class="docutils literal notranslate"><span class="pre">{out_dir}/</span></code>.</p>
</section>
<section id="fastq-file-naming">
<h3>FASTQ File Naming<a class="headerlink" href="#fastq-file-naming" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Paired-end</strong>: <code class="docutils literal notranslate"><span class="pre">{SRR_ID}_1.fastq.gz</span></code> and <code class="docutils literal notranslate"><span class="pre">{SRR_ID}_2.fastq.gz</span></code></p></li>
<li><p><strong>Single-end</strong>: <code class="docutils literal notranslate"><span class="pre">{SRR_ID}.fastq.gz</span></code></p></li>
</ul>
</section>
<section id="quality-reports">
<h3>Quality Reports<a class="headerlink" href="#quality-reports" title="Link to this heading"></a></h3>
<p>Each sample generates:</p>
<ul class="simple">
<li><p><strong>fastp.json</strong>: Machine-readable QC metrics</p></li>
<li><p><strong>fastp.html</strong>: Human-readable QC report with plots</p></li>
</ul>
</section>
</section>
<section id="workflow-integration">
<h2>Workflow Integration<a class="headerlink" href="#workflow-integration" title="Link to this heading"></a></h2>
<section id="position-in-pipeline">
<h3>Position in Pipeline<a class="headerlink" href="#position-in-pipeline" title="Link to this heading"></a></h3>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>flowchart LR
    A[select] --&gt; B[getfastq]
    B --&gt; C[integrate]
    C --&gt; D[quant]
</pre></div>
</div>
<p><strong>getfastq</strong> runs <strong>after select</strong>, <strong>before quant</strong>.</p>
</section>
<section id="downstream-dependencies">
<h3>Downstream Dependencies<a class="headerlink" href="#downstream-dependencies" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Step</p></th>
<th class="head"><p>Dependency</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">integrate</span></code></p></td>
<td><p>FASTQs</p></td>
<td><p>Adds FASTQ info to metadata</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">quant</span></code></p></td>
<td><p>FASTQs</p></td>
<td><p>Quantifies gene expression</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="download-sources">
<h2>Download Sources<a class="headerlink" href="#download-sources" title="Link to this heading"></a></h2>
<section id="source-priority">
<h3>Source Priority<a class="headerlink" href="#source-priority" title="Link to this heading"></a></h3>
<p>When multiple sources enabled, amalgkit tries in order:</p>
<ol class="arabic simple">
<li><p><strong>AWS</strong> (fastest, US regions)</p></li>
<li><p><strong>GCP</strong> (fast, global)</p></li>
<li><p><strong>NCBI</strong> (fallback, slower)</p></li>
</ol>
</section>
<section id="enabling-disabling-sources">
<h3>Enabling/Disabling Sources<a class="headerlink" href="#enabling-disabling-sources" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use all sources (default)</span>
--ncbi<span class="w"> </span>yes<span class="w"> </span>--aws<span class="w"> </span>yes<span class="w"> </span>--gcp<span class="w"> </span>yes

<span class="c1"># NCBI only (if cloud access blocked)</span>
--ncbi<span class="w"> </span>yes<span class="w"> </span>--aws<span class="w"> </span>no<span class="w"> </span>--gcp<span class="w"> </span>no

<span class="c1"># AWS only (fastest in US)</span>
--ncbi<span class="w"> </span>no<span class="w"> </span>--aws<span class="w"> </span>yes<span class="w"> </span>--gcp<span class="w"> </span>no
</pre></div>
</div>
</section>
</section>
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Link to this heading"></a></h2>
<section id="runtime">
<h3>Runtime<a class="headerlink" href="#runtime" title="Link to this heading"></a></h3>
<p><strong>Per Sample</strong> (typical 5-10GB SRA):</p>
<ul class="simple">
<li><p><strong>Download</strong>: 5-30 minutes (depends on network speed)</p></li>
<li><p><strong>Extraction</strong>: 5-15 minutes (with parallel-fastq-dump)</p></li>
<li><p><strong>Quality filtering</strong>: 2-10 minutes (with fastp)</p></li>
<li><p><strong>Total</strong>: 15-60 minutes per sample</p></li>
</ul>
<p><strong>For 100 Samples</strong>:</p>
<ul class="simple">
<li><p><strong>Serial</strong>: 25-100 hours</p></li>
<li><p><strong>Parallel</strong> (10 concurrent): 3-10 hours</p></li>
</ul>
</section>
<section id="disk-space">
<h3>Disk Space<a class="headerlink" href="#disk-space" title="Link to this heading"></a></h3>
<p><strong>Per Sample</strong>:</p>
<ul class="simple">
<li><p><strong>SRA file</strong>: 2-20GB</p></li>
<li><p><strong>Raw FASTQs</strong>: 4-40GB (uncompressed during extraction)</p></li>
<li><p><strong>Compressed FASTQs</strong>: 1-10GB (final output)</p></li>
<li><p><strong>Peak usage</strong>: ~30-70GB per sample during processing</p></li>
</ul>
<p><strong>Important</strong>: Use <code class="docutils literal notranslate"><span class="pre">--remove_sra</span> <span class="pre">yes</span></code> to delete SRA files after extraction!</p>
</section>
<section id="network-usage">
<h3>Network Usage<a class="headerlink" href="#network-usage" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Per sample</strong>: 2-20GB download</p></li>
<li><p><strong>100 samples</strong>: 200GB - 2TB total</p></li>
<li><p><strong>Recommendation</strong>: Use high-speed network connection</p></li>
</ul>
</section>
<section id="download-size-limits">
<h3>Download Size Limits<a class="headerlink" href="#download-size-limits" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">--max_bp</span></code> parameter allows you to limit the download size per sample. This is useful for:</p>
<ul class="simple">
<li><p><strong>Testing workflows</strong>: Limit downloads to validate pipeline without full data</p></li>
<li><p><strong>Disk space constraints</strong>: Control peak disk usage during processing</p></li>
<li><p><strong>Network bandwidth management</strong>: Reduce download time and bandwidth usage</p></li>
</ul>
<p><strong>Important Notes</strong>:</p>
<ul class="simple">
<li><p>After quantification, only small abundance files remain (~few MB per sample)</p></li>
<li><p>Large downloads are <strong>temporary</strong> - quantified samples don’t need re-download</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">max_bp</span></code> limit applies per sample, not total workflow size</p></li>
</ul>
<p><strong>Example</strong>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="nt">getfastq</span><span class="p">:</span>
<span class="w">    </span><span class="nt">max_bp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000000000</span><span class="w">  </span><span class="c1"># Limit to 10GB per sample</span>
</pre></div>
</div>
</section>
<section id="parallelization">
<h3>Parallelization<a class="headerlink" href="#parallelization" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good: Moderate parallelization</span>
--threads<span class="w"> </span><span class="m">8</span>

<span class="c1"># Better: Higher parallelization (if CPU/network allows)</span>
--threads<span class="w"> </span><span class="m">16</span>

<span class="c1"># Optimal: Match available cores</span>
--threads<span class="w"> </span><span class="k">$(</span>nproc<span class="k">)</span>
</pre></div>
</div>
</section>
</section>
<section id="common-use-cases">
<h2>Common Use Cases<a class="headerlink" href="#common-use-cases" title="Link to this heading"></a></h2>
<section id="download-all-selected-samples">
<h3>1. Download All Selected Samples<a class="headerlink" href="#download-all-selected-samples" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>getfastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work/fastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/amalgkit/work/metadata/metadata.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--remove_sra<span class="w"> </span>yes
</pre></div>
</div>
</section>
<section id="download-specific-sra-id">
<h3>2. Download Specific SRA ID<a class="headerlink" href="#download-specific-sra-id" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Direct SRA download (skip metadata step)</span>
amalgkit<span class="w"> </span>getfastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--id<span class="w"> </span>SRR12345678<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
</section>
<section id="download-from-id-list">
<h3>3. Download from ID List<a class="headerlink" href="#download-from-id-list" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create ID list</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SRR12345678&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>sra_ids.txt
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SRR12345679&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>sra_ids.txt
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SRR12345680&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>sra_ids.txt

<span class="c1"># Download all</span>
amalgkit<span class="w"> </span>getfastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--id_list<span class="w"> </span>sra_ids.txt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">12</span>
</pre></div>
</div>
</section>
<section id="hpc-array-job-processing">
<h3>4. HPC Array Job Processing<a class="headerlink" href="#hpc-array-job-processing" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Submit array job (SLURM example)</span>
sbatch<span class="w"> </span>--array<span class="o">=</span><span class="m">1</span>-100<span class="w"> </span>download_job.sh

<span class="c1"># In download_job.sh:</span>
amalgkit<span class="w"> </span>getfastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work/fastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/work/metadata/metadata.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--batch<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_ARRAY_TASK_ID</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
<p><strong>Effect</strong>: Each array job downloads one sample in parallel.</p>
</section>
<section id="re-download-failed-samples">
<h3>5. Re-download Failed Samples<a class="headerlink" href="#re-download-failed-samples" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Force re-download</span>
amalgkit<span class="w"> </span>getfastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/work<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>failed_samples.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--redo<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
</section>
</section>
<section id="metainformant-enhanced-features">
<h2>METAINFORMANT Enhanced Features<a class="headerlink" href="#metainformant-enhanced-features" title="Link to this heading"></a></h2>
<p>The METAINFORMANT wrapper provides additional functionality beyond stock amalgkit:</p>
<section id="robust-sra-download-with-retries">
<h3>Robust SRA Download with Retries<a class="headerlink" href="#robust-sra-download-with-retries" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># From src/metainformant/rna/steps/getfastq.py</span>
<span class="c1"># Automatic retry logic for failed downloads:</span>
<span class="c1"># 1. NEW (Jan 2026): Checks for &quot;LITE&quot; files and uses `curl` to fetch full SRA objects directly from AWS Open Data (`https://sra-pub-run-odp.s3.amazonaws.com/...`).</span>
<span class="c1">#    - This bypasses `prefetch`/`sra-tools` entirely for the download phase.</span>
<span class="c1">#    - Supports resume (`-C -`) and retries.</span>
<span class="c1"># 2. Falls back to amalgkit&#39;s default methods if direct download fails.</span>
</pre></div>
</div>
</section>
<section id="lite-file-bypass-jan-2026">
<h3>LITE File Bypass (Jan 2026)<a class="headerlink" href="#lite-file-bypass-jan-2026" title="Link to this heading"></a></h3>
<p>Older SRA entries often have “LITE” versions (metadata only) in NCBI/GCP. The workflow now automatically:</p>
<ol class="arabic simple">
<li><p>Detects LITE metadata.</p></li>
<li><p>Intercepts the download process.</p></li>
<li><p>Downloads the <strong>full</strong> SRA file from AWS using <code class="docutils literal notranslate"><span class="pre">curl</span></code>.</p></li>
<li><p>Places it where <code class="docutils literal notranslate"><span class="pre">amalgkit</span></code> expects it, allowing <code class="docutils literal notranslate"><span class="pre">getfastq</span></code> to proceed with extraction only.</p></li>
</ol>
</section>
<section id="cloud-acceleration-metainformant-specific">
<h3>Cloud Acceleration (METAINFORMANT-specific)<a class="headerlink" href="#cloud-acceleration-metainformant-specific" title="Link to this heading"></a></h3>
<p>Set <code class="docutils literal notranslate"><span class="pre">accelerate:</span> <span class="pre">true</span></code> in your config to automatically enable all cloud sources:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="nt">getfastq</span><span class="p">:</span>
<span class="w">    </span><span class="nt">accelerate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Automatically sets aws, gcp, ncbi to &#39;yes&#39;</span>
</pre></div>
</div>
<p>This is processed by <code class="docutils literal notranslate"><span class="pre">src/metainformant/rna/steps/getfastq.py</span></code> before calling amalgkit:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract accelerate flag and apply to amalgkit params</span>
<span class="n">accelerate_enabled</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">effective_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;accelerate&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="k">if</span> <span class="n">accelerate_enabled</span><span class="p">:</span>
    <span class="n">effective_params</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;aws&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>
    <span class="n">effective_params</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;gcp&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>
    <span class="n">effective_params</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;ncbi&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="intelligent-defaults">
<h3>Intelligent Defaults<a class="headerlink" href="#intelligent-defaults" title="Link to this heading"></a></h3>
<p>METAINFORMANT sets robust defaults for production workflows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># From src/metainformant/rna/steps/getfastq.py::_inject_robust_defaults()</span>
<span class="c1"># PFD: Auto-enabled if parallel-fastq-dump is available, otherwise disabled</span>
<span class="c1"># fastp: Defaults to False (set to True in config to enable quality filtering)</span>
<span class="c1"># accelerate: Defaults to True (enables AWS/GCP/NCBI sources)</span>
<span class="c1"># pfd_print/fastp_print: Default to True for better diagnostics</span>
<span class="c1"># prefetch_exe/pfd_exe: Auto-detected from PATH if available</span>
</pre></div>
</div>
</section>
<section id="progress-monitoring">
<h3>Progress Monitoring<a class="headerlink" href="#progress-monitoring" title="Link to this heading"></a></h3>
<p>The METAINFORMANT wrapper includes:</p>
<ul class="simple">
<li><p><strong>Live progress tracking</strong>: File size monitoring with per-thread download rates</p></li>
<li><p><strong>Heartbeat messages</strong>: Every 30 seconds during long-running downloads</p></li>
<li><p><strong>Streaming logs</strong>: Real-time output from amalgkit and helper tools</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna.workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">execute_workflow</span><span class="p">,</span> <span class="n">load_workflow_config</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">load_workflow_config</span><span class="p">(</span><span class="s2">&quot;config/amalgkit_amellifera.yaml&quot;</span><span class="p">)</span>
<span class="n">execute_workflow</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

<span class="c1"># Output shows:</span>
<span class="c1"># [20:57:10] starting step &#39;getfastq&#39; -&gt; amalgkit getfastq ...</span>
<span class="c1"># [20:57:40] still running step &#39;getfastq&#39; (pid=12345, heartbeat #1)...</span>
<span class="c1"># [20:58:10] still running step &#39;getfastq&#39; (pid=12345, heartbeat #2)...</span>
<span class="c1"># Real-time download progress from DownloadProgressMonitor</span>
</pre></div>
</div>
</section>
<section id="targeted-missing-sample-recovery">
<h3>Targeted Missing Sample Recovery<a class="headerlink" href="#targeted-missing-sample-recovery" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Automatically detects missing FASTQs and downloads only those</span>
<span class="c1"># See: src/metainformant/rna/steps/getfastq.py::_retry_missing_srrs()</span>
</pre></div>
</div>
</section>
</section>
<section id="automatic-sra-to-fastq-conversion">
<h2>Automatic SRA-to-FASTQ Conversion<a class="headerlink" href="#automatic-sra-to-fastq-conversion" title="Link to this heading"></a></h2>
<p>The METAINFORMANT workflow includes automatic conversion of SRA files to FASTQ format:</p>
<ol class="arabic simple">
<li><p><strong>During getfastq step</strong>: If <code class="docutils literal notranslate"><span class="pre">amalgkit</span> <span class="pre">getfastq</span></code> downloads SRA files but doesn’t extract FASTQ files (e.g., due to extraction failure), the workflow automatically attempts conversion using <code class="docutils literal notranslate"><span class="pre">convert_sra_to_fastq()</span></code>.</p></li>
<li><p><strong>For existing SRA files</strong>: If SRA files exist but FASTQ files are missing, the workflow detects this and automatically triggers extraction.</p></li>
<li><p><strong>Tool selection</strong>: The conversion process:</p>
<ul class="simple">
<li><p>First tries <code class="docutils literal notranslate"><span class="pre">parallel-fastq-dump</span></code> (if available) - works better with local files</p></li>
<li><p>Falls back to <code class="docutils literal notranslate"><span class="pre">fasterq-dump</span></code> with <code class="docutils literal notranslate"><span class="pre">--size-check</span> <span class="pre">off</span></code> to prevent disk limit errors</p></li>
<li><p>Automatically compresses output FASTQ files using <code class="docutils literal notranslate"><span class="pre">pigz</span></code> or <code class="docutils literal notranslate"><span class="pre">gzip</span></code></p></li>
</ul>
</li>
<li><p><strong>Wrapper mechanism</strong>: For <code class="docutils literal notranslate"><span class="pre">amalgkit</span></code> calls, a wrapper script injects <code class="docutils literal notranslate"><span class="pre">--size-check</span> <span class="pre">off</span></code> into <code class="docutils literal notranslate"><span class="pre">fasterq-dump</span></code> commands to prevent “disk-limit exceeded” errors. The wrapper is automatically created in <code class="docutils literal notranslate"><span class="pre">{fastq_dir}/temp/fasterq-dump</span></code> and added to PATH for <code class="docutils literal notranslate"><span class="pre">amalgkit</span></code> processes.</p></li>
</ol>
</section>
<section id="validation">
<h2>Validation<a class="headerlink" href="#validation" title="Link to this heading"></a></h2>
<p>After the <code class="docutils literal notranslate"><span class="pre">getfastq</span></code> step completes, validation automatically runs to verify that samples were successfully downloaded and extracted.</p>
<section id="automatic-validation">
<h3>Automatic Validation<a class="headerlink" href="#automatic-validation" title="Link to this heading"></a></h3>
<p>Validation runs automatically after <code class="docutils literal notranslate"><span class="pre">getfastq</span></code> completes:</p>
<ul class="simple">
<li><p>Checks that FASTQ files exist for each sample</p></li>
<li><p>Validates file sizes and counts</p></li>
<li><p>Generates validation report: <code class="docutils literal notranslate"><span class="pre">work_dir/validation/getfastq_validation.json</span></code></p></li>
</ul>
</section>
<section id="validation-results">
<h3>Validation Results<a class="headerlink" href="#validation-results" title="Link to this heading"></a></h3>
<p>Check validation results:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># View validation report</span>
cat<span class="w"> </span>output/amalgkit/my_species/work/validation/getfastq_validation.json

<span class="c1"># Run standalone validation</span>
python3<span class="w"> </span>scripts/rna/run_workflow.py<span class="w"> </span>config/amalgkit/my_species.yaml<span class="w"> </span>--validate<span class="w"> </span>--validate-stage<span class="w"> </span>extraction
</pre></div>
</div>
</section>
<section id="common-validation-issues">
<h3>Common Validation Issues<a class="headerlink" href="#common-validation-issues" title="Link to this heading"></a></h3>
<p><strong>Issue</strong>: Samples show <code class="docutils literal notranslate"><span class="pre">extraction:</span> <span class="pre">false</span></code> in validation</p>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Check if FASTQ files exist:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>output/amalgkit/my_species/fastq/getfastq/SRR123456/
</pre></div>
</div>
</li>
<li><p>Verify <code class="docutils literal notranslate"><span class="pre">getfastq</span></code> step completed successfully</p></li>
<li><p>Check logs for download errors:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>output/amalgkit/my_species/work/logs/getfastq.log
</pre></div>
</div>
</li>
<li><p>Re-run <code class="docutils literal notranslate"><span class="pre">getfastq</span></code> step if needed</p></li>
</ol>
<p>For detailed validation troubleshooting, see <a class="reference internal" href="../../VALIDATION.html"><span class="std std-doc">Validation Guide</span></a>.</p>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<section id="issue-getfastq-reports-success-but-produces-0-reads">
<h3>Issue: getfastq reports success but produces 0 reads<a class="headerlink" href="#issue-getfastq-reports-success-but-produces-0-reads" title="Link to this heading"></a></h3>
<p><strong>Symptoms</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">amalgkit</span> <span class="pre">getfastq</span></code> returns exit code 0 (success)</p></li>
<li><p>Log shows “Sum of fastp input reads: 0 bp” and “Sum of fastp output reads: 0 bp”</p></li>
</ul>
<p><strong>Root Cause</strong>: fasterq-dump is failing due to disk space issues in <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> (tmpfs may be full).</p>
<p><strong>Solution</strong>: The workflow now automatically sets <code class="docutils literal notranslate"><span class="pre">TMPDIR</span></code> to the repository’s <code class="docutils literal notranslate"><span class="pre">.tmp/fasterq-dump</span></code> directory (on external drive with sufficient space) before running getfastq step. This prevents “disk-limit exceeded” and “storage exhausted” errors.</p>
<p><strong>Verification</strong>: Check that TMPDIR is set correctly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># During getfastq execution, TMPDIR should point to repository .tmp directory</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$TMPDIR</span>
<span class="c1"># Should show: /path/to/repo/.tmp/fasterq-dump</span>
</pre></div>
</div>
<ul class="simple">
<li><p>No FASTQ files are created</p></li>
<li><p>SRA file may be deleted after “successful” download</p></li>
</ul>
<p><strong>Root Causes</strong>:</p>
<ol class="arabic simple">
<li><p><strong>LITE SRA Files (Most Common)</strong>: Some species have LITE SRA files on NCBI/GCP that are metadata-only and contain no sequence data. These files have “lite” in their URLs (e.g., <code class="docutils literal notranslate"><span class="pre">SRR123456.lite.1</span></code>). AWS typically has full SRA files.</p></li>
<li><p><strong>Empty/Corrupted SRA Files</strong>: Some SRA files in the database are empty or corrupted.</p></li>
<li><p><strong>Conversion Failure</strong>: The SRA-to-FASTQ conversion process fails silently.</p></li>
</ol>
<p><strong>Solution</strong>:</p>
<p><strong>For LITE SRA Files</strong>:</p>
<ol class="arabic">
<li><p><strong>Check metadata URLs</strong>: Inspect the <code class="docutils literal notranslate"><span class="pre">NCBI_Link</span></code>, <code class="docutils literal notranslate"><span class="pre">AWS_Link</span></code>, and <code class="docutils literal notranslate"><span class="pre">GCP_Link</span></code> columns in your metadata. If URLs contain “lite”, those sources have metadata-only files.</p></li>
<li><p><strong>Use AWS only</strong>: Disable NCBI and GCP, use AWS only:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="nt">getfastq</span><span class="p">:</span>
<span class="w">    </span><span class="nt">aws</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">gcp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span><span class="w">   </span><span class="c1"># Disable if has lite files</span>
<span class="w">    </span><span class="nt">ncbi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span><span class="w">  </span><span class="c1"># Disable if has lite files</span>
</pre></div>
</div>
</li>
<li><p><strong>Verify AWS links</strong>: AWS links typically don’t have “lite” and contain full sequence data.</p></li>
</ol>
<p><strong>For Other Cases</strong>: The METAINFORMANT workflow includes enhanced validation that:</p>
<ol class="arabic simple">
<li><p><strong>Immediately validates FASTQ files</strong> after getfastq completes</p></li>
<li><p><strong>Detects 0-read cases</strong> by checking for actual FASTQ files</p></li>
<li><p><strong>Marks downloads as failed</strong> if no files are found, preventing false positives</p></li>
<li><p><strong>Provides clear error messages</strong> distinguishing between conversion failures and 0-read cases</p></li>
<li><p><strong>Automatically attempts conversion</strong> for SRA files that exist but lack FASTQ files</p></li>
</ol>
<p><strong>Error Messages</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">⚠️</span> <span class="pre">SRA</span> <span class="pre">exists</span> <span class="pre">but</span> <span class="pre">no</span> <span class="pre">FASTQ</span> <span class="pre">(conversion</span> <span class="pre">may</span> <span class="pre">have</span> <span class="pre">failed</span> <span class="pre">or</span> <span class="pre">produced</span> <span class="pre">0</span> <span class="pre">reads)</span></code> - SRA file downloaded but conversion failed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">⚠️</span> <span class="pre">getfastq</span> <span class="pre">succeeded</span> <span class="pre">but</span> <span class="pre">no</span> <span class="pre">files</span> <span class="pre">found</span> <span class="pre">(may</span> <span class="pre">have</span> <span class="pre">produced</span> <span class="pre">0</span> <span class="pre">reads)</span></code> - No files at all, likely 0-read case or LITE file</p></li>
</ul>
<p><strong>Manual Check</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if sample directory has files</span>
ls<span class="w"> </span>-la<span class="w"> </span>output/amalgkit/work/fastq/getfastq/SRR123456/

<span class="c1"># If empty or only has .sra file, the download produced 0 reads</span>

<span class="c1"># Check metadata for lite files</span>
grep<span class="w"> </span><span class="s2">&quot;SRR123456&quot;</span><span class="w"> </span>output/amalgkit/work/metadata/metadata.tsv<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;lite&quot;</span>
</pre></div>
</div>
<p><strong>Workflow Behavior</strong>: The workflow automatically:</p>
<ul class="simple">
<li><p>Detects these cases immediately after getfastq completes</p></li>
<li><p>Attempts automatic SRA-to-FASTQ conversion for existing SRA files</p></li>
<li><p>Marks the sample as failed if conversion fails (doesn’t wait indefinitely)</p></li>
<li><p>Continues with other samples</p></li>
<li><p>Reports failed samples in the final summary</p></li>
</ul>
</section>
<section id="issue-disk-limit-exceeded-during-sra-extraction">
<h3>Issue: “disk-limit exceeded” during SRA extraction<a class="headerlink" href="#issue-disk-limit-exceeded-during-sra-extraction" title="Link to this heading"></a></h3>
<p><strong>Symptoms</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fasterq-dump</span></code> fails with “disk-limit exceeded!” error</p></li>
<li><p>SRA file exists but extraction fails</p></li>
<li><p>Even though disk has sufficient space</p></li>
</ul>
<p><strong>Root Cause</strong>: <code class="docutils literal notranslate"><span class="pre">fasterq-dump</span></code> has an internal disk space check that can fail even when sufficient space is available, especially if the default temporary directory (<code class="docutils literal notranslate"><span class="pre">/tmp</span></code>) is small or full. Additionally, <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> may be a tmpfs (RAM-based filesystem) with limited space.</p>
<p><strong>Solutions Implemented</strong>:</p>
<ol class="arabic">
<li><p><strong>Automatic TMPDIR Configuration</strong> (Primary Fix):</p>
<ul class="simple">
<li><p><strong>Location</strong>: <code class="docutils literal notranslate"><span class="pre">src/metainformant/rna/amalgkit.py::run_amalgkit()</span></code></p></li>
<li><p><strong>Purpose</strong>: Automatically sets <code class="docutils literal notranslate"><span class="pre">TMPDIR</span></code>, <code class="docutils literal notranslate"><span class="pre">TEMP</span></code>, and <code class="docutils literal notranslate"><span class="pre">TMP</span></code> environment variables to repository’s <code class="docutils literal notranslate"><span class="pre">.tmp/fasterq-dump</span></code> directory before running getfastq step</p></li>
<li><p><strong>Implementation</strong>:</p>
<ul>
<li><p>Detects when <code class="docutils literal notranslate"><span class="pre">subcommand</span> <span class="pre">==</span> <span class="pre">&quot;getfastq&quot;</span></code></p></li>
<li><p>Sets <code class="docutils literal notranslate"><span class="pre">TMPDIR</span></code> to <code class="docutils literal notranslate"><span class="pre">{repo_root}/.tmp/fasterq-dump</span></code> (on external drive with sufficient space)</p></li>
<li><p>Creates directory if it doesn’t exist</p></li>
<li><p>Passes environment to subprocess calls</p></li>
</ul>
</li>
<li><p><strong>Benefits</strong>:</p>
<ul>
<li><p>Prevents “disk-limit exceeded” errors when <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> is full</p></li>
<li><p>Uses external drive space instead of limited tmpfs</p></li>
<li><p>Works automatically without user configuration</p></li>
</ul>
</li>
<li><p><strong>Code Location</strong>: <code class="docutils literal notranslate"><span class="pre">src/metainformant/rna/amalgkit.py::run_amalgkit()</span></code> (lines 299-318 and 392-406)</p></li>
</ul>
</li>
<li><p><strong>Automatic vdb-config Repository Path Configuration</strong> (For Prefetch Downloads):</p>
<ul class="simple">
<li><p><strong>Location</strong>: <code class="docutils literal notranslate"><span class="pre">src/metainformant/rna/workflow.py::execute_workflow()</span></code></p></li>
<li><p><strong>Purpose</strong>: Configures vdb-config repository root to point to amalgkit fastq output directory</p></li>
<li><p><strong>Implementation</strong>:</p>
<ul>
<li><p>Detects when getfastq step is in workflow</p></li>
<li><p>Gets fastq output directory from getfastq step parameters</p></li>
<li><p>Sets vdb-config repository root to <code class="docutils literal notranslate"><span class="pre">{fastq_dir}/getfastq</span></code> (where amalgkit expects SRA files)</p></li>
<li><p>This ensures <code class="docutils literal notranslate"><span class="pre">prefetch</span></code> downloads SRA files to the correct location</p></li>
</ul>
</li>
<li><p><strong>Benefits</strong>:</p>
<ul>
<li><p>Prevents “SRA file download failed” errors where prefetch downloads to wrong location</p></li>
<li><p>Ensures SRA files are in the location amalgkit expects them</p></li>
<li><p>Works automatically without user configuration</p></li>
</ul>
</li>
<li><p><strong>Code Location</strong>: <code class="docutils literal notranslate"><span class="pre">src/metainformant/rna/workflow.py::execute_workflow()</span></code> (lines 422-460)</p></li>
<li><p><strong>Note</strong>: vdb-config repository root (for prefetch) is different from VDB_CONFIG environment variable (for cache/temp)</p></li>
</ul>
</li>
<li><p><strong>Wrapper Script for <code class="docutils literal notranslate"><span class="pre">amalgkit</span></code> Calls</strong> (Legacy/Alternative):</p>
<ul>
<li><p><strong>Location</strong>: <code class="docutils literal notranslate"><span class="pre">{fastq_dir}/temp/fasterq-dump</span></code></p></li>
<li><p><strong>Purpose</strong>: Automatically injects <code class="docutils literal notranslate"><span class="pre">--size-check</span> <span class="pre">off</span></code> into all <code class="docutils literal notranslate"><span class="pre">fasterq-dump</span></code> calls made by <code class="docutils literal notranslate"><span class="pre">amalgkit</span></code></p></li>
<li><p><strong>Implementation</strong>:</p>
<ul>
<li><p>Created automatically in <code class="docutils literal notranslate"><span class="pre">process_samples.py</span></code> when setting up download workers</p></li>
<li><p>Injected into PATH for <code class="docutils literal notranslate"><span class="pre">amalgkit</span></code> processes via environment variable</p></li>
<li><p>Wrapper script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">exec</span><span class="w"> </span>/usr/bin/fasterq-dump<span class="w"> </span>--size-check<span class="w"> </span>off<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><strong>Code Location</strong>: <code class="docutils literal notranslate"><span class="pre">src/metainformant/rna/steps/process_samples.py::_download_worker()</span></code> (lines 259-270)</p></li>
</ul>
</li>
<li><p><strong>Direct Binary Detection for Manual Conversion</strong>:</p>
<ul class="simple">
<li><p><strong>Location</strong>: <code class="docutils literal notranslate"><span class="pre">src/metainformant/rna/steps/getfastq.py::convert_sra_to_fastq()</span></code></p></li>
<li><p><strong>Purpose</strong>: Ensures direct calls to <code class="docutils literal notranslate"><span class="pre">convert_sra_to_fastq()</span></code> use the real <code class="docutils literal notranslate"><span class="pre">fasterq-dump</span></code> binary, not the wrapper</p></li>
<li><p><strong>Implementation</strong>:</p>
<ul>
<li><p>Checks system locations first (<code class="docutils literal notranslate"><span class="pre">/usr/bin/fasterq-dump</span></code>, <code class="docutils literal notranslate"><span class="pre">/usr/local/bin/fasterq-dump</span></code>)</p></li>
<li><p>Filters out wrapper scripts (checks if “temp” is in the path)</p></li>
<li><p>Explicitly passes <code class="docutils literal notranslate"><span class="pre">--size-check</span> <span class="pre">off</span></code> to the real binary</p></li>
</ul>
</li>
<li><p><strong>Code Location</strong>: <code class="docutils literal notranslate"><span class="pre">src/metainformant/rna/steps/getfastq.py::convert_sra_to_fastq()</span></code> (lines 578-614)</p></li>
</ul>
</li>
<li><p><strong>Automatic SRA-to-FASTQ Conversion</strong>:</p>
<ul class="simple">
<li><p><strong>Location</strong>: <code class="docutils literal notranslate"><span class="pre">src/metainformant/rna/steps/getfastq.py::run()</span></code></p></li>
<li><p><strong>Purpose</strong>: Automatically converts SRA files to FASTQ when SRA files exist but FASTQ files are missing</p></li>
<li><p><strong>Implementation</strong>:</p>
<ul>
<li><p>Detects samples with SRA files but no FASTQ files</p></li>
<li><p>Automatically calls <code class="docutils literal notranslate"><span class="pre">convert_sra_to_fastq()</span></code> for each sample</p></li>
<li><p>Logs success/failure for each conversion attempt</p></li>
</ul>
</li>
<li><p><strong>Code Location</strong>: <code class="docutils literal notranslate"><span class="pre">src/metainformant/rna/steps/getfastq.py::run()</span></code> (lines 274-295)</p></li>
</ul>
</li>
<li><p><strong>LITE SRA File Handling</strong>:</p>
<ul class="simple">
<li><p><strong>Location</strong>: Configuration files and workflow validation</p></li>
<li><p><strong>Purpose</strong>: Prevents downloading metadata-only LITE SRA files</p></li>
<li><p><strong>Implementation</strong>:</p>
<ul>
<li><p>Configuration option to disable NCBI/GCP sources that have LITE files</p></li>
<li><p>Use AWS only when LITE files are detected</p></li>
<li><p>Validation detects 0-read cases and marks downloads as failed</p></li>
</ul>
</li>
<li><p><strong>Code Location</strong>:</p>
<ul>
<li><p>Configuration: <code class="docutils literal notranslate"><span class="pre">config/amalgkit/amalgkit_pogonomyrmex_barbatus.yaml</span></code></p></li>
<li><p>Validation: <code class="docutils literal notranslate"><span class="pre">src/metainformant/rna/steps/process_samples.py::_download_worker()</span></code> (lines 315-327)</p></li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>Workflow Integration</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Download Phase</strong> (<code class="docutils literal notranslate"><span class="pre">_download_worker</span></code>):</p>
<ul class="simple">
<li><p>Creates wrapper script if it doesn’t exist</p></li>
<li><p>Injects wrapper into PATH for <code class="docutils literal notranslate"><span class="pre">amalgkit</span> <span class="pre">getfastq</span></code> calls</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amalgkit</span></code> uses wrapper, which adds <code class="docutils literal notranslate"><span class="pre">--size-check</span> <span class="pre">off</span></code> automatically</p></li>
<li><p>Validates FASTQ files exist after download</p></li>
</ul>
</li>
<li><p><strong>Automatic Conversion</strong> (<code class="docutils literal notranslate"><span class="pre">getfastq.run</span></code>):</p>
<ul class="simple">
<li><p>Detects samples with SRA but no FASTQ</p></li>
<li><p>Calls <code class="docutils literal notranslate"><span class="pre">convert_sra_to_fastq()</span></code> for each sample</p></li>
<li><p>Uses real binary (not wrapper) with explicit <code class="docutils literal notranslate"><span class="pre">--size-check</span> <span class="pre">off</span></code></p></li>
</ul>
</li>
<li><p><strong>Quantification Phase</strong>:</p>
<ul class="simple">
<li><p>Proceeds once FASTQ files are available</p></li>
<li><p>Deletes FASTQ files after quantification (if configured)</p></li>
</ul>
</li>
</ol>
<p><strong>Manual Fix</strong> (if needed):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create wrapper manually</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>output/amalgkit/work/fastq/temp
cat<span class="w"> </span>&gt;<span class="w"> </span>output/amalgkit/work/fastq/temp/fasterq-dump<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>
<span class="s">exec /usr/bin/fasterq-dump --size-check off &quot;$@&quot;</span>
<span class="s">EOF</span>
chmod<span class="w"> </span>+x<span class="w"> </span>output/amalgkit/work/fastq/temp/fasterq-dump

<span class="c1"># Or configure vdb-config repository root manually (for prefetch downloads)</span>
<span class="c1"># This should point to where amalgkit expects SRA files: {fastq_dir}/getfastq</span>
vdb-config<span class="w"> </span>-s<span class="w"> </span>/repository/user/main/public/root<span class="o">=</span>/path/to/amalgkit/fastq/getfastq

<span class="c1"># Note: The workflow automatically configures vdb-config repository root to the correct location.</span>
<span class="c1"># Manual configuration is rarely needed.</span>
</pre></div>
</div>
<p><strong>Note</strong>: The workflow handles this automatically - manual intervention is rarely needed.</p>
<p><strong>Testing</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test wrapper</span>
output/amalgkit/pogonomyrmex_barbatus/fastq/temp/fasterq-dump<span class="w"> </span>--help
<span class="c1"># Should show help with --size-check off already applied</span>

<span class="c1"># Test direct conversion</span>
python3<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">from pathlib import Path</span>
<span class="s2">from metainformant.rna.steps.getfastq import convert_sra_to_fastq</span>
<span class="s2">success, msg, files = convert_sra_to_fastq(</span>
<span class="s2">    &#39;SRR123456&#39;,</span>
<span class="s2">    Path(&#39;path/to/SRR123456.sra&#39;),</span>
<span class="s2">    Path(&#39;output/dir&#39;),</span>
<span class="s2">    threads=4</span>
<span class="s2">)</span>
<span class="s2">print(f&#39;Success: {success}, Files: {len(files)}&#39;)</span>
<span class="s2">&quot;</span>
</pre></div>
</div>
<p><strong>Expected Behavior</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Wrapper for amalgkit</strong>: All <code class="docutils literal notranslate"><span class="pre">amalgkit</span> <span class="pre">getfastq</span></code> calls use wrapper → no “disk-limit exceeded” errors</p></li>
<li><p><strong>Direct conversion</strong>: Uses real binary with explicit flag → no duplicate flag errors</p></li>
<li><p><strong>Automatic recovery</strong>: SRA files without FASTQ are automatically converted</p></li>
<li><p><strong>LITE file detection</strong>: 0-read cases are detected and marked as failed</p></li>
</ol>
</section>
<section id="issue-prefetch-command-not-found">
<h3>Issue: “prefetch: command not found”<a class="headerlink" href="#issue-prefetch-command-not-found" title="Link to this heading"></a></h3>
<p><strong>Solutions</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install SRA toolkit (system tool)</span>
conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>bioconda<span class="w"> </span>sra-tools
<span class="c1"># Or using system package manager:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>sra-toolkit

<span class="c1"># Or specify full path</span>
--prefetch_exe<span class="w"> </span>/path/to/prefetch

<span class="c1"># Note: For Python packages, use uv pip install (primary method)</span>
</pre></div>
</div>
</section>
<section id="issue-download-very-slow">
<h3>Issue: Download very slow<a class="headerlink" href="#issue-download-very-slow" title="Link to this heading"></a></h3>
<p><strong>Diagnosis</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check network speed</span>
curl<span class="w"> </span>-o<span class="w"> </span>/dev/null<span class="w"> </span>http://speedtest.tele2.net/100MB.zip

<span class="c1"># Check which source is being used (check logs)</span>
</pre></div>
</div>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Try different download source:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Disable slow sources</span>
--ncbi<span class="w"> </span>no<span class="w"> </span>--aws<span class="w"> </span>yes<span class="w"> </span>--gcp<span class="w"> </span>yes
</pre></div>
</div>
</li>
<li><p>Increase bandwidth:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># If on institutional network with throttling</span>
<span class="c1"># Contact IT to allowlist NCBI/AWS/GCP domains</span>
</pre></div>
</div>
</li>
<li><p>Download during off-peak hours</p></li>
</ol>
</section>
<section id="issue-disk-space-exhausted">
<h3>Issue: Disk space exhausted<a class="headerlink" href="#issue-disk-space-exhausted" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">OSError</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">28</span><span class="p">]</span> <span class="n">No</span> <span class="n">space</span> <span class="n">left</span> <span class="n">on</span> <span class="n">device</span>
</pre></div>
</div>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Enable SRA removal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--remove_sra<span class="w"> </span>yes<span class="w">  </span><span class="c1"># Delete SRA after extraction</span>
</pre></div>
</div>
</li>
<li><p>Use external storage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--out_dir<span class="w"> </span>/mnt/large_disk/amalgkit/work
</pre></div>
</div>
</li>
<li><p>Process in smaller batches:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download 10 samples at a time</span>
head<span class="w"> </span>-11<span class="w"> </span>metadata.tsv<span class="w"> </span>&gt;<span class="w"> </span>batch1.tsv<span class="w">  </span><span class="c1"># Include header + 10 samples</span>
tail<span class="w"> </span>-n<span class="w"> </span>+2<span class="w"> </span>metadata.tsv<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10<span class="w"> </span><span class="p">|</span><span class="w"> </span>cat<span class="w"> </span>&lt;<span class="o">(</span>head<span class="w"> </span>-1<span class="w"> </span>metadata.tsv<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>&gt;<span class="w"> </span>batch1.tsv
amalgkit<span class="w"> </span>getfastq<span class="w"> </span>--metadata<span class="w"> </span>batch1.tsv<span class="w"> </span>...
</pre></div>
</div>
</li>
<li><p>Check and clean temporary files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove old downloads</span>
rm<span class="w"> </span>-rf<span class="w"> </span>output/amalgkit/work/getfastq/*/SRR*.sra
</pre></div>
</div>
</li>
</ol>
</section>
<section id="issue-sra-extraction-fails">
<h3>Issue: SRA extraction fails<a class="headerlink" href="#issue-sra-extraction-fails" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parallel</span><span class="o">-</span><span class="n">fastq</span><span class="o">-</span><span class="n">dump</span><span class="p">:</span> <span class="n">error</span> <span class="n">reading</span> <span class="n">SRA</span> <span class="n">file</span>
</pre></div>
</div>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Retry with fasterq-dump:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--pfd<span class="w"> </span>no<span class="w">  </span><span class="c1"># Use fasterq-dump instead</span>
</pre></div>
</div>
</li>
<li><p>Check SRA file integrity:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vdb-validate<span class="w"> </span>output/work/getfastq/SRR*/SRR*.sra
</pre></div>
</div>
</li>
<li><p>Re-download with <code class="docutils literal notranslate"><span class="pre">--redo</span> <span class="pre">yes</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>getfastq<span class="w"> </span>--redo<span class="w"> </span>yes<span class="w"> </span>--id<span class="w"> </span>SRR12345678
</pre></div>
</div>
</li>
</ol>
</section>
<section id="issue-fastp-quality-filtering-too-aggressive">
<h3>Issue: fastp quality filtering too aggressive<a class="headerlink" href="#issue-fastp-quality-filtering-too-aggressive" title="Link to this heading"></a></h3>
<p><strong>Diagnosis</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check fastp.json for filtering stats</span>
cat<span class="w"> </span>output/work/getfastq/SRR12345678/fastp.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;total_reads&quot;</span>
</pre></div>
</div>
<p><strong>Solutions</strong>:</p>
<ol class="arabic">
<li><p>Lower minimum read length:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--min_read_length<span class="w"> </span><span class="m">20</span><span class="w">  </span><span class="c1"># Instead of 25</span>
</pre></div>
</div>
</li>
<li><p>Disable fastp:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--fastp<span class="w"> </span>no
</pre></div>
</div>
</li>
<li><p>Customize fastp options:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--fastp_option<span class="w"> </span><span class="s2">&quot;-q 15 -u 50 -j /dev/null -h /dev/null&quot;</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h2>
<section id="always-remove-sra-files">
<h3>1. Always Remove SRA Files<a class="headerlink" href="#always-remove-sra-files" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good: Clean up as you go</span>
--remove_sra<span class="w"> </span>yes

<span class="c1"># Bad: Wastes enormous disk space</span>
--remove_sra<span class="w"> </span>no
</pre></div>
</div>
</section>
<section id="use-quality-filtering">
<h3>2. Use Quality Filtering<a class="headerlink" href="#use-quality-filtering" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good: Clean, high-quality reads</span>
--fastp<span class="w"> </span>yes<span class="w"> </span>--min_read_length<span class="w"> </span><span class="m">25</span>

<span class="c1"># Less optimal: Raw reads with adapters/low quality</span>
--fastp<span class="w"> </span>no
</pre></div>
</div>
</section>
<section id="enable-all-download-sources">
<h3>3. Enable All Download Sources<a class="headerlink" href="#enable-all-download-sources" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Good: Fast, reliable downloads</span>
--ncbi<span class="w"> </span>yes<span class="w"> </span>--aws<span class="w"> </span>yes<span class="w"> </span>--gcp<span class="w"> </span>yes

<span class="c1"># Less optimal: Slow, limited to one source</span>
--ncbi<span class="w"> </span>yes<span class="w"> </span>--aws<span class="w"> </span>no<span class="w"> </span>--gcp<span class="w"> </span>no
</pre></div>
</div>
</section>
<section id="monitor-disk-space">
<h3>4. Monitor Disk Space<a class="headerlink" href="#monitor-disk-space" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Before starting</span>
df<span class="w"> </span>-h<span class="w"> </span>output/

<span class="c1"># During download (in another terminal)</span>
watch<span class="w"> </span>-n<span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="s1">&#39;df -h output/ &amp;&amp; du -sh output/amalgkit/*/getfastq/&#39;</span>

<span class="c1"># Set up automatic cleanup</span>
--remove_sra<span class="w"> </span>yes<span class="w"> </span>--remove_tmp<span class="w"> </span>yes
</pre></div>
</div>
</section>
<section id="test-with-small-subset-first">
<h3>5. Test with Small Subset First<a class="headerlink" href="#test-with-small-subset-first" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test workflow with 1-2 samples</span>
head<span class="w"> </span>-3<span class="w"> </span>metadata.tsv<span class="w"> </span>&gt;<span class="w"> </span>test.tsv
amalgkit<span class="w"> </span>getfastq<span class="w"> </span>--metadata<span class="w"> </span>test.tsv<span class="w"> </span>--threads<span class="w"> </span><span class="m">8</span>

<span class="c1"># If successful, run full dataset</span>
amalgkit<span class="w"> </span>getfastq<span class="w"> </span>--metadata<span class="w"> </span>metadata.tsv<span class="w"> </span>--threads<span class="w"> </span><span class="m">12</span>
</pre></div>
</div>
</section>
</section>
<section id="real-world-examples">
<h2>Real-World Examples<a class="headerlink" href="#real-world-examples" title="Link to this heading"></a></h2>
<section id="example-1-apis-mellifera-83-brain-samples">
<h3>Example 1: Apis mellifera (83 Brain Samples)<a class="headerlink" href="#example-1-apis-mellifera-83-brain-samples" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>getfastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/amellifera/fastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/amalgkit/amellifera/work/metadata/metadata.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--pfd<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--fastp<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--remove_sra<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--min_read_length<span class="w"> </span><span class="m">25</span>
</pre></div>
</div>
<p><strong>Result</strong>: Downloaded 83 samples, ~350GB total, 12 hours runtime</p>
</section>
<section id="example-2-pogonomyrmex-barbatus-120-samples">
<h3>Example 2: Pogonomyrmex barbatus (120 Samples)<a class="headerlink" href="#example-2-pogonomyrmex-barbatus-120-samples" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>amalgkit<span class="w"> </span>getfastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--out_dir<span class="w"> </span>output/amalgkit/pogonomyrmex_barbatus/fastq<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--metadata<span class="w"> </span>output/amalgkit/pogonomyrmex_barbatus/work/metadata/metadata.tsv<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--aws<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ncbi<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--gcp<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--remove_sra<span class="w"> </span>yes
</pre></div>
</div>
<p><strong>Result</strong>: Multi-source downloads with automatic retry logic, 8 hours total</p>
</section>
</section>
<section id="integration-with-metainformant-workflow">
<h2>Integration with METAINFORMANT Workflow<a class="headerlink" href="#integration-with-metainformant-workflow" title="Link to this heading"></a></h2>
<section id="automatic-execution">
<h3>Automatic Execution<a class="headerlink" href="#automatic-execution" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.rna.workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">execute_workflow</span><span class="p">,</span> <span class="n">load_workflow_config</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">load_workflow_config</span><span class="p">(</span><span class="s2">&quot;config/amalgkit_amellifera.yaml&quot;</span><span class="p">)</span>
<span class="n">execute_workflow</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>  <span class="c1"># getfastq runs automatically after select</span>
</pre></div>
</div>
</section>
<section id="enhanced-error-recovery">
<h3>Enhanced Error Recovery<a class="headerlink" href="#enhanced-error-recovery" title="Link to this heading"></a></h3>
<p>The METAINFORMANT workflow adds automatic retry logic:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># From src/metainformant/rna/steps/getfastq.py</span>
<span class="c1"># Features:</span>
<span class="c1"># - 3 retries per sample</span>
<span class="c1"># - Fallback to prefetch+fasterq-dump if parallel-fastq-dump fails</span>
<span class="c1"># - Targeted re-download of missing samples</span>
<span class="c1"># - Comprehensive error logging</span>
</pre></div>
</div>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="nt">getfastq</span><span class="p">:</span>
<span class="w">    </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="w">    </span><span class="nt">pfd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">fastp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">remove_sra</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">accelerate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w">  </span><span class="c1"># METAINFORMANT-specific: enables retry logic</span>
</pre></div>
</div>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>SRA Toolkit Documentation</strong>: https://github.com/ncbi/sra-tools</p></li>
<li><p><strong>fastp</strong>: https://github.com/OpenGene/fastp</p></li>
<li><p><strong>NCBI Cloud Data</strong>: https://www.ncbi.nlm.nih.gov/sra/docs/sra-cloud/</p></li>
<li><p><strong>METAINFORMANT Workflow</strong>: <code class="docutils literal notranslate"><span class="pre">docs/rna/workflow.md</span></code></p></li>
</ul>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Previous Step</strong>: <a class="reference internal" href="03_select.html"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">03_select.md</span></code></span></a> - Selecting samples for download</p></li>
<li><p><strong>Next Step</strong>: <a class="reference internal" href="05_integrate.html"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">05_integrate.md</span></code></span></a> - Integrating FASTQ info into metadata</p></li>
<li><p><strong>Next Step</strong>: <a class="reference internal" href="06_quant.html"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">06_quant.md</span></code></span></a> - Quantifying gene expression</p></li>
<li><p><strong>Workflow Overview</strong>: <a class="reference internal" href="../amalgkit.html"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">../amalgkit.md</span></code></span></a></p></li>
<li><p><strong>Testing</strong>: <code class="docutils literal notranslate"><span class="pre">tests/test_rna_amalgkit_steps.py::test_getfastq_basic_execution</span></code></p></li>
</ul>
<hr class="docutils" />
<p><strong>Last Updated</strong>: October 29, 2025<br />
<strong>AMALGKIT Version</strong>: 0.12.19<br />
<strong>Status</strong>: ✅ Production-ready, comprehensively tested, enhanced with METAINFORMANT retry logic</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, METAINFORMANT Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>