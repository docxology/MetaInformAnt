

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Testing &mdash; METAINFORMANT 0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=938c9ccc"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Life Events Module" href="life_events/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="index.html" class="icon icon-home">
            METAINFORMANT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dna/index.html">DNA: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="rna/index.html">RNA: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="protein/index.html">Protein: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="gwas/index.html">GWAS (Genome-Wide Association Studies)</a></li>
<li class="toctree-l1"><a class="reference internal" href="epigenome/index.html">Epigenome: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="epigenome/index.html#key-components">Key Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="epigenome/index.html#integration-with-genomics">Integration with Genomics</a></li>
<li class="toctree-l1"><a class="reference internal" href="epigenome/index.html#analysis-workflows">Analysis Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="epigenome/index.html#planned-extensions">Planned Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="ontology/index.html">Ontology Module Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="phenotype/index.html">Phenotype: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecology/index.html">Ecology: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecology/index.html#key-components">Key Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecology/index.html#analysis-workflows">Analysis Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecology/index.html#integration-with-other-modules">Integration with Other Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecology/index.html#planned-extensions">Planned Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/index.html">Math: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml/index.html">Machine Learning: Biological Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks/index.html">Networks: Biological Network Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="singlecell/index.html">Single-Cell Genomics</a></li>
<li class="toctree-l1"><a class="reference internal" href="quality/index.html">Quality Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization/index.html">Visualization: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation/index.html">Simulation: Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="life_events/index.html">Life Events Module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quality-assurance-framework">Quality Assurance Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#quality-assurance-architecture">Quality Assurance Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-execution-pipeline">Test Execution Pipeline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#code-quality-policy-strictly-no-mocks-fakes-placeholders">Code Quality Policy (STRICTLY NO MOCKS/FAKES/PLACEHOLDERS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uv-based-testing-workflow">UV-Based Testing Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#environment-setup">Environment Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-dependency-groups">Test Dependency Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-tests">Running Tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-execution">Basic Execution</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#professional-test-runner">Professional Test Runner</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-categories">Test Categories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#timeout-configuration">Timeout Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#test-structure-and-organization">Test Structure and Organization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#directory-layout">Directory Layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-coverage-matrix">Test Coverage Matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-conventions">Test Conventions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#file-organization">File Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#test-isolation">Test Isolation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-test-structure">Example Test Structure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#network-and-external-tool-testing">Network and External Tool Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#network-tests">Network Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#external-tool-tests">External Tool Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-data-management">Test Data Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-fixtures">Input Fixtures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-management">Output Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-test-data-handling">Example Test Data Handling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#continuous-integration">Continuous Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ci-configuration">CI Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-selection">Test Selection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#test-execution-speed">Test Execution Speed</a></li>
<li class="toctree-l3"><a class="reference internal" href="#large-dataset-testing">Large Dataset Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#development-workflow">Development Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#test-driven-development">Test-Driven Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-tests-during-development">Running Tests During Development</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#uv-related-issues">UV-Related Issues</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#uv-not-found">UV Not Found</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dependency-sync-issues">Dependency Sync Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fat-filesystem-issues">FAT Filesystem Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="#test-environment-not-ready">Test Environment Not Ready</a></li>
<li class="toctree-l4"><a class="reference internal" href="#network-tests-failing">Network Tests Failing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#external-tool-tests-failing">External Tool Tests Failing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common-test-failures">Common Test Failures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#import-errors">Import Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#permission-errors">Permission Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#memory-issues">Memory Issues</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">METAINFORMANT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Testing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/testing.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Link to this heading"></a></h1>
<section id="quality-assurance-framework">
<h2>Quality Assurance Framework<a class="headerlink" href="#quality-assurance-framework" title="Link to this heading"></a></h2>
<p>METAINFORMANT implements a comprehensive quality assurance framework combining automated testing, code quality checks, and validation processes.</p>
<section id="quality-assurance-architecture">
<h3>Quality Assurance Architecture<a class="headerlink" href="#quality-assurance-architecture" title="Link to this heading"></a></h3>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>graph TD
    AcodeDevelopment[Code Development] --&gt; BstaticAnalysis[Static Analysis]
    B --&gt; CtypeChecking[Type Checking]
    C --&gt; D[Linting]

    D --&gt; EunitTesting[Unit Testing]
    E --&gt; FintegrationTesting[Integration Testing]
    F --&gt; Gend-to-endTesting[End-to-End Testing]

    G --&gt; HperformanceTesting[Performance Testing]
    H --&gt; IloadTesting[Load Testing]

    I --&gt; JqualityGates[Quality Gates]
    J --&gt; K{All Passed?}

    K --&gt;|Yes| LreleaseReady[Release Ready]
    K --&gt;|No| MissueResolution[Issue Resolution]

    M --&gt; A


    subgraph &quot;Automated Checks&quot;
        N[mypy] -.-&gt; C
        O[ruff] -.-&gt; D
        P[black] -.-&gt; D
        Q[isort] -.-&gt; D
    end

    subgraph &quot;Test Categories&quot;
        R[pytest] -.-&gt; E
        SrealDataOnly[Real Data Only] -.-&gt; E
        TnoMocks[No Mocks] -.-&gt; E
        U[Integration] -.-&gt; F
    end

    subgraph &quot;Quality Metrics&quot;
        Vcoverage&gt;90%[Coverage &gt;90%] -.-&gt; J
        WzeroCriticalIssues[Zero Critical Issues] -.-&gt; J
        XperformanceBenchmarks[Performance Benchmarks] -.-&gt; J
        YdocumentationComplete[Documentation Complete] -.-&gt; J
    end
</pre></div>
</div>
</section>
<section id="test-execution-pipeline">
<h3>Test Execution Pipeline<a class="headerlink" href="#test-execution-pipeline" title="Link to this heading"></a></h3>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>graph TD
    AtestSuite[Test Suite] --&gt; BenvironmentSetup[Environment Setup]
    B --&gt; CdependencyVerification[Dependency Verification]

    C --&gt; DtestDiscovery[Test Discovery]
    D --&gt; EtestCollection[Test Collection]

    E --&gt; F{Test Category}
    F --&gt;|Unit| GfastExecution[Fast Execution]
    F --&gt;|Integration| HworkflowTesting[Workflow Testing]
    F --&gt;|E2E| IfullPipeline[Full Pipeline]

    G --&gt; JparallelExecution[Parallel Execution]
    H --&gt; J
    I --&gt; J

    J --&gt; KresultCollection[Result Collection]
    K --&gt; LcoverageAnalysis[Coverage Analysis]

    L --&gt; MreportGeneration[Report Generation]
    M --&gt; N{Quality Standards Met?}

    N --&gt;|Yes| OqualityAssurancePass[Quality Assurance Pass]
    N --&gt;|No| PfailureAnalysis[Failure Analysis]

    P --&gt; QissueClassification[Issue Classification]
    Q --&gt; RfixImplementation[Fix Implementation]

    R --&gt; S[Re-testing]
    S --&gt; N


    subgraph &quot;Execution Environment&quot;
        TuvVenv[uv venv] -.-&gt; B
        U[Dependencies] -.-&gt; C
        VtestData[Test Data] -.-&gt; C
        WexternalTools[External Tools] -.-&gt; C
    end

    subgraph &quot;Test Organization&quot;
        Xtests/test*.py[tests/test_*.py] -.-&gt; D
        Y[Domain-specific] -.-&gt; F
        ZintegrationTests[Integration Tests] -.-&gt; F
        AAe2eTests[E2E Tests] -.-&gt; F
    end

    subgraph &quot;Quality Metrics&quot;
        BBlineCoverage[Line Coverage] -.-&gt; L
        CCbranchCoverage[Branch Coverage] -.-&gt; L
        DDmutationTesting[Mutation Testing] -.-&gt; L
        EEperformanceBenchmarks[Performance Benchmarks] -.-&gt; L
    end
</pre></div>
</div>
</section>
</section>
<section id="code-quality-policy-strictly-no-mocks-fakes-placeholders">
<h2>Code Quality Policy (STRICTLY NO MOCKS/FAKES/PLACEHOLDERS)<a class="headerlink" href="#code-quality-policy-strictly-no-mocks-fakes-placeholders" title="Link to this heading"></a></h2>
<p><strong>ABSOLUTE PROHIBITION</strong>: Never use fake/mocked/stubbed methods, objects, or network shims in <strong>source code</strong> or tests.</p>
<p><strong>Source Code Policy</strong>: All production functions must perform real computations or make real API calls. <strong>NO DUMMY DATA RETURNS</strong>. Placeholder implementations that return hardcoded values are strictly prohibited.</p>
<p><strong>Real Implementation Only</strong>: All code must exercise real algorithms and external behavior:</p>
<ul class="simple">
<li><p><strong>Networked tests</strong>: perform real HTTP requests with short timeouts. If offline, skip gracefully with clear messages.</p></li>
<li><p><strong>CLI-dependent tests</strong> (e.g., amalgkit): run only when the dependency is available on PATH; otherwise skip with dependency notes.</p></li>
<li><p><strong>Database tests</strong>: use real database connections or skip when unavailable.</p></li>
<li><p><strong>API tests</strong>: make real API calls or skip when network/credentials unavailable.</p></li>
</ul>
<p><strong>Anti-Pattern Enforcement</strong>: Mocking is an anti-pattern that creates brittle tests disconnected from reality.</p>
<p><strong>Quality Assurance</strong>: Real implementations reveal actual bugs, performance issues, and integration problems.</p>
<p><strong>Environment Setup</strong>: It is acceptable to set environment variables for test setup, but do not monkeypatch or replace functions.</p>
<p><strong>Test Artifacts</strong>: Tests must write all artifacts only under <code class="docutils literal notranslate"><span class="pre">output/</span></code> directory.</p>
<p><strong>Reproducibility</strong>: Prefer deterministic seeds and stable filenames for reproducible test runs.</p>
<p><strong>Clear Documentation</strong>: When external dependencies are unavailable, tests must clearly document what is being skipped and why.</p>
</section>
<section id="uv-based-testing-workflow">
<h2>UV-Based Testing Workflow<a class="headerlink" href="#uv-based-testing-workflow" title="Link to this heading"></a></h2>
<section id="environment-setup">
<h3>Environment Setup<a class="headerlink" href="#environment-setup" title="Link to this heading"></a></h3>
<p>Before running tests, ensure your test environment is properly set up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup test environment (recommended first step)</span>
bash<span class="w"> </span>scripts/package/verify.sh<span class="w"> </span>--mode<span class="w"> </span>deps

<span class="c1"># Setup for specific test types</span>
bash<span class="w"> </span>scripts/package/verify.sh<span class="w"> </span>--mode<span class="w"> </span>deps<span class="w"> </span>--test-type<span class="w"> </span>fast<span class="w">    </span><span class="c1"># Core tests only</span>
bash<span class="w"> </span>scripts/package/verify.sh<span class="w"> </span>--mode<span class="w"> </span>deps<span class="w"> </span>--test-type<span class="w"> </span>network<span class="w"> </span><span class="c1"># Include network tests</span>
bash<span class="w"> </span>scripts/package/verify.sh<span class="w"> </span>--mode<span class="w"> </span>deps<span class="w"> </span>--test-type<span class="w"> </span>all<span class="w">     </span><span class="c1"># Full test suite</span>

<span class="c1"># Verify setup without installing</span>
bash<span class="w"> </span>scripts/package/verify.sh<span class="w"> </span>--mode<span class="w"> </span>deps<span class="w"> </span>--verify-only
</pre></div>
</div>
</section>
<section id="test-dependency-groups">
<h3>Test Dependency Groups<a class="headerlink" href="#test-dependency-groups" title="Link to this heading"></a></h3>
<p>METAINFORMANT uses UV dependency groups for different test scenarios:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">test-fast</span></code></strong>: Core functionality tests (minimal dependencies)</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">test-network</span></code></strong>: Include network-dependent tests</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">test-external</span></code></strong>: Include external CLI tool tests</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">test-all</span></code></strong>: Full test suite with all optional dependencies</p></li>
</ul>
</section>
<section id="running-tests">
<h3>Running Tests<a class="headerlink" href="#running-tests" title="Link to this heading"></a></h3>
<section id="basic-execution">
<h4>Basic Execution<a class="headerlink" href="#basic-execution" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run all tests with minimal output</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>-q

<span class="c1"># Run with coverage</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>--cov<span class="o">=</span>src/metainformant<span class="w"> </span>--cov-report<span class="o">=</span>html

<span class="c1"># Run specific test files</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/test_core_text.py<span class="w"> </span>-v
</pre></div>
</div>
<p><strong>Note</strong>: Test scripts automatically detect FAT filesystems and configure UV cache and virtual environment locations accordingly. On FAT filesystems, tests use <code class="docutils literal notranslate"><span class="pre">/tmp/metainformant_venv</span></code> if available. The setup script (<code class="docutils literal notranslate"><span class="pre">scripts/package/setup.sh</span></code>) shows real-time test progress with verbose output, making it easy to see which tests are running. See <a class="reference internal" href="UV_SETUP.html"><span class="std std-doc">UV Setup Guide</span></a> for details.</p>
</section>
</section>
<section id="professional-test-runner">
<h3>Professional Test Runner<a class="headerlink" href="#professional-test-runner" title="Link to this heading"></a></h3>
<p>Use the comprehensive test runner script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard test run (automatically handles FAT filesystems)</span>
bash<span class="w"> </span>scripts/package/test.sh

<span class="c1"># Fast tests only (skip slow/network/external dependencies)</span>
bash<span class="w"> </span>scripts/package/test.sh<span class="w"> </span>fast

<span class="c1"># Optimized test runner</span>
bash<span class="w"> </span>scripts/package/test.sh<span class="w"> </span>--mode<span class="w"> </span>fast

<span class="c1"># Include network tests</span>
bash<span class="w"> </span>scripts/package/test.sh<span class="w"> </span>network

<span class="c1"># Generate coverage reports</span>
bash<span class="w"> </span>scripts/package/test.sh<span class="w"> </span>coverage

<span class="c1"># Run tests matching a pattern</span>
bash<span class="w"> </span>scripts/package/test.sh<span class="w"> </span>all
</pre></div>
</div>
<p><strong>FAT Filesystem Support</strong>: All test scripts automatically detect FAT filesystems and use appropriate venv locations (<code class="docutils literal notranslate"><span class="pre">/tmp/metainformant_venv</span></code> on FAT, <code class="docutils literal notranslate"><span class="pre">.venv</span></code> on standard filesystems).</p>
</section>
<section id="test-categories">
<h3>Test Categories<a class="headerlink" href="#test-categories" title="Link to this heading"></a></h3>
<p>Tests are organized with custom pytest markers:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">slow</span></code></strong>: Tests that take significant time to complete</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">network</span></code></strong>: Tests requiring internet connectivity</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">external_tool</span></code></strong>: Tests requiring external CLI tools (e.g., amalgkit)</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">integration</span></code></strong>: End-to-end integration tests</p></li>
</ul>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h3>
<p>Test configuration is managed in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.pytest.ini_options]</span>
<span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w">  </span><span class="c1"># Default 10-second timeout for all tests</span>
<span class="n">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;--cov=src/metainformant&quot;</span><span class="p">]</span>
<span class="n">markers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;slow: marks tests as slow&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;network: marks tests as requiring network access&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;external_tool: marks tests as requiring external tools&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;integration: marks tests as integration tests&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">[tool.coverage.run]</span>
<span class="n">branch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="n">omit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*/tests/*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;*/__pycache__/*&quot;</span><span class="p">]</span>

<span class="k">[tool.coverage.report]</span>
<span class="n">exclude_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;pragma: no cover&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;def __repr__&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;raise AssertionError&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;raise NotImplementedError&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="timeout-configuration">
<h3>Timeout Configuration<a class="headerlink" href="#timeout-configuration" title="Link to this heading"></a></h3>
<p>Tests have a default 10-second timeout to prevent hanging. Slow tests can be marked with <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.slow</span></code> and run separately:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run fast tests only (default)</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/

<span class="c1"># Run all tests including slow ones</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/<span class="w"> </span>--runslow

<span class="c1"># Run only slow tests</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/<span class="w"> </span>-m<span class="w"> </span>slow

<span class="c1"># Skip network tests</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;not network&quot;</span>

<span class="c1"># Skip external tool tests</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;not external_tool&quot;</span>

<span class="c1"># Custom timeout for specific runs</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/<span class="w"> </span>--timeout<span class="o">=</span><span class="m">30</span>
</pre></div>
</div>
</section>
</section>
<section id="test-structure-and-organization">
<h2>Test Structure and Organization<a class="headerlink" href="#test-structure-and-organization" title="Link to this heading"></a></h2>
<section id="directory-layout">
<h3>Directory Layout<a class="headerlink" href="#directory-layout" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">tests/</span></code></strong>: All test files at repository root</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">tests/conftest.py</span></code></strong>: Shared pytest configuration and fixtures</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">tests/test_*.py</span></code></strong>: Individual test modules</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">tests/data/</span></code></strong>: Test input fixtures and data</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">output/</span></code></strong>: All test outputs and artifacts</p></li>
</ul>
</section>
<section id="test-coverage-matrix">
<h3>Test Coverage Matrix<a class="headerlink" href="#test-coverage-matrix" title="Link to this heading"></a></h3>
<p>The test suite provides comprehensive coverage:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Module</p></th>
<th class="head"><p>Primary Tests</p></th>
<th class="head"><p>Coverage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Core Utilities</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test_core_*.py</span></code></p></td>
<td><p>Config, I/O, text, logging, parallel, paths, cache, hash, db</p></td>
</tr>
<tr class="row-odd"><td><p>DNA Analysis</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test_dna_*.py</span></code></p></td>
<td><p>Sequences, alignment, MSA, phylogeny, population genetics, FASTQ</p></td>
</tr>
<tr class="row-even"><td><p>RNA Analysis</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test_rna_*.py</span></code></p></td>
<td><p>amalgkit wrapper, workflow, configs, step runners</p></td>
</tr>
<tr class="row-odd"><td><p>Single-Cell</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test_singlecell_*.py</span></code></p></td>
<td><p>Preprocessing, dimensionality, clustering, trajectory</p></td>
</tr>
<tr class="row-even"><td><p>Quality Control</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test_quality_*.py</span></code></p></td>
<td><p>FASTQ quality analysis, contamination detection</p></td>
</tr>
<tr class="row-odd"><td><p>Protein Analysis</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test_protein_*.py</span></code></p></td>
<td><p>UniProt, PDB, AlphaFold, InterPro, structure analysis</p></td>
</tr>
<tr class="row-even"><td><p>Mathematical Models</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test_math_*.py</span></code></p></td>
<td><p>Population genetics, coalescent, epidemiology, selection</p></td>
</tr>
<tr class="row-odd"><td><p>Simulation</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test_simulation.py</span></code></p></td>
<td><p>Sequence generation, RNA counts, agent-based models</p></td>
</tr>
<tr class="row-even"><td><p>Visualization</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test_visualization_*.py</span></code></p></td>
<td><p>Plots, trees, animations</p></td>
</tr>
<tr class="row-odd"><td><p>Ontology</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test_ontology_*.py</span></code></p></td>
<td><p>Gene Ontology, OBO parsing</p></td>
</tr>
<tr class="row-even"><td><p>CLI Interface</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">test_cli.py</span></code></p></td>
<td><p>Command-line argument parsing and dispatch</p></td>
</tr>
</tbody>
</table>
</section>
<section id="test-conventions">
<h3>Test Conventions<a class="headerlink" href="#test-conventions" title="Link to this heading"></a></h3>
<section id="file-organization">
<h4>File Organization<a class="headerlink" href="#file-organization" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><strong>One test file per source module</strong>: <code class="docutils literal notranslate"><span class="pre">src/foo/bar.py</span></code> → <code class="docutils literal notranslate"><span class="pre">tests/test_foo_bar.py</span></code></p></li>
<li><p><strong>Class-based organization</strong>: Group related tests in classes</p></li>
<li><p><strong>Descriptive test names</strong>: Use clear, descriptive function names</p></li>
</ul>
</section>
<section id="test-isolation">
<h4>Test Isolation<a class="headerlink" href="#test-isolation" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><strong>Setup/teardown</strong>: Use <code class="docutils literal notranslate"><span class="pre">setup_method</span></code> and <code class="docutils literal notranslate"><span class="pre">teardown_method</span></code> for clean environments</p></li>
<li><p><strong>Independent tests</strong>: Each test should be runnable in isolation</p></li>
<li><p><strong>Output directory</strong>: All test artifacts go to <code class="docutils literal notranslate"><span class="pre">output/</span></code> subdirectories</p></li>
</ul>
</section>
<section id="example-test-structure">
<h4>Example Test Structure<a class="headerlink" href="#example-test-structure" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.core.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">ensure_directory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.some_module</span><span class="w"> </span><span class="kn">import</span> <span class="n">some_function</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestSomeFunction</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup test environment.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">ensure_directory</span><span class="p">(</span><span class="s2">&quot;output/test_some_module&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">teardown_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cleanup after test.&quot;&quot;&quot;</span>
        <span class="c1"># Cleanup if needed (usually not required)</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_basic_functionality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test basic function behavior.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">some_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_edge_cases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test edge cases and error conditions.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">some_function</span><span class="p">(</span><span class="n">invalid_input</span><span class="p">)</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">slow</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_performance_intensive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that takes significant time.&quot;&quot;&quot;</span>
        <span class="c1"># Test implementation</span>
        <span class="k">pass</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">network</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_network_dependent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test requiring network access.&quot;&quot;&quot;</span>
        <span class="c1"># Skip if offline</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">some_network_function</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
            <span class="n">pytest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Network not available&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="network-and-external-tool-testing">
<h2>Network and External Tool Testing<a class="headerlink" href="#network-and-external-tool-testing" title="Link to this heading"></a></h2>
<section id="network-tests">
<h3>Network Tests<a class="headerlink" href="#network-tests" title="Link to this heading"></a></h3>
<p>Network-dependent tests use real API calls with graceful offline handling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_check_online</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if network connectivity is available.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://httpbin.org/status/200&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">network</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="ow">not</span> <span class="n">_check_online</span><span class="p">(),</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Network not available&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_uniprot_api</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test UniProt API with real network call.&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">metainformant.protein.uniprot</span><span class="w"> </span><span class="kn">import</span> <span class="n">map_ids_uniprot</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">map_ids_uniprot</span><span class="p">([</span><span class="s1">&#39;P12345&#39;</span><span class="p">],</span> <span class="n">from_db</span><span class="o">=</span><span class="s1">&#39;UniProtKB_AC-ID&#39;</span><span class="p">,</span> <span class="n">to_db</span><span class="o">=</span><span class="s1">&#39;Gene_Name&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>  <span class="c1"># May be empty if ID not found</span>
</pre></div>
</div>
</section>
<section id="external-tool-tests">
<h3>External Tool Tests<a class="headerlink" href="#external-tool-tests" title="Link to this heading"></a></h3>
<p>Tests requiring external CLI tools check for availability:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">external_tool</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="ow">not</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;amalgkit&quot;</span><span class="p">),</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;amalgkit not available&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_amalgkit_execution</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test amalgkit CLI tool integration.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;amalgkit&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
</section>
<section id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Link to this heading"></a></h2>
<p>Some tests require environment variables for configuration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For NCBI tests</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NCBI_EMAIL</span><span class="o">=</span><span class="s2">&quot;your.email@example.com&quot;</span>

<span class="c1"># For database tests</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">TEST_DATABASE_URL</span><span class="o">=</span><span class="s2">&quot;sqlite:///output/test.db&quot;</span>

<span class="c1"># Run tests with environment</span>
./scripts/package/test.sh<span class="w"> </span>--mode<span class="w"> </span>network
</pre></div>
</div>
</section>
<section id="test-data-management">
<h2>Test Data Management<a class="headerlink" href="#test-data-management" title="Link to this heading"></a></h2>
<section id="input-fixtures">
<h3>Input Fixtures<a class="headerlink" href="#input-fixtures" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Small test data</strong>: Include directly in <code class="docutils literal notranslate"><span class="pre">tests/data/</span></code></p></li>
<li><p><strong>Generated test data</strong>: Create programmatically in <code class="docutils literal notranslate"><span class="pre">setup_method</span></code></p></li>
<li><p><strong>Large test data</strong>: Download during test execution (with caching)</p></li>
</ul>
</section>
<section id="output-management">
<h3>Output Management<a class="headerlink" href="#output-management" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Consistent paths</strong>: Use <code class="docutils literal notranslate"><span class="pre">metainformant.core.io.ensure_directory</span></code></p></li>
<li><p><strong>Deterministic names</strong>: Use consistent, predictable filenames</p></li>
<li><p><strong>Cleanup policy</strong>: Generally leave outputs for inspection (they’re in <code class="docutils literal notranslate"><span class="pre">output/</span></code>)</p></li>
</ul>
</section>
<section id="example-test-data-handling">
<h3>Example Test Data Handling<a class="headerlink" href="#example-test-data-handling" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup test environment with data.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">ensure_directory</span><span class="p">(</span><span class="s2">&quot;output/test_analysis&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create test data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_sequences</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;ATCGATCGATCG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GCTAGCTAGCTA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TTTTAAAACCCC&quot;</span>
    <span class="p">]</span>
    
    <span class="c1"># Write test FASTA</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_fasta</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/test.fasta&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_fasta</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">seq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_sequences</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;seq_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">seq</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="continuous-integration">
<h2>Continuous Integration<a class="headerlink" href="#continuous-integration" title="Link to this heading"></a></h2>
<p>The test suite is designed for CI/CD environments:</p>
<section id="ci-configuration">
<h3>CI Configuration<a class="headerlink" href="#ci-configuration" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example GitHub Actions</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run fast tests</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./scripts/package/test.sh --mode fast</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run network tests</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./scripts/package/test.sh --mode network</span>
<span class="w">  </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">env.ENABLE_NETWORK_TESTS == &#39;true&#39;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate coverage report</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./scripts/package/test.sh --mode coverage</span>
</pre></div>
</div>
</section>
<section id="test-selection">
<h3>Test Selection<a class="headerlink" href="#test-selection" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Default CI</strong>: Run fast tests only</p></li>
<li><p><strong>Nightly builds</strong>: Include slow and network tests</p></li>
<li><p><strong>Release testing</strong>: Full test suite including integration tests</p></li>
</ul>
</section>
</section>
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Link to this heading"></a></h2>
<section id="test-execution-speed">
<h3>Test Execution Speed<a class="headerlink" href="#test-execution-speed" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Fast tests</strong>: &lt; 1 second per test</p></li>
<li><p><strong>Slow tests</strong>: Marked with <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.slow</span></code></p></li>
<li><p><strong>Parallel execution</strong>: Tests designed for parallel execution</p></li>
<li><p><strong>Resource usage</strong>: Tests avoid excessive memory/CPU usage</p></li>
</ul>
</section>
<section id="large-dataset-testing">
<h3>Large Dataset Testing<a class="headerlink" href="#large-dataset-testing" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">slow</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_large_dataset_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with large synthetic dataset.&quot;&quot;&quot;</span>
    <span class="c1"># Generate large test data efficiently</span>
    <span class="n">large_data</span> <span class="o">=</span> <span class="n">generate_synthetic_data</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
    
    <span class="c1"># Test processing</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">process_large_data</span><span class="p">(</span><span class="n">large_data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">large_data</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="development-workflow">
<h2>Development Workflow<a class="headerlink" href="#development-workflow" title="Link to this heading"></a></h2>
<section id="test-driven-development">
<h3>Test-Driven Development<a class="headerlink" href="#test-driven-development" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Write failing test</strong>: Implement test for new functionality</p></li>
<li><p><strong>Implement feature</strong>: Write minimal code to pass test</p></li>
<li><p><strong>Refactor</strong>: Improve implementation while maintaining test passage</p></li>
<li><p><strong>Add edge cases</strong>: Test error conditions and boundary cases</p></li>
</ol>
</section>
<section id="running-tests-during-development">
<h3>Running Tests During Development<a class="headerlink" href="#running-tests-during-development" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run tests for specific module during development</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/test_core_text.py<span class="w"> </span>-v<span class="w"> </span>--tb<span class="o">=</span>short

<span class="c1"># Watch mode for continuous testing (with external tool)</span>
<span class="c1"># uv pip install pytest-watch</span>
ptw<span class="w"> </span>tests/test_core_text.py

<span class="c1"># Run with immediate failure reporting</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>-x<span class="w"> </span>tests/test_core_text.py
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<section id="uv-related-issues">
<h3>UV-Related Issues<a class="headerlink" href="#uv-related-issues" title="Link to this heading"></a></h3>
<section id="uv-not-found">
<h4>UV Not Found<a class="headerlink" href="#uv-not-found" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❌<span class="w"> </span>uv<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>installed<span class="w"> </span>or<span class="w"> </span>not<span class="w"> </span><span class="k">in</span><span class="w"> </span>PATH
<span class="w">   </span>Please<span class="w"> </span>install<span class="w"> </span>uv<span class="w"> </span>first:
<span class="w">   </span>curl<span class="w"> </span>-LsSf<span class="w"> </span>https://astral.sh/uv/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
<span class="w">   </span>Or<span class="w"> </span>visit:<span class="w"> </span>https://github.com/astral.sh/uv
</pre></div>
</div>
<p><strong>Solution</strong>: Install uv and ensure it’s in your PATH:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-LsSf<span class="w"> </span>https://astral.sh/uv/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.cargo/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
<section id="dependency-sync-issues">
<h4>Dependency Sync Issues<a class="headerlink" href="#dependency-sync-issues" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❌<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>sync<span class="w"> </span>dependencies
</pre></div>
</div>
<p><strong>Solution</strong>: Clear UV cache and retry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>-rf<span class="w"> </span>.uv-cache/
bash<span class="w"> </span>scripts/package/verify.sh<span class="w"> </span>--mode<span class="w"> </span>deps
</pre></div>
</div>
</section>
<section id="fat-filesystem-issues">
<h4>FAT Filesystem Issues<a class="headerlink" href="#fat-filesystem-issues" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>📁<span class="w"> </span>FAT<span class="w"> </span>filesystem<span class="w"> </span>detected<span class="w"> </span>-<span class="w"> </span>using<span class="w"> </span>/tmp<span class="w"> </span>locations
</pre></div>
</div>
<p><strong>Note</strong>: This is normal on FAT filesystems (exFAT, FAT32). The system automatically uses <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> for virtual environments and caches.</p>
</section>
<section id="test-environment-not-ready">
<h4>Test Environment Not Ready<a class="headerlink" href="#test-environment-not-ready" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>❌<span class="w"> </span>pytest<span class="w"> </span>not<span class="w"> </span>available
</pre></div>
</div>
<p><strong>Solution</strong>: Setup test environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>scripts/package/verify.sh<span class="w"> </span>--mode<span class="w"> </span>deps<span class="w"> </span>--test-type<span class="w"> </span>fast
</pre></div>
</div>
</section>
<section id="network-tests-failing">
<h4>Network Tests Failing<a class="headerlink" href="#network-tests-failing" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>⚠️<span class="w">  </span>Network<span class="w"> </span>connectivity<span class="w"> </span>check<span class="w"> </span>failed
</pre></div>
</div>
<p><strong>Note</strong>: Network tests require internet access. They will be skipped gracefully if offline.</p>
</section>
<section id="external-tool-tests-failing">
<h4>External Tool Tests Failing<a class="headerlink" href="#external-tool-tests-failing" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>⚠️<span class="w">  </span>amalgkit<span class="w"> </span>not<span class="w"> </span>available<span class="w"> </span>-<span class="w"> </span>some<span class="w"> </span>tests<span class="w"> </span>may<span class="w"> </span>be<span class="w"> </span>skipped
</pre></div>
</div>
<p><strong>Note</strong>: External tool tests require specific CLI tools. Install them or tests will be skipped.</p>
</section>
</section>
<section id="common-test-failures">
<h3>Common Test Failures<a class="headerlink" href="#common-test-failures" title="Link to this heading"></a></h3>
<section id="import-errors">
<h4>Import Errors<a class="headerlink" href="#import-errors" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">ModuleNotFoundError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">&#39;metainformant&#39;</span>
</pre></div>
</div>
<p><strong>Solution</strong>: Ensure you’re running tests from the repository root and PYTHONPATH is set:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/path/to/metainformant
<span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PWD</span><span class="s2">/src:</span><span class="nv">$PYTHONPATH</span><span class="s2">&quot;</span>
uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/
</pre></div>
</div>
</section>
<section id="permission-errors">
<h4>Permission Errors<a class="headerlink" href="#permission-errors" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">PermissionError</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">13</span><span class="p">]</span> <span class="n">Permission</span> <span class="n">denied</span>
</pre></div>
</div>
<p><strong>Solution</strong>: Ensure output directories are writable:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>-R<span class="w"> </span>u+w<span class="w"> </span>output/
</pre></div>
</div>
</section>
<section id="memory-issues">
<h4>Memory Issues<a class="headerlink" href="#memory-issues" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">MemoryError</span><span class="p">:</span> <span class="n">Out</span> <span class="n">of</span> <span class="n">memory</span>
</pre></div>
</div>
<p><strong>Solution</strong>: Run fewer tests in parallel or increase system memory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uv<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/test_core_*.py<span class="w">  </span><span class="c1"># Run smaller test sets</span>
</pre></div>
</div>
<p>Related: <a class="reference internal" href="cli.html"><span class="std std-doc">CLI</span></a>, <a class="reference internal" href="core/README.html"><span class="std std-doc">Core</span></a></p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="life_events/index.html" class="btn btn-neutral float-left" title="Life Events Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, METAINFORMANT Contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>