# METAINFORMANT Amalgkit Configuration
# Species: Pogonomyrmex barbatus (5-sample test)
# NCBI Taxonomy ID: 144034
# Assembly: GCF_000187915.1 (Pbar_UMD_V03)
# Assembly Level: Scaffold
# Sequencing: 454 pyrosequencing
# Annotation Release: 101
# Notes: High-quality scaffold assembly - LIMITED TO 5 SAMPLES FOR TESTING
# RNA-seq Samples Available: 120 (limited to 5 for quick validation)
# Generated: 2025-11-03


# Paths are resolved relative to repository root
# Works whether repo is on /home/q/... or /media/q/ext6/...
work_dir: output/amalgkit/pbarbatus_test5/work
log_dir: output/amalgkit/pbarbatus_test5/logs
threads: 12


auto_install_amalgkit: true


# Pre-selection filtering rules
filters:
  require_tissue: false  # Set to true to filter by tissue metadata


# Species configuration
species_list:
  - Pogonomyrmex_barbatus


# Alternative taxonomy specification
taxon_id: 144034


# Reference genome configuration
# Based on NCBI assembly: GCF_000187915.1
genome:
  accession: GCF_000187915.1
  assembly_name: Pbar_UMD_V03
  annotation_release: 101
  dest_dir: output/amalgkit/pbarbatus_test5/genome


  # Files to download (based on available NCBI FTP resources)
  include:
    - genome           # Genomic sequences (FASTA)
    - gff3            # Gene annotations (GFF3)
    - rna             # RNA sequences (FASTA)
    - cds             # CDS sequences (FASTA)
    - protein         # Protein sequences (FASTA)
    - seq-report      # Sequence report
    - feature-table   # Feature table
    - gene-ontology   # Gene Ontology annotations (if available)


  # Direct FTP URL for all genome files
  ftp_url: https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/187/915/GCF_000187915.1_Pbar_UMD_V03/


  # Specific important files for transcriptome analysis
  files:
    genomic_fasta: GCF_000187915.1_Pbar_UMD_V03_genomic.fna.gz
    transcriptome_fasta: GCF_000187915.1_Pbar_UMD_V03_rna_from_genomic.fna.gz
    cds_fasta: GCF_000187915.1_Pbar_UMD_V03_cds_from_genomic.fna.gz
    protein_fasta: GCF_000187915.1_Pbar_UMD_V03_protein.faa.gz
    annotation_gff: GCF_000187915.1_Pbar_UMD_V03_genomic.gff.gz
    annotation_gtf: GCF_000187915.1_Pbar_UMD_V03_genomic.gtf.gz


# Per-step parameters (merged on top of common params)
steps:
  metadata:
    # Required by amalgkit metadata
    out_dir: output/amalgkit/pbarbatus_test5/work
    # Uses NCBI_EMAIL from environment; override here if needed
    # entrez_email: you@example.com
    search_string: '"Pogonomyrmex barbatus"[Organism]'
    redo: yes
  integrate:
    # IMPORTANT: fastq_dir must point to the getfastq subdirectory created by getfastq step
    # If getfastq used out_dir: output/amalgkit/pbarbatus_test5/fastq,
    # then fastq_dir should be: output/amalgkit/pbarbatus_test5/fastq/getfastq
    # The workflow automatically adjusts this path if the getfastq subdirectory exists
    fastq_dir: output/amalgkit/pbarbatus_test5/fastq/getfastq
  config: {}
  select:
    max_sample: 1
    mark_missing_rank: none
    # Force diverse selection if possible
    priority: "completeness"
    redo: yes
  getfastq:
    out_dir: output/amalgkit/pbarbatus_test5/fastq
    threads: 8  # Increased for multi-sample test
    redo: no    # Skip re-downloading for verification run
    # Cloud acceleration: AWS only (full SRA files)
    # NOTE: NCBI and GCP have LITE files (metadata-only, no sequence data) for this species
    # AWS has full SRA files with actual sequence data
    aws: yes
    gcp: no            # DISABLED: GCP has lite files (no sequence data)
    ncbi: no           # DISABLED: NCBI has lite files (no sequence data)
    pfd: no           # DISABLED: parallel-fastq-dump usually not needed
    fastp: yes        # ENABLED: fastp QC tool
    max_bp: 50000000  # Increase to 50MB for better multi-sample quantification coverage
    #                       # After quantification, only small abundance files remain (~few MB per sample)
    #                       # Large downloads are temporary - quantified samples don't need re-download
    # IMPORTANT: vdb-config must be set to use a location with sufficient disk space
    # Run: vdb-config -i and set repository root to a location with >50GB free space
    # Or set via: vdb-config -s /repository/user/main/public/root=/path/to/large/disk
  quant:
    # CRITICAL PATH CONFIGURATION:
    # - amalgkit quant looks for FASTQ files in {out_dir}/getfastq/{sample_id}/
    # - If getfastq used out_dir: output/amalgkit/pbarbatus_test5/fastq,
    #   then quant's out_dir must be work_dir so it can find getfastq output
    # - Quantification results will be written to {out_dir}/quant/{sample_id}/abundance.tsv
    # - Therefore: out_dir should be work_dir (not a separate quant_dir)
    out_dir: output/amalgkit/pbarbatus_test5/work
    threads: 6
    redo: yes
    # Build kallisto index if not present
    # Index location: {out_dir}/index/{Scientific_Name}_transcripts.idx
    build_index: yes
    # Delete FASTQ files after quantification to save disk space
    keep_fastq: no
  merge:
    # Merge looks for abundance files in {out_dir}/quant/{sample_id}/{sample_id}_abundance.tsv
    # If quant used out_dir: work_dir, merge should either:
    # - Use same work_dir as quant, OR
    # - Copy abundance files to {merge_out_dir}/quant/{sample_id}/{sample_id}_abundance.tsv
    # This config uses a separate merged directory, so files may need to be copied/symlinked
    out: output/amalgkit/pbarbatus_test5/merged/merged_abundance.tsv
    out_dir: output/amalgkit/pbarbatus_test5/merged
  cstmm:
    out_dir: output/amalgkit/pbarbatus_test5/work
    orthogroup_table: ""
  curate:
    out_dir: output/amalgkit/pbarbatus_test5/work
  csca:
    out_dir: output/amalgkit/pbarbatus_test5/work
    orthogroup_table: ""
  sanity: {}
